{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{Card,Button,Alert,Container,Row,Col,Table,Badge,Spinner,ButtonGroup,Form}from'react-bootstrap';import{QrCodeScan,CheckCircleFill,XCircleFill,Calendar,Clock,ArrowRightCircle,ArrowLeftCircle}from'react-bootstrap-icons';import{useAuth}from'../../hooks/useAuth';import{secureApiEndpoints}from'../../utils/apiMigration';import QrScanner from'qr-scanner';import Swal from'sweetalert2';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const AttendanceScanner=()=>{const[isScanning,setIsScanning]=useState(false);const[message,setMessage]=useState('');const[messageType,setMessageType]=useState('');const[todayAttendances,setTodayAttendances]=useState([]);const[isLoading,setIsLoading]=useState(false);const[scannerError,setScannerError]=useState('');const[showManualInput,setShowManualInput]=useState(false);const[manualQrCode,setManualQrCode]=useState('');const[isMarkingAbsent,setIsMarkingAbsent]=useState(false);const[eventType,setEventType]=useState('auto');// 'entry', 'exit' ou 'auto'\nconst[entryExitStats,setEntryExitStats]=useState(null);const{user}=useAuth();const videoRef=useRef(null);const qrScannerRef=useRef(null);useEffect(()=>{loadTodayAttendances();loadEntryExitStats();return()=>{if(qrScannerRef.current){qrScannerRef.current.destroy();}};},[]);const loadTodayAttendances=async()=>{try{setIsLoading(true);const response=await secureApiEndpoints.supervisors.getDailyAttendance({supervisor_id:user.id});if(response.success){setTodayAttendances(response.data.attendances||[]);}else{console.error('Erreur API:',response.message);}}catch(error){console.error('Erreur lors du chargement des présences:',error);}finally{setIsLoading(false);}};const loadEntryExitStats=async()=>{try{const response=await secureApiEndpoints.supervisors.getEntryExitStats({supervisor_id:user.id});if(response.success){setEntryExitStats(response.data);}else{console.error('Erreur API stats:',response.message);}}catch(error){console.error('Erreur lors du chargement des statistiques:',error);}};const startScanner=async()=>{try{setScannerError('');setIsScanning(true);console.log('🔍 Tentative de démarrage du scanner...');// Vérifier d'abord les permissions de caméra\ntry{const stream=await navigator.mediaDevices.getUserMedia({video:true});console.log('✅ Permissions caméra accordées');stream.getTracks().forEach(track=>track.stop());// Arrêter le stream de test\n}catch(permError){console.error('❌ Permissions caméra refusées:',permError);throw new Error('Permission denied: '+permError.message);}// Vérifier les caméras disponibles\nconst cameras=await QrScanner.listCameras(true);console.log('📷 Caméras disponibles:',cameras);if(cameras.length===0){throw new Error('Aucune caméra trouvée sur cet appareil');}if(videoRef.current){// Configuration plus permissive\nqrScannerRef.current=new QrScanner(videoRef.current,result=>handleScanResult(result.data),{onDecodeError:error=>{// Réduire le bruit des erreurs de décodage\n// console.log('Scan decode error:', error);\n},highlightScanRegion:true,highlightCodeOutline:true,preferredCamera:cameras.length>1?'environment':cameras[0].id,// Utiliser la première caméra si une seule\nmaxScansPerSecond:3,// Réduire pour éviter la surcharge\nreturnDetailedScanResult:false});console.log('⏳ Démarrage du scanner QR...');await qrScannerRef.current.start();console.log('✅ Scanner QR démarré avec succès');// Masquer le formulaire de saisie manuelle si le scanner fonctionne\nsetShowManualInput(false);}}catch(error){console.error('❌ Erreur lors du démarrage du scanner:',error);console.error('Type d\\'erreur:',error.constructor.name);console.error('Message:',error.message);let errorMessage='Impossible d\\'accéder à la caméra.';let debugInfo='';if(error.name==='NotAllowedError'||error.message.includes('Permission denied')){errorMessage='🚫 Accès à la caméra refusé par le navigateur.';debugInfo='Cliquez sur l\\'icône 🔒 dans la barre d\\'adresse et autorisez la caméra.';}else if(error.name==='NotFoundError'||error.message.includes('Camera not found')){errorMessage='📷 Aucune caméra trouvée.';debugInfo='Vérifiez qu\\'une caméra est connectée et fonctionnelle.';}else if(error.name==='NotSupportedError'){errorMessage='🌐 Votre navigateur ne supporte pas l\\'accès à la caméra.';debugInfo='Essayez avec Chrome, Firefox ou Safari récent.';}else if(error.name==='NotReadableError'){errorMessage='⚠️ Caméra occupée par une autre application.';debugInfo='Fermez les autres applications utilisant la caméra.';}else{errorMessage='🔧 Erreur technique du scanner.';debugInfo=`Détails: ${error.message}`;}setScannerError(`${errorMessage} ${debugInfo}`);setIsScanning(false);// Proposer l'alternative de saisie manuelle\nsetShowManualInput(true);}};const stopScanner=()=>{if(qrScannerRef.current){qrScannerRef.current.stop();qrScannerRef.current.destroy();qrScannerRef.current=null;}setIsScanning(false);setShowManualInput(false);};const handleManualSubmit=async e=>{e.preventDefault();if(!manualQrCode.trim())return;await handleScanResult(manualQrCode.trim());setManualQrCode('');setShowManualInput(false);};const runCameraDiagnostic=async()=>{console.log('🔍 === DIAGNOSTIC CAMÉRA ===');try{// Test 1: Vérifier le support MediaDevices\nif(!navigator.mediaDevices){console.log('❌ navigator.mediaDevices non supporté');return;}console.log('✅ navigator.mediaDevices supporté');// Test 2: Lister les appareils\nconst devices=await navigator.mediaDevices.enumerateDevices();const cameras=devices.filter(device=>device.kind==='videoinput');console.log('📷 Caméras détectées:',cameras.length);cameras.forEach((camera,index)=>{console.log(`  ${index+1}. ${camera.label||'Caméra sans nom'} (${camera.deviceId})`);});// Test 3: Test d'accès simple\ntry{const stream=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:'environment'}});console.log('✅ Accès caméra réussi');console.log('📹 Stream:',stream.getVideoTracks()[0].getSettings());stream.getTracks().forEach(track=>track.stop());}catch(streamError){console.log('❌ Échec accès caméra:',streamError.name,streamError.message);}// Test 4: Test QrScanner\ntry{const qrCameras=await QrScanner.listCameras(true);console.log('📱 QrScanner caméras:',qrCameras.length);qrCameras.forEach((camera,index)=>{console.log(`  ${index+1}. ${camera.label} (${camera.id})`);});}catch(qrError){console.log('❌ QrScanner erreur:',qrError.message);}}catch(error){console.log('❌ Erreur diagnostic:',error);}console.log('🔍 === FIN DIAGNOSTIC ===');};const handleMarkAllAbsent=async()=>{const result=await Swal.fire({title:'📋 Marquer les absents ?',html:`\n        <p>Cette action va marquer comme <strong>absents</strong> tous les élèves qui n'ont pas été enregistrés comme présents aujourd'hui.</p>\n        <div class=\"alert alert-info mt-3\">\n          <strong>ℹ️ Note :</strong> Seuls les élèves qui n'ont <strong>aucune entrée</strong> aujourd'hui seront marqués absents.\n        </div>\n        <p><strong>Êtes-vous sûr de vouloir continuer ?</strong></p>\n      `,icon:'question',showCancelButton:true,confirmButtonColor:'#d33',cancelButtonColor:'#3085d6',confirmButtonText:'✅ Oui, marquer les absents',cancelButtonText:'❌ Annuler'});if(result.isConfirmed){setIsMarkingAbsent(true);try{const response=await secureApiEndpoints.supervisors.markAllAbsentStudents({supervisor_id:user.id,attendance_date:new Date().toISOString().split('T')[0]// Format YYYY-MM-DD\n});if(response.success){// Afficher le résultat détaillé\nconst classStatsHtml=Object.entries(response.data.class_statistics||{}).map(_ref=>{let[className,count]=_ref;return`<li><strong>${className}:</strong> ${count} absent(s)</li>`;}).join('');await Swal.fire({title:'✅ Absences marquées !',html:`\n              <div class=\"text-left\">\n                <p><strong>${response.data.absent_students_marked}</strong> élève(s) marqué(s) comme absent(s)</p>\n                <hr>\n                <p><strong>📊 Résumé du jour :</strong></p>\n                <ul class=\"list-unstyled\">\n                  <li>👥 <strong>Total élèves :</strong> ${response.data.total_students}</li>\n                  <li>✅ <strong>Présents :</strong> ${response.data.present_students}</li>\n                  <li>❌ <strong>Absents marqués :</strong> ${response.data.absent_students_marked}</li>\n                </ul>\n                ${classStatsHtml?`\n                <hr>\n                <p><strong>📋 Par classe :</strong></p>\n                <ul>${classStatsHtml}</ul>\n                `:''}\n                <div class=\"alert alert-success mt-3\">\n                  <small>📱 Les parents ont été notifiés automatiquement par WhatsApp</small>\n                </div>\n              </div>\n            `,icon:'success',confirmButtonText:'Parfait !'});// Recharger les données\nloadTodayAttendances();loadEntryExitStats();}else{Swal.fire({title:'Erreur',text:response.message||'Erreur lors du marquage des absences',icon:'error'});}}catch(error){console.error('Erreur marquage absences:',error);Swal.fire({title:'Erreur',text:'Erreur lors du marquage des absences',icon:'error'});}finally{setIsMarkingAbsent(false);}}};const handleScanResult=async qrCode=>{try{stopScanner();setIsLoading(true);const response=await secureApiEndpoints.supervisors.scanQR({student_qr_code:qrCode,supervisor_id:user.id,event_type:eventType});if(response.success){const eventIcon=response.data.event_type==='entry'?'🟢':'🔴';setMessage(`${eventIcon} ${response.data.event_label} de ${response.data.student_name} enregistrée à ${response.data.marked_at}`);setMessageType('success');loadTodayAttendances();// Recharger la liste\nloadEntryExitStats();// Recharger les statistiques\n}else{// Afficher le message d'erreur détaillé\nlet errorMessage=response.message;if(response.student_name){errorMessage=`${response.student_name}: ${response.message}`;}setMessage(`❌ ${errorMessage}`);setMessageType('danger');}}catch(error){console.error('Erreur scan:',error);// Tenter d'extraire un message d'erreur plus détaillé\nlet errorMessage='Erreur lors de l\\'enregistrement de la présence';if(error.response&&error.response.data){if(error.response.data.message){errorMessage=error.response.data.message;}else if(error.response.data.error_details){errorMessage=`Erreur technique: ${error.response.data.error_details}`;}}else if(error.message){errorMessage=error.message;}setMessage(`❌ ${errorMessage}`);setMessageType('danger');}finally{setIsLoading(false);// Auto-clear message after 5 seconds\nsetTimeout(()=>{setMessage('');setMessageType('');},5000);}};const formatTime=timeString=>{if(!timeString)return'';return new Date(`2000-01-01T${timeString}`).toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});};return/*#__PURE__*/_jsxs(Container,{fluid:true,className:\"py-4\",children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"h2\",{className:\"mb-4 d-flex align-items-center\",children:[/*#__PURE__*/_jsx(QrCodeScan,{className:\"me-2\"}),\"Scanner de Pr\\xE9sences\"]})})}),/*#__PURE__*/_jsxs(Row,{className:\"mb-4\",children:[/*#__PURE__*/_jsx(Col,{lg:6,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Header,{children:/*#__PURE__*/_jsxs(\"h5\",{className:\"mb-0 d-flex align-items-center\",children:[/*#__PURE__*/_jsx(QrCodeScan,{className:\"me-2\"}),\"Scanner QR\"]})}),/*#__PURE__*/_jsxs(Card.Body,{children:[scannerError&&/*#__PURE__*/_jsx(Alert,{variant:\"danger\",className:\"mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"me-2\",children:\"\\uD83D\\uDCF7\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Probl\\xE8me de cam\\xE9ra :\"}),/*#__PURE__*/_jsx(\"br\",{}),scannerError,/*#__PURE__*/_jsx(\"hr\",{className:\"my-2\"}),/*#__PURE__*/_jsxs(\"small\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Solutions :\"}),/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Utilisez la \",/*#__PURE__*/_jsx(\"strong\",{children:\"saisie manuelle\"}),\" ci-dessous\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Cliquez sur l'ic\\xF4ne \\uD83D\\uDD12 dans la barre d'adresse et autorisez la cam\\xE9ra\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Actualisez la page apr\\xE8s avoir autoris\\xE9\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Fermez les autres onglets/apps utilisant la cam\\xE9ra\"]}),/*#__PURE__*/_jsx(\"hr\",{className:\"my-2\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-info\",size:\"sm\",onClick:runCameraDiagnostic,children:\"\\uD83D\\uDD0D Diagnostic cam\\xE9ra (voir console)\"})]})]})}),message&&/*#__PURE__*/_jsx(Alert,{variant:messageType,className:\"mb-3\",children:message}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-3\",children:\"Mode de scan :\"}),/*#__PURE__*/_jsxs(ButtonGroup,{className:\"w-100\",children:[/*#__PURE__*/_jsx(Button,{variant:eventType==='auto'?'primary':'outline-primary',onClick:()=>setEventType('auto'),disabled:isScanning,size:\"sm\",children:\"\\uD83E\\uDD16 Automatique\"}),/*#__PURE__*/_jsxs(Button,{variant:eventType==='entry'?'success':'outline-success',onClick:()=>setEventType('entry'),disabled:isScanning,size:\"sm\",children:[/*#__PURE__*/_jsx(ArrowRightCircle,{className:\"me-1\",size:14}),\"Entr\\xE9e\"]}),/*#__PURE__*/_jsxs(Button,{variant:eventType==='exit'?'danger':'outline-danger',onClick:()=>setEventType('exit'),disabled:isScanning,size:\"sm\",children:[/*#__PURE__*/_jsx(ArrowLeftCircle,{className:\"me-1\",size:14}),\"Sortie\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[eventType==='auto'&&'🤖 Le système déterminera automatiquement si c\\'est une entrée ou sortie',eventType==='entry'&&'🟢 Mode entrée forcée',eventType==='exit'&&'🔴 Mode sortie forcée']})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center mb-3\",children:!isScanning?/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column gap-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"primary\",size:\"lg\",onClick:startScanner,disabled:isLoading,children:isLoading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Spinner,{size:\"sm\",className:\"me-2\"}),\"Traitement...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(QrCodeScan,{className:\"me-2\"}),\"D\\xE9marrer le Scanner\"]})}),!showManualInput?/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",size:\"sm\",onClick:()=>setShowManualInput(true),disabled:isLoading,children:\"\\uD83D\\uDCDD Saisie manuelle\"}):/*#__PURE__*/_jsx(Button,{variant:\"outline-danger\",size:\"sm\",onClick:()=>setShowManualInput(false),children:\"\\u274C Annuler saisie\"})]}):/*#__PURE__*/_jsxs(Button,{variant:\"danger\",size:\"lg\",onClick:stopScanner,children:[/*#__PURE__*/_jsx(XCircleFill,{className:\"me-2\"}),\"Arr\\xEAter le Scanner\"]})}),showManualInput&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsxs(Card,{className:\"border-warning\",children:[/*#__PURE__*/_jsx(Card.Header,{className:\"bg-warning text-dark\",children:/*#__PURE__*/_jsx(\"h6\",{className:\"mb-0\",children:\"\\uD83D\\uDCDD Saisie manuelle du code QR\"})}),/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(Form,{onSubmit:handleManualSubmit,children:[/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Code QR ou ID de l'\\xE9l\\xE8ve\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Ex: STUDENT_ID_123 ou 123\",value:manualQrCode,onChange:e=>setManualQrCode(e.target.value),disabled:isLoading}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\",children:\"Saisissez le code QR ou l'ID num\\xE9rique de l'\\xE9l\\xE8ve\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"success\",disabled:isLoading||!manualQrCode.trim(),children:isLoading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Spinner,{size:\"sm\",className:\"me-2\"}),\"Traitement...\"]}):/*#__PURE__*/_jsx(_Fragment,{children:\"\\u2705 Valider\"})}),/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline-secondary\",onClick:()=>{setManualQrCode('');setShowManualInput(false);},disabled:isLoading,children:\"Annuler\"})]})]})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"scanner-container\",style:{position:'relative',maxWidth:'400px',margin:'0 auto'},children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{width:'100%',height:'auto',border:'2px solid #dee2e6',borderRadius:'8px',display:isScanning?'block':'none'}}),!isScanning&&/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'300px',border:'2px dashed #dee2e6',borderRadius:'8px',display:'flex',alignItems:'center',justifyContent:'center',backgroundColor:'#f8f9fa'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center text-muted d-flex flex-column align-items-center\",children:[/*#__PURE__*/_jsx(QrCodeScan,{size:48}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 mb-0\",children:\"Cliquez sur \\\"D\\xE9marrer le Scanner\\\"\"})]})})]})]})]})}),/*#__PURE__*/_jsxs(Col,{lg:6,children:[/*#__PURE__*/_jsx(Row,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(Card,{className:\"border-info\",children:[/*#__PURE__*/_jsx(Card.Header,{className:\"bg-info\",children:/*#__PURE__*/_jsx(\"h6\",{className:\"mb-0\",children:\"\\uD83D\\uDCCA Statistiques du Jour\"})}),/*#__PURE__*/_jsx(Card.Body,{children:entryExitStats?/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{xs:4,className:\"text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-success fs-4 fw-bold\",children:entryExitStats.global_stats.total_entries}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"Entr\\xE9es\"})]})}),/*#__PURE__*/_jsx(Col,{xs:4,className:\"text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-primary fs-4 fw-bold\",children:entryExitStats.global_stats.currently_present}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"Pr\\xE9sents\"})]})}),/*#__PURE__*/_jsx(Col,{xs:4,className:\"text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-danger fs-4 fw-bold\",children:entryExitStats.global_stats.total_exits}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"Sorties\"})]})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center text-muted\",children:[/*#__PURE__*/_jsx(Spinner,{size:\"sm\",className:\"me-2\"}),\"Chargement des statistiques...\"]})}),/*#__PURE__*/_jsxs(Card.Footer,{className:\"text-center\",children:[/*#__PURE__*/_jsx(Button,{variant:\"warning\",size:\"sm\",onClick:handleMarkAllAbsent,disabled:isMarkingAbsent||isLoading,children:isMarkingAbsent?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Spinner,{size:\"sm\",className:\"me-2\"}),\"Marquage en cours...\"]}):/*#__PURE__*/_jsx(_Fragment,{children:\"\\uD83D\\uDCCB Marquer les absents\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"Marque comme absents tous les \\xE9l\\xE8ves sans entr\\xE9e aujourd'hui\"})})]})]})})}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Header,{children:/*#__PURE__*/_jsxs(\"h5\",{className:\"mb-0 d-flex align-items-center\",children:[/*#__PURE__*/_jsx(Calendar,{className:\"me-2\"}),\"Pr\\xE9sences d'Aujourd'hui\",/*#__PURE__*/_jsx(Badge,{bg:\"primary\",className:\"ms-2\",children:todayAttendances.length})]})}),/*#__PURE__*/_jsx(Card.Body,{children:isLoading?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-4\",children:[/*#__PURE__*/_jsx(Spinner,{}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-muted\",children:\"Chargement...\"})]}):todayAttendances.length>0?/*#__PURE__*/_jsx(\"div\",{style:{maxHeight:'400px',overflowY:'auto'},children:/*#__PURE__*/_jsxs(Table,{striped:true,hover:true,size:\"sm\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"\\xC9l\\xE8ve\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Classe\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Type\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Heure\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Statut\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:todayAttendances.map((attendance,index)=>{var _attendance$student,_attendance$school_cl;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:((_attendance$student=attendance.student)===null||_attendance$student===void 0?void 0:_attendance$student.full_name)||'N/A'}),/*#__PURE__*/_jsx(\"td\",{children:((_attendance$school_cl=attendance.school_class)===null||_attendance$school_cl===void 0?void 0:_attendance$school_cl.name)||'N/A'}),/*#__PURE__*/_jsx(\"td\",{children:attendance.is_present?/*#__PURE__*/_jsx(Badge,{bg:attendance.event_type==='entry'?'success':'info',children:attendance.event_type==='entry'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ArrowRightCircle,{size:12,className:\"me-1\"}),\"Entr\\xE9e\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ArrowLeftCircle,{size:12,className:\"me-1\"}),\"Sortie\"]})}):/*#__PURE__*/_jsx(Badge,{bg:\"danger\",children:\"\\u274C Absent\"})}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(Clock,{size:14,className:\"me-1\"}),formatTime(attendance.scanned_at)]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:attendance.is_present?'success':'danger',children:attendance.is_present?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CheckCircleFill,{size:12,className:\"me-1\"}),\"Pr\\xE9sent\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(XCircleFill,{size:12,className:\"me-1\"}),\"Absent\"]})})})]},index);})})]})}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-4 text-muted\",children:[/*#__PURE__*/_jsx(Calendar,{size:48}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 mb-0\",children:\"Aucune pr\\xE9sence enregistr\\xE9e aujourd'hui\"})]})})]})]})]}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(Card,{className:\"border-info\",children:[/*#__PURE__*/_jsx(Card.Header,{className:\"bg-info text-white\",children:/*#__PURE__*/_jsx(\"h6\",{className:\"mb-0\",children:\"Instructions d'utilisation - Entr\\xE9es/Sorties\"})}),/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsxs(\"ol\",{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83E\\uDD16 Mode Automatique (Recommand\\xE9) :\"}),\" Le syst\\xE8me d\\xE9tecte automatiquement si l'\\xE9l\\xE8ve doit entrer ou sortir\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83C\\uDFAF Mode Manuel :\"}),\" Choisissez \\\"Entr\\xE9e\\\" ou \\\"Sortie\\\" selon le besoin\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCF7 Scanner Cam\\xE9ra :\"}),\" Cliquez sur \\\"D\\xE9marrer le Scanner\\\" et dirigez vers le code QR\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCDD Saisie Manuelle :\"}),\" Si la cam\\xE9ra ne fonctionne pas, utilisez \\\"Saisie manuelle\\\"\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCCB Gestion des Absences :\"}),\" Utilisez \\\"Marquer les absents\\\" pour marquer automatiquement tous les \\xE9l\\xE8ves sans entr\\xE9e\"]}),/*#__PURE__*/_jsx(\"li\",{children:\"Le syst\\xE8me v\\xE9rifie automatiquement les conditions (pas de double entr\\xE9e/sortie)\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Les parents re\\xE7oivent une notification WhatsApp automatique\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Consultez les statistiques et la liste des mouvements du jour\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-info mb-3\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCA1 Astuce :\"}),\" En cas de probl\\xE8me de cam\\xE9ra, vous pouvez toujours utiliser la saisie manuelle en saisissant directement l'ID de l'\\xE9l\\xE8ve (ex: 123) ou le code QR complet (ex: STUDENT_ID_123).\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-warning mb-0\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCCB Absences :\"}),\" Les \",/*#__PURE__*/_jsx(\"strong\",{children:\"sorties\"}),\" ne sont pas des absences ! Elles indiquent simplement que l'\\xE9l\\xE8ve est parti. Utilisez le bouton \\\"Marquer les absents\\\" pour les \\xE9l\\xE8ves qui ne sont jamais venus \\xE0 l'\\xE9cole.\"]})]})]})})})]});};export default AttendanceScanner;","map":{"version":3,"names":["React","useState","useEffect","useRef","Card","Button","Alert","Container","Row","Col","Table","Badge","Spinner","ButtonGroup","Form","QrCodeScan","CheckCircleFill","XCircleFill","Calendar","Clock","ArrowRightCircle","ArrowLeftCircle","useAuth","secureApiEndpoints","QrScanner","Swal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AttendanceScanner","isScanning","setIsScanning","message","setMessage","messageType","setMessageType","todayAttendances","setTodayAttendances","isLoading","setIsLoading","scannerError","setScannerError","showManualInput","setShowManualInput","manualQrCode","setManualQrCode","isMarkingAbsent","setIsMarkingAbsent","eventType","setEventType","entryExitStats","setEntryExitStats","user","videoRef","qrScannerRef","loadTodayAttendances","loadEntryExitStats","current","destroy","response","supervisors","getDailyAttendance","supervisor_id","id","success","data","attendances","console","error","getEntryExitStats","startScanner","log","stream","navigator","mediaDevices","getUserMedia","video","getTracks","forEach","track","stop","permError","Error","cameras","listCameras","length","result","handleScanResult","onDecodeError","highlightScanRegion","highlightCodeOutline","preferredCamera","maxScansPerSecond","returnDetailedScanResult","start","constructor","name","errorMessage","debugInfo","includes","stopScanner","handleManualSubmit","e","preventDefault","trim","runCameraDiagnostic","devices","enumerateDevices","filter","device","kind","camera","index","label","deviceId","width","height","facingMode","getVideoTracks","getSettings","streamError","qrCameras","qrError","handleMarkAllAbsent","fire","title","html","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","cancelButtonText","isConfirmed","markAllAbsentStudents","attendance_date","Date","toISOString","split","classStatsHtml","Object","entries","class_statistics","map","_ref","className","count","join","absent_students_marked","total_students","present_students","text","qrCode","scanQR","student_qr_code","event_type","eventIcon","event_label","student_name","marked_at","error_details","setTimeout","formatTime","timeString","toLocaleTimeString","hour","minute","fluid","children","lg","Header","Body","variant","size","onClick","disabled","onSubmit","Group","Label","Control","type","placeholder","value","onChange","target","Text","style","position","maxWidth","margin","ref","border","borderRadius","display","alignItems","justifyContent","backgroundColor","xs","global_stats","total_entries","currently_present","total_exits","Footer","bg","maxHeight","overflowY","striped","hover","attendance","_attendance$student","_attendance$school_cl","student","full_name","school_class","is_present","scanned_at"],"sources":["/var/www/College-IUP/front/src/pages/Attendance/AttendanceScanner.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { Card, Button, Alert, Container, Row, Col, Table, Badge, Spinner, ButtonGroup, Form } from 'react-bootstrap';\nimport { QrCodeScan, CheckCircleFill, XCircleFill, Calendar, Clock, ArrowRightCircle, ArrowLeftCircle } from 'react-bootstrap-icons';\nimport { useAuth } from '../../hooks/useAuth';\nimport { secureApiEndpoints } from '../../utils/apiMigration';\nimport QrScanner from 'qr-scanner';\nimport Swal from 'sweetalert2';\n\nconst AttendanceScanner = () => {\n  const [isScanning, setIsScanning] = useState(false);\n  const [message, setMessage] = useState('');\n  const [messageType, setMessageType] = useState('');\n  const [todayAttendances, setTodayAttendances] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [scannerError, setScannerError] = useState('');\n  const [showManualInput, setShowManualInput] = useState(false);\n  const [manualQrCode, setManualQrCode] = useState('');\n  const [isMarkingAbsent, setIsMarkingAbsent] = useState(false);\n  const [eventType, setEventType] = useState('auto'); // 'entry', 'exit' ou 'auto'\n  const [entryExitStats, setEntryExitStats] = useState(null);\n  \n  const { user } = useAuth();\n  const videoRef = useRef(null);\n  const qrScannerRef = useRef(null);\n\n  useEffect(() => {\n    loadTodayAttendances();\n    loadEntryExitStats();\n    return () => {\n      if (qrScannerRef.current) {\n        qrScannerRef.current.destroy();\n      }\n    };\n  }, []);\n\n  const loadTodayAttendances = async () => {\n    try {\n      setIsLoading(true);\n      const response = await secureApiEndpoints.supervisors.getDailyAttendance({\n        supervisor_id: user.id\n      });\n\n      if (response.success) {\n        setTodayAttendances(response.data.attendances || []);\n      } else {\n        console.error('Erreur API:', response.message);\n      }\n    } catch (error) {\n      console.error('Erreur lors du chargement des présences:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const loadEntryExitStats = async () => {\n    try {\n      const response = await secureApiEndpoints.supervisors.getEntryExitStats({\n        supervisor_id: user.id\n      });\n\n      if (response.success) {\n        setEntryExitStats(response.data);\n      } else {\n        console.error('Erreur API stats:', response.message);\n      }\n    } catch (error) {\n      console.error('Erreur lors du chargement des statistiques:', error);\n    }\n  };\n\n  const startScanner = async () => {\n    try {\n      setScannerError('');\n      setIsScanning(true);\n      \n      console.log('🔍 Tentative de démarrage du scanner...');\n      \n      // Vérifier d'abord les permissions de caméra\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n        console.log('✅ Permissions caméra accordées');\n        stream.getTracks().forEach(track => track.stop()); // Arrêter le stream de test\n      } catch (permError) {\n        console.error('❌ Permissions caméra refusées:', permError);\n        throw new Error('Permission denied: ' + permError.message);\n      }\n      \n      // Vérifier les caméras disponibles\n      const cameras = await QrScanner.listCameras(true);\n      console.log('📷 Caméras disponibles:', cameras);\n      \n      if (cameras.length === 0) {\n        throw new Error('Aucune caméra trouvée sur cet appareil');\n      }\n      \n      if (videoRef.current) {\n        // Configuration plus permissive\n        qrScannerRef.current = new QrScanner(\n          videoRef.current,\n          (result) => handleScanResult(result.data),\n          {\n            onDecodeError: error => {\n              // Réduire le bruit des erreurs de décodage\n              // console.log('Scan decode error:', error);\n            },\n            highlightScanRegion: true,\n            highlightCodeOutline: true,\n            preferredCamera: cameras.length > 1 ? 'environment' : cameras[0].id, // Utiliser la première caméra si une seule\n            maxScansPerSecond: 3, // Réduire pour éviter la surcharge\n            returnDetailedScanResult: false,\n          }\n        );\n        \n        console.log('⏳ Démarrage du scanner QR...');\n        await qrScannerRef.current.start();\n        console.log('✅ Scanner QR démarré avec succès');\n        \n        // Masquer le formulaire de saisie manuelle si le scanner fonctionne\n        setShowManualInput(false);\n      }\n    } catch (error) {\n      console.error('❌ Erreur lors du démarrage du scanner:', error);\n      console.error('Type d\\'erreur:', error.constructor.name);\n      console.error('Message:', error.message);\n      \n      let errorMessage = 'Impossible d\\'accéder à la caméra.';\n      let debugInfo = '';\n      \n      if (error.name === 'NotAllowedError' || error.message.includes('Permission denied')) {\n        errorMessage = '🚫 Accès à la caméra refusé par le navigateur.';\n        debugInfo = 'Cliquez sur l\\'icône 🔒 dans la barre d\\'adresse et autorisez la caméra.';\n      } else if (error.name === 'NotFoundError' || error.message.includes('Camera not found')) {\n        errorMessage = '📷 Aucune caméra trouvée.';\n        debugInfo = 'Vérifiez qu\\'une caméra est connectée et fonctionnelle.';\n      } else if (error.name === 'NotSupportedError') {\n        errorMessage = '🌐 Votre navigateur ne supporte pas l\\'accès à la caméra.';\n        debugInfo = 'Essayez avec Chrome, Firefox ou Safari récent.';\n      } else if (error.name === 'NotReadableError') {\n        errorMessage = '⚠️ Caméra occupée par une autre application.';\n        debugInfo = 'Fermez les autres applications utilisant la caméra.';\n      } else {\n        errorMessage = '🔧 Erreur technique du scanner.';\n        debugInfo = `Détails: ${error.message}`;\n      }\n      \n      setScannerError(`${errorMessage} ${debugInfo}`);\n      setIsScanning(false);\n      \n      // Proposer l'alternative de saisie manuelle\n      setShowManualInput(true);\n    }\n  };\n\n  const stopScanner = () => {\n    if (qrScannerRef.current) {\n      qrScannerRef.current.stop();\n      qrScannerRef.current.destroy();\n      qrScannerRef.current = null;\n    }\n    setIsScanning(false);\n    setShowManualInput(false);\n  };\n\n  const handleManualSubmit = async (e) => {\n    e.preventDefault();\n    if (!manualQrCode.trim()) return;\n    \n    await handleScanResult(manualQrCode.trim());\n    setManualQrCode('');\n    setShowManualInput(false);\n  };\n\n  const runCameraDiagnostic = async () => {\n    console.log('🔍 === DIAGNOSTIC CAMÉRA ===');\n    \n    try {\n      // Test 1: Vérifier le support MediaDevices\n      if (!navigator.mediaDevices) {\n        console.log('❌ navigator.mediaDevices non supporté');\n        return;\n      }\n      console.log('✅ navigator.mediaDevices supporté');\n      \n      // Test 2: Lister les appareils\n      const devices = await navigator.mediaDevices.enumerateDevices();\n      const cameras = devices.filter(device => device.kind === 'videoinput');\n      console.log('📷 Caméras détectées:', cameras.length);\n      cameras.forEach((camera, index) => {\n        console.log(`  ${index + 1}. ${camera.label || 'Caméra sans nom'} (${camera.deviceId})`);\n      });\n      \n      // Test 3: Test d'accès simple\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({ \n          video: { \n            width: 640, \n            height: 480,\n            facingMode: 'environment' \n          } \n        });\n        console.log('✅ Accès caméra réussi');\n        console.log('📹 Stream:', stream.getVideoTracks()[0].getSettings());\n        stream.getTracks().forEach(track => track.stop());\n      } catch (streamError) {\n        console.log('❌ Échec accès caméra:', streamError.name, streamError.message);\n      }\n      \n      // Test 4: Test QrScanner\n      try {\n        const qrCameras = await QrScanner.listCameras(true);\n        console.log('📱 QrScanner caméras:', qrCameras.length);\n        qrCameras.forEach((camera, index) => {\n          console.log(`  ${index + 1}. ${camera.label} (${camera.id})`);\n        });\n      } catch (qrError) {\n        console.log('❌ QrScanner erreur:', qrError.message);\n      }\n      \n    } catch (error) {\n      console.log('❌ Erreur diagnostic:', error);\n    }\n    \n    console.log('🔍 === FIN DIAGNOSTIC ===');\n  };\n\n  const handleMarkAllAbsent = async () => {\n    const result = await Swal.fire({\n      title: '📋 Marquer les absents ?',\n      html: `\n        <p>Cette action va marquer comme <strong>absents</strong> tous les élèves qui n'ont pas été enregistrés comme présents aujourd'hui.</p>\n        <div class=\"alert alert-info mt-3\">\n          <strong>ℹ️ Note :</strong> Seuls les élèves qui n'ont <strong>aucune entrée</strong> aujourd'hui seront marqués absents.\n        </div>\n        <p><strong>Êtes-vous sûr de vouloir continuer ?</strong></p>\n      `,\n      icon: 'question',\n      showCancelButton: true,\n      confirmButtonColor: '#d33',\n      cancelButtonColor: '#3085d6',\n      confirmButtonText: '✅ Oui, marquer les absents',\n      cancelButtonText: '❌ Annuler'\n    });\n\n    if (result.isConfirmed) {\n      setIsMarkingAbsent(true);\n      \n      try {\n        const response = await secureApiEndpoints.supervisors.markAllAbsentStudents({\n          supervisor_id: user.id,\n          attendance_date: new Date().toISOString().split('T')[0] // Format YYYY-MM-DD\n        });\n\n        if (response.success) {\n          // Afficher le résultat détaillé\n          const classStatsHtml = Object.entries(response.data.class_statistics || {})\n            .map(([className, count]) => `<li><strong>${className}:</strong> ${count} absent(s)</li>`)\n            .join('');\n\n          await Swal.fire({\n            title: '✅ Absences marquées !',\n            html: `\n              <div class=\"text-left\">\n                <p><strong>${response.data.absent_students_marked}</strong> élève(s) marqué(s) comme absent(s)</p>\n                <hr>\n                <p><strong>📊 Résumé du jour :</strong></p>\n                <ul class=\"list-unstyled\">\n                  <li>👥 <strong>Total élèves :</strong> ${response.data.total_students}</li>\n                  <li>✅ <strong>Présents :</strong> ${response.data.present_students}</li>\n                  <li>❌ <strong>Absents marqués :</strong> ${response.data.absent_students_marked}</li>\n                </ul>\n                ${classStatsHtml ? `\n                <hr>\n                <p><strong>📋 Par classe :</strong></p>\n                <ul>${classStatsHtml}</ul>\n                ` : ''}\n                <div class=\"alert alert-success mt-3\">\n                  <small>📱 Les parents ont été notifiés automatiquement par WhatsApp</small>\n                </div>\n              </div>\n            `,\n            icon: 'success',\n            confirmButtonText: 'Parfait !'\n          });\n\n          // Recharger les données\n          loadTodayAttendances();\n          loadEntryExitStats();\n        } else {\n          Swal.fire({\n            title: 'Erreur',\n            text: response.message || 'Erreur lors du marquage des absences',\n            icon: 'error'\n          });\n        }\n      } catch (error) {\n        console.error('Erreur marquage absences:', error);\n        Swal.fire({\n          title: 'Erreur',\n          text: 'Erreur lors du marquage des absences',\n          icon: 'error'\n        });\n      } finally {\n        setIsMarkingAbsent(false);\n      }\n    }\n  };\n\n  const handleScanResult = async (qrCode) => {\n    try {\n      stopScanner();\n      setIsLoading(true);\n      \n      const response = await secureApiEndpoints.supervisors.scanQR({\n        student_qr_code: qrCode,\n        supervisor_id: user.id,\n        event_type: eventType\n      });\n      \n      if (response.success) {\n        const eventIcon = response.data.event_type === 'entry' ? '🟢' : '🔴';\n        setMessage(`${eventIcon} ${response.data.event_label} de ${response.data.student_name} enregistrée à ${response.data.marked_at}`);\n        setMessageType('success');\n        loadTodayAttendances(); // Recharger la liste\n        loadEntryExitStats(); // Recharger les statistiques\n      } else {\n        // Afficher le message d'erreur détaillé\n        let errorMessage = response.message;\n        if (response.student_name) {\n          errorMessage = `${response.student_name}: ${response.message}`;\n        }\n        setMessage(`❌ ${errorMessage}`);\n        setMessageType('danger');\n      }\n    } catch (error) {\n      console.error('Erreur scan:', error);\n      \n      // Tenter d'extraire un message d'erreur plus détaillé\n      let errorMessage = 'Erreur lors de l\\'enregistrement de la présence';\n      \n      if (error.response && error.response.data) {\n        if (error.response.data.message) {\n          errorMessage = error.response.data.message;\n        } else if (error.response.data.error_details) {\n          errorMessage = `Erreur technique: ${error.response.data.error_details}`;\n        }\n      } else if (error.message) {\n        errorMessage = error.message;\n      }\n      \n      setMessage(`❌ ${errorMessage}`);\n      setMessageType('danger');\n    } finally {\n      setIsLoading(false);\n      // Auto-clear message after 5 seconds\n      setTimeout(() => {\n        setMessage('');\n        setMessageType('');\n      }, 5000);\n    }\n  };\n\n  const formatTime = (timeString) => {\n    if (!timeString) return '';\n    return new Date(`2000-01-01T${timeString}`).toLocaleTimeString('fr-FR', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  return (\n    <Container fluid className=\"py-4\">\n      <Row>\n        <Col>\n          <h2 className=\"mb-4 d-flex align-items-center\">\n            <QrCodeScan className=\"me-2\" />\n            Scanner de Présences\n          </h2>\n        </Col>\n      </Row>\n\n      {/* Scanner Section */}\n      <Row className=\"mb-4\">\n        <Col lg={6}>\n          <Card>\n            <Card.Header>\n              <h5 className=\"mb-0 d-flex align-items-center\">\n                <QrCodeScan className=\"me-2\" />\n                Scanner QR\n              </h5>\n            </Card.Header>\n            <Card.Body>\n              {scannerError && (\n                <Alert variant=\"danger\" className=\"mb-3\">\n                  <div className=\"d-flex align-items-start\">\n                    <div className=\"me-2\">📷</div>\n                    <div>\n                      <strong>Problème de caméra :</strong><br />\n                      {scannerError}\n                      <hr className=\"my-2\" />\n                      <small>\n                        <strong>Solutions :</strong><br />\n                        • Utilisez la <strong>saisie manuelle</strong> ci-dessous<br />\n                        • Cliquez sur l'icône 🔒 dans la barre d'adresse et autorisez la caméra<br />\n                        • Actualisez la page après avoir autorisé<br />\n                        • Fermez les autres onglets/apps utilisant la caméra\n                      </small>\n                      <hr className=\"my-2\" />\n                      <Button \n                        variant=\"outline-info\" \n                        size=\"sm\"\n                        onClick={runCameraDiagnostic}\n                      >\n                        🔍 Diagnostic caméra (voir console)\n                      </Button>\n                    </div>\n                  </div>\n                </Alert>\n              )}\n              \n              {message && (\n                <Alert variant={messageType} className=\"mb-3\">\n                  {message}\n                </Alert>\n              )}\n\n              {/* Event Type Selection */}\n              <div className=\"mb-4\">\n                <h6 className=\"mb-3\">Mode de scan :</h6>\n                <ButtonGroup className=\"w-100\">\n                  <Button\n                    variant={eventType === 'auto' ? 'primary' : 'outline-primary'}\n                    onClick={() => setEventType('auto')}\n                    disabled={isScanning}\n                    size=\"sm\"\n                  >\n                    🤖 Automatique\n                  </Button>\n                  <Button\n                    variant={eventType === 'entry' ? 'success' : 'outline-success'}\n                    onClick={() => setEventType('entry')}\n                    disabled={isScanning}\n                    size=\"sm\"\n                  >\n                    <ArrowRightCircle className=\"me-1\" size={14} />\n                    Entrée\n                  </Button>\n                  <Button\n                    variant={eventType === 'exit' ? 'danger' : 'outline-danger'}\n                    onClick={() => setEventType('exit')}\n                    disabled={isScanning}\n                    size=\"sm\"\n                  >\n                    <ArrowLeftCircle className=\"me-1\" size={14} />\n                    Sortie\n                  </Button>\n                </ButtonGroup>\n                <div className=\"mt-2\">\n                  <small className=\"text-muted\">\n                    {eventType === 'auto' && '🤖 Le système déterminera automatiquement si c\\'est une entrée ou sortie'}\n                    {eventType === 'entry' && '🟢 Mode entrée forcée'}\n                    {eventType === 'exit' && '🔴 Mode sortie forcée'}\n                  </small>\n                </div>\n              </div>\n\n              <div className=\"text-center mb-3\">\n                {!isScanning ? (\n                  <div className=\"d-flex flex-column gap-2\">\n                    <Button \n                      variant=\"primary\" \n                      size=\"lg\"\n                      onClick={startScanner}\n                      disabled={isLoading}\n                    >\n                      {isLoading ? (\n                        <>\n                          <Spinner size=\"sm\" className=\"me-2\" />\n                          Traitement...\n                        </>\n                      ) : (\n                        <>\n                          <QrCodeScan className=\"me-2\" />\n                          Démarrer le Scanner\n                        </>\n                      )}\n                    </Button>\n                    \n                    {!showManualInput ? (\n                      <Button \n                        variant=\"outline-secondary\" \n                        size=\"sm\"\n                        onClick={() => setShowManualInput(true)}\n                        disabled={isLoading}\n                      >\n                        📝 Saisie manuelle\n                      </Button>\n                    ) : (\n                      <Button \n                        variant=\"outline-danger\" \n                        size=\"sm\"\n                        onClick={() => setShowManualInput(false)}\n                      >\n                        ❌ Annuler saisie\n                      </Button>\n                    )}\n                  </div>\n                ) : (\n                  <Button \n                    variant=\"danger\" \n                    size=\"lg\"\n                    onClick={stopScanner}\n                  >\n                    <XCircleFill className=\"me-2\" />\n                    Arrêter le Scanner\n                  </Button>\n                )}\n              </div>\n\n              {/* Manual Input Form */}\n              {showManualInput && (\n                <div className=\"mb-4\">\n                  <Card className=\"border-warning\">\n                    <Card.Header className=\"bg-warning text-dark\">\n                      <h6 className=\"mb-0\">📝 Saisie manuelle du code QR</h6>\n                    </Card.Header>\n                    <Card.Body>\n                      <Form onSubmit={handleManualSubmit}>\n                        <Form.Group className=\"mb-3\">\n                          <Form.Label>Code QR ou ID de l'élève</Form.Label>\n                          <Form.Control\n                            type=\"text\"\n                            placeholder=\"Ex: STUDENT_ID_123 ou 123\"\n                            value={manualQrCode}\n                            onChange={(e) => setManualQrCode(e.target.value)}\n                            disabled={isLoading}\n                          />\n                          <Form.Text className=\"text-muted\">\n                            Saisissez le code QR ou l'ID numérique de l'élève\n                          </Form.Text>\n                        </Form.Group>\n                        <div className=\"d-flex gap-2\">\n                          <Button \n                            type=\"submit\" \n                            variant=\"success\"\n                            disabled={isLoading || !manualQrCode.trim()}\n                          >\n                            {isLoading ? (\n                              <>\n                                <Spinner size=\"sm\" className=\"me-2\" />\n                                Traitement...\n                              </>\n                            ) : (\n                              <>\n                                ✅ Valider\n                              </>\n                            )}\n                          </Button>\n                          <Button \n                            type=\"button\" \n                            variant=\"outline-secondary\"\n                            onClick={() => {\n                              setManualQrCode('');\n                              setShowManualInput(false);\n                            }}\n                            disabled={isLoading}\n                          >\n                            Annuler\n                          </Button>\n                        </div>\n                      </Form>\n                    </Card.Body>\n                  </Card>\n                </div>\n              )}\n\n              {/* Video preview */}\n              <div className=\"scanner-container\" style={{ position: 'relative', maxWidth: '400px', margin: '0 auto' }}>\n                <video\n                  ref={videoRef}\n                  style={{\n                    width: '100%',\n                    height: 'auto',\n                    border: '2px solid #dee2e6',\n                    borderRadius: '8px',\n                    display: isScanning ? 'block' : 'none'\n                  }}\n                />\n                {!isScanning && (\n                  <div \n                    style={{\n                      width: '100%',\n                      height: '300px',\n                      border: '2px dashed #dee2e6',\n                      borderRadius: '8px',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      backgroundColor: '#f8f9fa'\n                    }}\n                  >\n                    <div className=\"text-center text-muted d-flex flex-column align-items-center\">\n                      <QrCodeScan size={48} />\n                      <p className=\"mt-2 mb-0\">Cliquez sur \"Démarrer le Scanner\"</p>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </Card.Body>\n          </Card>\n        </Col>\n\n          {/* Statistics Panel */}\n        <Col lg={6}>\n          <Row className=\"mb-3\">\n            <Col>\n              <Card className=\"border-info\">\n                <Card.Header className=\"bg-info\">\n                  <h6 className=\"mb-0\">📊 Statistiques du Jour</h6>\n                </Card.Header>\n                <Card.Body>\n                  {entryExitStats ? (\n                    <Row>\n                      <Col xs={4} className=\"text-center\">\n                        <div className=\"d-flex flex-column\">\n                          <div className=\"text-success fs-4 fw-bold\">{entryExitStats.global_stats.total_entries}</div>\n                          <small className=\"text-muted\">Entrées</small>\n                        </div>\n                      </Col>\n                      <Col xs={4} className=\"text-center\">\n                        <div className=\"d-flex flex-column\">\n                          <div className=\"text-primary fs-4 fw-bold\">{entryExitStats.global_stats.currently_present}</div>\n                          <small className=\"text-muted\">Présents</small>\n                        </div>\n                      </Col>\n                      <Col xs={4} className=\"text-center\">\n                        <div className=\"d-flex flex-column\">\n                          <div className=\"text-danger fs-4 fw-bold\">{entryExitStats.global_stats.total_exits}</div>\n                          <small className=\"text-muted\">Sorties</small>\n                        </div>\n                      </Col>\n                    </Row>\n                  ) : (\n                    <div className=\"text-center text-muted\">\n                      <Spinner size=\"sm\" className=\"me-2\" />\n                      Chargement des statistiques...\n                    </div>\n                  )}\n                </Card.Body>\n                <Card.Footer className=\"text-center\">\n                  <Button\n                    variant=\"warning\"\n                    size=\"sm\"\n                    onClick={handleMarkAllAbsent}\n                    disabled={isMarkingAbsent || isLoading}\n                  >\n                    {isMarkingAbsent ? (\n                      <>\n                        <Spinner size=\"sm\" className=\"me-2\" />\n                        Marquage en cours...\n                      </>\n                    ) : (\n                      <>\n                        📋 Marquer les absents\n                      </>\n                    )}\n                  </Button>\n                  <div className=\"mt-2\">\n                    <small className=\"text-muted\">\n                      Marque comme absents tous les élèves sans entrée aujourd'hui\n                    </small>\n                  </div>\n                </Card.Footer>\n              </Card>\n            </Col>\n          </Row>\n          \n          {/* Today's Attendance List */}\n          <Card>\n            <Card.Header>\n              <h5 className=\"mb-0 d-flex align-items-center\">\n                <Calendar className=\"me-2\" />\n                Présences d'Aujourd'hui\n                <Badge bg=\"primary\" className=\"ms-2\">\n                  {todayAttendances.length}\n                </Badge>\n              </h5>\n            </Card.Header>\n            <Card.Body>\n              {isLoading ? (\n                <div className=\"text-center py-4\">\n                  <Spinner />\n                  <p className=\"mt-2 text-muted\">Chargement...</p>\n                </div>\n              ) : todayAttendances.length > 0 ? (\n                <div style={{ maxHeight: '400px', overflowY: 'auto' }}>\n                  <Table striped hover size=\"sm\">\n                    <thead>\n                      <tr>\n                        <th>Élève</th>\n                        <th>Classe</th>\n                        <th>Type</th>\n                        <th>Heure</th>\n                        <th>Statut</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {todayAttendances.map((attendance, index) => (\n                        <tr key={index}>\n                          <td>{attendance.student?.full_name || 'N/A'}</td>\n                          <td>{attendance.school_class?.name || 'N/A'}</td>\n                          <td>\n                            {attendance.is_present ? (\n                              <Badge bg={attendance.event_type === 'entry' ? 'success' : 'info'}>\n                                {attendance.event_type === 'entry' ? (\n                                  <>\n                                    <ArrowRightCircle size={12} className=\"me-1\" />\n                                    Entrée\n                                  </>\n                                ) : (\n                                  <>\n                                    <ArrowLeftCircle size={12} className=\"me-1\" />\n                                    Sortie\n                                  </>\n                                )}\n                              </Badge>\n                            ) : (\n                              <Badge bg=\"danger\">\n                                ❌ Absent\n                              </Badge>\n                            )}\n                          </td>\n                          <td>\n                            <Clock size={14} className=\"me-1\" />\n                            {formatTime(attendance.scanned_at)}\n                          </td>\n                          <td>\n                            <Badge bg={attendance.is_present ? 'success' : 'danger'}>\n                              {attendance.is_present ? (\n                                <>\n                                  <CheckCircleFill size={12} className=\"me-1\" />\n                                  Présent\n                                </>\n                              ) : (\n                                <>\n                                  <XCircleFill size={12} className=\"me-1\" />\n                                  Absent\n                                </>\n                              )}\n                            </Badge>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </Table>\n                </div>\n              ) : (\n                <div className=\"text-center py-4 text-muted\">\n                  <Calendar size={48} />\n                  <p className=\"mt-2 mb-0\">Aucune présence enregistrée aujourd'hui</p>\n                </div>\n              )}\n            </Card.Body>\n          </Card>\n        </Col>\n      </Row>\n\n      {/* Instructions */}\n      <Row>\n        <Col>\n          <Card className=\"border-info\">\n            <Card.Header className=\"bg-info text-white\">\n              <h6 className=\"mb-0\">Instructions d'utilisation - Entrées/Sorties</h6>\n            </Card.Header>\n            <Card.Body>\n              <ol className=\"mb-3\">\n                <li><strong>🤖 Mode Automatique (Recommandé) :</strong> Le système détecte automatiquement si l'élève doit entrer ou sortir</li>\n                <li><strong>🎯 Mode Manuel :</strong> Choisissez \"Entrée\" ou \"Sortie\" selon le besoin</li>\n                <li><strong>📷 Scanner Caméra :</strong> Cliquez sur \"Démarrer le Scanner\" et dirigez vers le code QR</li>\n                <li><strong>📝 Saisie Manuelle :</strong> Si la caméra ne fonctionne pas, utilisez \"Saisie manuelle\"</li>\n                <li><strong>📋 Gestion des Absences :</strong> Utilisez \"Marquer les absents\" pour marquer automatiquement tous les élèves sans entrée</li>\n                <li>Le système vérifie automatiquement les conditions (pas de double entrée/sortie)</li>\n                <li>Les parents reçoivent une notification WhatsApp automatique</li>\n                <li>Consultez les statistiques et la liste des mouvements du jour</li>\n              </ol>\n              \n              <div className=\"alert alert-info mb-3\">\n                <strong>💡 Astuce :</strong> En cas de problème de caméra, vous pouvez toujours utiliser la saisie manuelle en saisissant directement l'ID de l'élève (ex: 123) ou le code QR complet (ex: STUDENT_ID_123).\n              </div>\n              \n              <div className=\"alert alert-warning mb-0\">\n                <strong>📋 Absences :</strong> Les <strong>sorties</strong> ne sont pas des absences ! Elles indiquent simplement que l'élève est parti. Utilisez le bouton \"Marquer les absents\" pour les élèves qui ne sont jamais venus à l'école.\n              </div>\n            </Card.Body>\n          </Card>\n        </Col>\n      </Row>\n    </Container>\n  );\n};\n\nexport default AttendanceScanner;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}