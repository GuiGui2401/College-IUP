{"ast":null,"code":"import{useEffect,useState}from\"react\";import{Alert,Badge,Button,Card,Col,Container,Form,Modal,Row,Spinner,Table}from\"react-bootstrap\";import{ArrowLeft,Calendar,CashCoin,Check,CreditCard,Printer,Receipt}from\"react-bootstrap-icons\";import{useNavigate,useParams}from\"react-router-dom\";import Swal from\"sweetalert2\";import RameStatusToggle from\"../../components/RameStatusToggle\";import{useSchool}from\"../../contexts/SchoolContext\";import{secureApiEndpoints}from\"../../utils/apiMigration\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const StudentPayment=()=>{var _student$classSeries,_student$classSeries$,_student$classSeries2;const{studentId}=useParams();const navigate=useNavigate();const{schoolSettings,formatCurrency,getLogoUrl}=useSchool();const[student,setStudent]=useState(null);const[paymentStatus,setPaymentStatus]=useState([]);const[paymentHistory,setPaymentHistory]=useState([]);const[schoolYear,setSchoolYear]=useState(null);const[totals,setTotals]=useState({required:0,paid:0,remaining:0,scholarship_amount:0,has_scholarships:false});const[discountInfo,setDiscountInfo]=useState({eligible_for_scholarship:false,scholarship_amount:0,eligible_for_reduction:false,reduction_percentage:0,deadline:null,reasons:[]});// Variable supprimée - logique intégrée dans le modal\n// Variables supprimées - ancienne logique de réduction\nconst[showPaymentModal,setShowPaymentModal]=useState(false);const[showReceiptModal,setShowReceiptModal]=useState(false);const[receiptHtml,setReceiptHtml]=useState(\"\");const[loading,setLoading]=useState(true);const[paymentLoading,setPaymentLoading]=useState(false);const[error,setError]=useState(\"\");const[success,setSuccess]=useState(\"\");const[isPrintingReceipt,setIsPrintingReceipt]=useState(false);const[printWindow,setPrintWindow]=useState(null);const[currentPaymentId,setCurrentPaymentId]=useState(null);const[paymentForm,setPaymentForm]=useState({amount:\"\",payment_method:\"cash\",reference_number:\"\",notes:\"\",payment_date:new Date().toISOString().split(\"T\")[0],versement_date:new Date().toISOString().split(\"T\")[0],is_rame_physical:false,rame_choice:\"none\",// Par défaut: ne pas payer la RAME\napply_discount:false// Nouvelle option pour appliquer la réduction\n});// États pour la gestion de la réduction dans le modal\nconst[modalDiscountInfo,setModalDiscountInfo]=useState(null);const[isCheckingDiscount,setIsCheckingDiscount]=useState(false);useEffect(()=>{loadStudentPaymentInfo();loadPaymentHistory();},[studentId]);const loadStudentPaymentInfo=async()=>{try{setLoading(true);const response=await secureApiEndpoints.payments.getStudentInfo(studentId);console.log(response);if(response.success){console.log(response);setStudent(response.data.student);setPaymentStatus(response.data.payment_status);setSchoolYear(response.data.school_year);// Calculer le total des réductions globales appliquées\nlet totalGlobalDiscountAmount=0;let hasGlobalDiscounts=false;if(response.data.payment_status&&Array.isArray(response.data.payment_status)){response.data.payment_status.forEach(status=>{if(status.has_global_discount&&status.global_discount_amount>0){totalGlobalDiscountAmount+=parseFloat(status.global_discount_amount);hasGlobalDiscounts=true;}});}// Gérer les montants (toujours normaux maintenant)\nconst currentTotals={required:response.data.total_required,// Montants normaux\npaid:response.data.total_paid,remaining:response.data.total_remaining,scholarship_amount:response.data.total_scholarship_amount||0,has_scholarships:response.data.has_scholarships||false,global_discount_amount:totalGlobalDiscountAmount,has_global_discounts:hasGlobalDiscounts};setTotals(currentTotals);// Code simplifié - plus besoin de tracking des réductions existantes\nsetDiscountInfo({eligible_for_scholarship:false,scholarship_amount:0,eligible_for_reduction:false,reduction_percentage:0,deadline:null,reasons:[],...(response.data.discount_info||{})});// Plus besoin de vérifier l'éligibilité au chargement initial\n}else{setError(response.message);}}catch(error){setError(\"Erreur lors du chargement des informations de paiement\");console.error(\"Error loading payment info:\",error);}finally{setLoading(false);}};const loadPaymentHistory=async()=>{try{const response=await secureApiEndpoints.payments.getStudentHistory(studentId);if(response.success){setPaymentHistory(response.data);}}catch(error){console.error(\"Error loading payment history:\",error);}};// Réinitialiser le formulaire quand le modal se ferme\nconst handleModalClose=()=>{setShowPaymentModal(false);setModalDiscountInfo(null);setPaymentForm(prev=>({...prev,amount:\"\",apply_discount:false,versement_date:new Date().toISOString().split(\"T\")[0]}));};// Fonction pour payer la RAME physiquement\nconst handlePayRame=async()=>{const result=await Swal.fire({title:\"Payer la RAME physiquement\",html:`\n                <p>Confirmez-vous que l'étudiant <strong>${student===null||student===void 0?void 0:student.first_name} ${student===null||student===void 0?void 0:student.last_name}</strong> a apporté sa RAME physiquement ?</p>\n                <div class=\"mt-3\">\n                    <label for=\"rameNotes\" class=\"form-label\">Notes (optionnel):</label>\n                    <textarea id=\"rameNotes\" class=\"form-control\" placeholder=\"Commentaires sur le paiement RAME...\"></textarea>\n                </div>\n            `,icon:\"question\",showCancelButton:true,confirmButtonText:\"Oui, marquer comme payé\",cancelButtonText:\"Annuler\",confirmButtonColor:\"#28a745\",cancelButtonColor:\"#6c757d\",preConfirm:()=>{const notes=document.getElementById(\"rameNotes\").value;return{notes};}});if(result.isConfirmed){try{setPaymentLoading(true);const response=await secureApiEndpoints.payments.payRamePhysically(studentId,{notes:result.value.notes||\"RAME apportée physiquement\",reference_number:\"RAME-PHYS-\"+new Date().getTime()});if(response.success){Swal.fire({title:\"Succès !\",text:\"RAME marquée comme payée physiquement\",icon:\"success\",timer:2000,showConfirmButton:false});// Recharger les données\nawait loadStudentPaymentInfo();await loadPaymentHistory();}else{throw new Error(response.message||\"Erreur lors du paiement RAME\");}}catch(error){console.error(\"Error paying RAME:\",error);Swal.fire({title:\"Erreur\",text:error.message||\"Erreur lors du paiement RAME\",icon:\"error\"});}finally{setPaymentLoading(false);}}};// Anciennes fonctions supprimées - logique intégrée dans le modal\n// Fonction pour paiement rapide sans modal\nconst handleQuickPayment=async()=>{// Calculer le montant avec bourse (conversion en nombres)\nconst amountWithScholarship=Math.max(0,parseFloat(totals.remaining)-parseFloat(totals.scholarship_amount));// Vérifier l'éligibilité aux réductions pour le paiement rapide\nlet quickDiscountInfo=null;let amountWithDiscount=totals.remaining;try{// Utiliser la même logique que le modal normal\nconst discountResponse=await secureApiEndpoints.payments.getStudentInfoWithDiscount(studentId);if(discountResponse.success&&discountResponse.data.discount_deadline&&!totals.has_scholarships){const deadlineDate=new Date(discountResponse.data.discount_deadline);const versementDate=new Date();// Date actuelle pour paiement rapide\nif(versementDate<=deadlineDate){// Calculer le montant avec réduction\nconst totalRequired=discountResponse.data.total_required;const totalPaid=discountResponse.data.total_paid;const discountPercentage=discountResponse.data.discount_percentage;const discountAmount=(totalRequired-totalPaid)*(discountPercentage/100);quickDiscountInfo={discount_percentage:discountPercentage,discount_amount:discountAmount,deadline:discountResponse.data.discount_deadline,normal_totals:{total_required:totalRequired,total_paid:totalPaid}};amountWithDiscount=totalRequired-totalPaid-discountAmount;}}}catch(error){console.log(\"Erreur lors de la vérification de l'éligibilité aux réductions pour paiement rapide:\",error);}const result=await Swal.fire({title:\"Paiement Rapide\",html:`\n                <div class=\"text-start\">\n                    <p><strong>Étudiant:</strong> ${student===null||student===void 0?void 0:student.first_name} ${student===null||student===void 0?void 0:student.last_name}</p>\n                    <p><strong>Montant restant:</strong> ${formatAmount(totals.remaining)}</p>\n                    ${totals.has_scholarships?`\n                        <div class=\"alert alert-success mb-3\">\n                            <strong>🎉 Avec votre bourse:</strong><br>\n                            ${formatAmount(totals.remaining)} - ${formatAmount(totals.scholarship_amount)} = \n                            <strong>${formatAmount(amountWithScholarship)}</strong>\n                        </div>\n                    `:quickDiscountInfo?`\n                        <div class=\"alert alert-info mb-3\">\n                            <strong>💰 Réduction disponible (${quickDiscountInfo.discount_percentage}%):</strong><br>\n                            ${formatAmount(totals.remaining)} - ${formatAmount(quickDiscountInfo.discount_amount)} = \n                            <strong>${formatAmount(amountWithDiscount)}</strong>\n                            <br><small>Paiement intégral avant le ${new Date(quickDiscountInfo.deadline).toLocaleDateString(\"fr-FR\")}</small>\n                        </div>\n                    `:\"\"}\n                    <hr>\n                    <div class=\"mb-3\">\n                        <label for=\"quickAmount\" class=\"form-label\">Montant à payer *</label>\n                        <input type=\"number\" id=\"quickAmount\" class=\"form-control\" \n                               value=\"${totals.has_scholarships?amountWithScholarship:quickDiscountInfo?amountWithDiscount:totals.remaining}\" \n                               min=\"1\" max=\"${totals.remaining}\">\n                    </div>\n                    ${quickDiscountInfo?`\n                        <div class=\"mb-3\">\n                            <div class=\"form-check\">\n                                <input class=\"form-check-input\" type=\"checkbox\" id=\"quickApplyDiscount\" checked>\n                                <label class=\"form-check-label\" for=\"quickApplyDiscount\">\n                                    Appliquer la réduction de ${quickDiscountInfo.discount_percentage}%\n                                </label>\n                            </div>\n                        </div>\n                    `:\"\"}\n                    <div class=\"mb-3\">\n                        <label for=\"quickVersementDate\" class=\"form-label\">Date de versement *</label>\n                        <input type=\"date\" id=\"quickVersementDate\" class=\"form-control\" \n                               value=\"${new Date().toISOString().split(\"T\")[0]}\" required>\n                    </div>\n                    <div class=\"mb-3\">\n                        <label for=\"quickMethod\" class=\"form-label\">Méthode de paiement *</label>\n                        <select id=\"quickMethod\" class=\"form-select\">\n                            <option value=\"cash\">Banque</option>\n                            <option value=\"card\">Carte bancaire</option>\n                            <option value=\"transfer\">Virement</option>\n                            <option value=\"check\">Chèque</option>\n                        </select>\n                    </div>\n                    <div class=\"mb-3\">\n                        <label for=\"quickReference\" class=\"form-label\">Référence (optionnel)</label>\n                        <input type=\"text\" id=\"quickReference\" class=\"form-control\" \n                               placeholder=\"Numéro de référence\">\n                    </div>\n                    <div class=\"mb-3\">\n                        <label for=\"quickNotes\" class=\"form-label\">Notes (optionnel)</label>\n                        <textarea id=\"quickNotes\" class=\"form-control\" rows=\"2\" \n                                  placeholder=\"Commentaires sur le paiement\"></textarea>\n                    </div>\n                </div>\n            `,icon:\"question\",showCancelButton:true,confirmButtonText:\"💳 Enregistrer le Paiement\",cancelButtonText:\"Annuler\",confirmButtonColor:\"#28a745\",cancelButtonColor:\"#6c757d\",width:\"500px\",didOpen:()=>{// Gestionnaire pour la checkbox de réduction\nconst discountCheckbox=document.getElementById(\"quickApplyDiscount\");const amountInput=document.getElementById(\"quickAmount\");if(discountCheckbox&&amountInput&&quickDiscountInfo){discountCheckbox.addEventListener(\"change\",()=>{if(discountCheckbox.checked){amountInput.value=amountWithDiscount;}else{amountInput.value=totals.remaining;}});}},preConfirm:()=>{const amount=parseFloat(document.getElementById(\"quickAmount\").value);const versementDate=document.getElementById(\"quickVersementDate\").value;const method=document.getElementById(\"quickMethod\").value;const reference=document.getElementById(\"quickReference\").value.trim();const notes=document.getElementById(\"quickNotes\").value.trim();const applyDiscountCheckbox=document.getElementById(\"quickApplyDiscount\");const applyDiscount=applyDiscountCheckbox?applyDiscountCheckbox.checked:false;if(!amount||amount<=0){Swal.showValidationMessage(\"Veuillez saisir un montant valide\");return false;}if(amount>totals.remaining){Swal.showValidationMessage(\"Le montant ne peut pas dépasser le montant restant\");return false;}if(!versementDate){Swal.showValidationMessage(\"Veuillez sélectionner une date de versement\");return false;}return{amount:amount,payment_method:method,reference_number:reference||\"\",notes:notes||\"\",payment_date:new Date().toISOString().split(\"T\")[0],versement_date:versementDate,apply_global_discount:applyDiscount};}});if(result.isConfirmed){try{setPaymentLoading(true);const response=await secureApiEndpoints.payments.create({student_id:parseInt(studentId),...result.value});if(response.success){Swal.fire({title:\"Paiement Enregistré !\",text:`Paiement de ${formatAmount(result.value.amount)} enregistré avec succès`,icon:\"success\",timer:3000,showConfirmButton:false});// Recharger les données\nawait loadStudentPaymentInfo();await loadPaymentHistory();}else{throw new Error(response.message||\"Erreur lors de l'enregistrement du paiement\");}}catch(error){console.error(\"Error in quick payment:\",error);Swal.fire({title:\"Erreur\",text:error.message||\"Erreur lors de l'enregistrement du paiement\",icon:\"error\"});}finally{setPaymentLoading(false);}}};// Fonction supprimée - logique maintenant intégrée dans le modal principal\n// Fonction supprimée - logique intégrée dans le modal\n// Fonction pour vérifier l'éligibilité aux réductions dans le modal\nconst checkDiscountEligibilityInModal=async versementDate=>{if(!studentId||!versementDate){setModalDiscountInfo(null);return;}setIsCheckingDiscount(true);try{const response=await secureApiEndpoints.payments.getStudentInfoWithDiscount(studentId);if(response.success){console.log(\"Discount response data:\",response.data);// Vérifier si une date limite existe\nif(!response.data.discount_deadline){console.log(\"No discount deadline found - should be eligible\");setModalDiscountInfo(response.data);return;}// Vérifier si la date de versement est dans les délais\nconst selectedDate=new Date(versementDate);// Parser la date française DD/MM/YYYY vers le format ISO\nconst parseFrenchDate=dateStr=>{const parts=dateStr.split(\"/\");if(parts.length===3){// Convertir DD/MM/YYYY vers YYYY-MM-DD\nreturn new Date(`${parts[2]}-${parts[1].padStart(2,\"0\")}-${parts[0].padStart(2,\"0\")}`);}return new Date(dateStr);// Fallback\n};const deadline=parseFrenchDate(response.data.discount_deadline);// Vérifier que les dates sont valides\nif(isNaN(selectedDate.getTime())||isNaN(deadline.getTime())){console.error(\"Invalid dates:\",{versementDate,discount_deadline:response.data.discount_deadline,selectedDateValid:!isNaN(selectedDate.getTime()),deadlineValid:!isNaN(deadline.getTime())});setModalDiscountInfo({not_eligible:true,message:\"Erreur de format de date\"});return;}console.log(\"Date comparison:\",{selectedDate:selectedDate.toDateString(),deadline:deadline.toDateString(),versementDate:versementDate,discount_deadline:response.data.discount_deadline,isValid:selectedDate<=deadline});if(selectedDate<=deadline){setModalDiscountInfo(response.data);}else{setModalDiscountInfo({...response.data,is_date_expired:true,deadline_message:`Date limite dépassée (${response.data.discount_deadline})`});}}else{// Étudiant non éligible aux réductions\nsetModalDiscountInfo({not_eligible:true,message:response.message,reasons:response.reasons||[]});}}catch(error){console.error(\"Error checking discount eligibility in modal:\",error);setModalDiscountInfo(null);}finally{setIsCheckingDiscount(false);}};// Fonction pour gérer l'activation/désactivation de la réduction dans le modal\nconst handleDiscountToggle=isChecked=>{setPaymentForm(prev=>{const newForm={...prev,apply_discount:isChecked};if(isChecked&&modalDiscountInfo&&!modalDiscountInfo.not_eligible&&!modalDiscountInfo.is_date_expired){// Appliquer le montant avec réduction\nnewForm.amount=modalDiscountInfo.payment_amount_required.toString();}else{// Revenir au montant par défaut (reste à payer)\nnewForm.amount=totals.remaining.toString();}return newForm;});};// Fonction pour gérer les changements de montant\nconst handleAmountChange=newAmount=>{setPaymentForm(prev=>({...prev,amount:newAmount}));};const handlePaymentSubmit=async e=>{e.preventDefault();// Validation\nif(!paymentForm.amount||parseFloat(paymentForm.amount)<=0){setError(\"Veuillez saisir un montant valide\");return;}if(parseFloat(paymentForm.amount)>totals.remaining){setError(`Le montant saisi (${formatCurrency(parseInt(paymentForm.amount))}) est supérieur au montant restant (${formatCurrency(totals.remaining)}). Veuillez saisir un montant inférieur ou égal au solde restant.`);return;}// NOUVELLE VALIDATION : Vérifier la cohérence entre la case cochée et le montant\nif(paymentForm.apply_discount&&modalDiscountInfo&&!modalDiscountInfo.not_eligible&&!modalDiscountInfo.is_date_expired){const expectedAmount=modalDiscountInfo.payment_amount_required;const paymentAmount=parseFloat(paymentForm.amount);if(Math.abs(paymentAmount-expectedAmount)>0.01){Swal.fire({title:\"Montant incorrect pour la réduction\",html:`\n                        <div class=\"text-left\">\n                            <p>Pour appliquer la réduction, le montant doit être exactement :</p>\n                            <p><strong>${formatAmount(expectedAmount)}</strong></p>\n                            <p>Montant actuel : <strong>${formatAmount(paymentAmount)}</strong></p>\n                        </div>\n                    `,icon:\"warning\"});return;}}// Validation si réduction cochée mais conditions non remplies\nif(paymentForm.apply_discount&&(!modalDiscountInfo||modalDiscountInfo.not_eligible||modalDiscountInfo.is_date_expired)){Swal.fire({title:\"Réduction non disponible\",text:\"Les conditions pour la réduction ne sont pas remplies. Veuillez décocher l'option ou modifier la date de versement.\",icon:\"warning\"});return;}try{setPaymentLoading(true);setError(\"\");const paymentData={student_id:parseInt(studentId),amount:parseFloat(paymentForm.amount),payment_method:paymentForm.payment_method,reference_number:paymentForm.reference_number||null,notes:paymentForm.notes||null,payment_date:paymentForm.payment_date,versement_date:paymentForm.versement_date,apply_global_discount:paymentForm.apply_discount// Indiquer au backend d'appliquer la réduction\n};const response=await secureApiEndpoints.payments.create(paymentData);if(response.success){setSuccess(\"Paiement enregistré avec succès\");setShowPaymentModal(false);// Réinitialiser le formulaire\nsetPaymentForm({amount:\"\",payment_method:\"cash\",reference_number:\"\",notes:\"\",payment_date:new Date().toISOString().split(\"T\")[0],versement_date:new Date().toISOString().split(\"T\")[0],is_rame_physical:false,rame_choice:\"none\",apply_discount:false});setModalDiscountInfo(null);// Recharger les données\nawait loadStudentPaymentInfo();await loadPaymentHistory();// Proposer d'imprimer le reçu\nconst printResult=await Swal.fire({title:\"Paiement enregistré !\",text:\"Voulez-vous imprimer le reçu maintenant ?\",icon:\"success\",showCancelButton:true,confirmButtonText:\"Imprimer le reçu\",cancelButtonText:\"Plus tard\"});if(printResult.isConfirmed){handlePrintReceipt(response.data.id);}}else{setError(response.message||\"Erreur lors de l'enregistrement du paiement\");}}catch(error){setError(\"Erreur lors de l'enregistrement du paiement\");console.error(\"Error creating payment:\",error);}finally{setPaymentLoading(false);}};const handlePrintReceipt=async paymentId=>{if(isPrintingReceipt)return;// Éviter les appels multiples\ntry{setIsPrintingReceipt(true);const response=await secureApiEndpoints.payments.generateReceipt(paymentId);if(response.success){setReceiptHtml(response.data.html);setCurrentPaymentId(paymentId);setShowReceiptModal(true);}else{setError(\"Erreur lors de la génération du reçu\");}}catch(error){setError(\"Erreur lors de la génération du reçu\");console.error(\"Error generating receipt:\",error);}finally{setIsPrintingReceipt(false);}};const handlePrintReceiptFromHistory=async paymentId=>{await handlePrintReceipt(paymentId);};const handleDownloadPDFFromHistory=async paymentId=>{if(isPrintingReceipt)return;try{setIsPrintingReceipt(true);await secureApiEndpoints.payments.downloadReceiptPDF(paymentId);setSuccess(\"Le reçu PDF a été téléchargé avec succès\");}catch(error){console.error('Erreur lors du téléchargement PDF:',error);setError('Erreur lors du téléchargement du PDF: '+error.message);}finally{setIsPrintingReceipt(false);}};const downloadReceiptPDF=async()=>{if(isPrintingReceipt)return;try{setIsPrintingReceipt(true);if(!currentPaymentId){setError(\"Impossible de déterminer l'ID du paiement\");return;}await secureApiEndpoints.payments.downloadReceiptPDF(currentPaymentId);setSuccess(\"Le reçu PDF a été téléchargé avec succès\");}catch(error){console.error('Erreur lors du téléchargement PDF:',error);setError('Erreur lors du téléchargement du PDF: '+error.message);}finally{setIsPrintingReceipt(false);}};const printReceipt=()=>{if(isPrintingReceipt)return;// Éviter les doubles ouvertures\n// Fermer la fenêtre précédente si elle existe\nif(printWindow&&!printWindow.closed){printWindow.close();}setIsPrintingReceipt(true);const newPrintWindow=window.open(\"\",\"_blank\");// Vérifier si la fenêtre a pu être créée (popups non bloqués)\nif(!newPrintWindow){setIsPrintingReceipt(false);setError(\"Impossible d'ouvrir la fenêtre d'impression. Veuillez autoriser les popups pour ce site.\");return;}setPrintWindow(newPrintWindow);// Extraire le numéro de reçu depuis le HTML pour un titre unique\nconst receiptNumberMatch=receiptHtml.match(/Reçu N° :\\s*([^<]+)/);const receiptNumber=receiptNumberMatch?receiptNumberMatch[1].trim():new Date().toISOString().slice(0,19).replace(/[-:]/g,\"\").replace(\"T\",\"_\");try{newPrintWindow.document.write(`\n            <html>\n                <head>\n                    <title>Reçu_${receiptNumber}</title>\n                    <style>\n                        @page {\n                            size: A4 landscape;\n                            margin: 1cm;\n                        }\n                        \n                        body { \n                            font-family: Arial, sans-serif; \n                            margin: 0; \n                            padding: 0;\n                            font-size: 9px;\n                            line-height: 1.3;\n                        }\n                        \n                        @media print { \n                            body { \n                                margin: 0; \n                                -webkit-print-color-adjust: exact;\n                                print-color-adjust: exact;\n                            }\n                            .no-print { \n                                display: none !important; \n                            }\n                        }\n                        \n                        @media screen {\n                            body {\n                                background: #f0f0f0;\n                                padding: 20px;\n                            }\n                            \n                            .receipt-container {\n                                background: white;\n                                width: 294mm;  /* Deux reçus côte à côte (147mm x 2) */\n                                height: 148mm; /* Hauteur à 148mm */\n                                margin: 0 auto;\n                                box-shadow: 0 0 10px rgba(0,0,0,0.1);\n                            }\n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class=\"receipt-container\">\n                        ${receiptHtml}\n                    </div>\n                    <div class=\"no-print\" style=\"text-align: center; margin-top: 30px; background: white; padding: 20px;\">\n                        <button onclick=\"window.print(); setTimeout(() => window.close(), 2000);\" style=\"padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;\">📄 Imprimer & Fermer</button>\n                        <button onclick=\"window.close()\" style=\"padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;\">✖️ Fermer Maintenant</button>\n                        <div style=\"margin-top: 15px; font-size: 12px; color: #666;\">\n                            <p>📋 <strong>Instructions :</strong></p>\n                            <ul style=\"text-align: left; max-width: 500px; margin: 0 auto;\">\n                                <li>Configurez votre imprimante sur format <strong>A4 Paysage</strong></li>\n                                <li>Le reçu contient 2 exemplaires côte à côte</li>\n                                <li><strong>Côté gauche :</strong> Exemplaire parents</li>\n                                <li><strong>Côté droit :</strong> Exemplaire collège</li>\n                                <li>Découpez au milieu vertical pour séparer les exemplaires</li>\n                            </ul>\n                        </div>\n                    </div>\n                </body>\n            </html>\n        `);newPrintWindow.document.close();// Libérer le verrou après un délai pour permettre l'ouverture de la fenêtre\nsetTimeout(()=>{setIsPrintingReceipt(false);},1000);// Écouter la fermeture de la fenêtre pour libérer le verrou plus tôt si possible\nif(newPrintWindow){const checkClosed=setInterval(()=>{if(newPrintWindow.closed){setIsPrintingReceipt(false);setPrintWindow(null);clearInterval(checkClosed);}},500);// Nettoyer l'intervalle après 30 secondes au maximum\nsetTimeout(()=>{clearInterval(checkClosed);setIsPrintingReceipt(false);setPrintWindow(null);},30000);}}catch(error){console.error('Erreur lors de l\\'ouverture de la fenêtre d\\'impression:',error);setError('Erreur lors de l\\'ouverture de la fenêtre d\\'impression. Veuillez réessayer.');setIsPrintingReceipt(false);setPrintWindow(null);}};const formatAmount=amount=>{return formatCurrency(parseInt(amount));};const formatDate=dateString=>{return new Date(dateString).toLocaleDateString(\"fr-FR\");};const getPaymentMethodLabel=function(method){let isRamePhysical=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(isRamePhysical){return\"RAME Physique\";}const methods={cash:\"Banque\",card:\"Carte\",transfer:\"Virement\",check:\"Chèque\"};return methods[method]||method;};if(loading){return/*#__PURE__*/_jsx(Container,{fluid:true,className:\"py-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",children:/*#__PURE__*/_jsx(Spinner,{animation:\"border\",role:\"status\",children:/*#__PURE__*/_jsx(\"span\",{className:\"visually-hidden\",children:\"Chargement...\"})})})});}if(!student){return/*#__PURE__*/_jsx(Container,{fluid:true,className:\"py-4\",children:/*#__PURE__*/_jsx(Alert,{variant:\"danger\",children:\"\\xC9tudiant non trouv\\xE9 ou erreur lors du chargement des donn\\xE9es.\"})});}return/*#__PURE__*/_jsxs(Container,{fluid:true,className:\"py-4\",children:[/*#__PURE__*/_jsx(Row,{className:\"mb-4\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",size:\"sm\",onClick:()=>navigate(-1),className:\"me-3\",children:/*#__PURE__*/_jsx(ArrowLeft,{size:16})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"mb-1\",children:[\"Paiement - \",student.last_name,\" \",student.first_name]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted mb-0\",children:[(_student$classSeries=student.classSeries)===null||_student$classSeries===void 0?void 0:(_student$classSeries$=_student$classSeries.schoolClass)===null||_student$classSeries$===void 0?void 0:_student$classSeries$.name,\" -\",\" \",(_student$classSeries2=student.classSeries)===null||_student$classSeries2===void 0?void 0:_student$classSeries2.name,\" | \",schoolYear===null||schoolYear===void 0?void 0:schoolYear.name]})]})]}),totals.remaining<=0?/*#__PURE__*/_jsxs(Button,{variant:\"success\",disabled:true,children:[/*#__PURE__*/_jsx(CashCoin,{size:16,className:\"me-2\"}),\"Paiements Complets\"]}):/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:()=>{setShowPaymentModal(true);// Réinitialiser les états du modal\nsetModalDiscountInfo(null);setPaymentForm(prev=>({...prev,amount:\"\",apply_discount:false,versement_date:new Date().toISOString().split(\"T\")[0]}));},children:[/*#__PURE__*/_jsx(CashCoin,{size:16,className:\"me-2\"}),\"Nouveau Paiement\"]})]})})}),error&&/*#__PURE__*/_jsx(Alert,{variant:\"danger\",dismissible:true,onClose:()=>setError(\"\"),children:error}),success&&/*#__PURE__*/_jsx(Alert,{variant:\"success\",dismissible:true,onClose:()=>setSuccess(\"\"),children:success}),/*#__PURE__*/_jsxs(Row,{className:\"mb-4\",children:[/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{className:\"text-center\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-primary\",children:formatAmount(totals.required)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",children:\"Total \\xE0 payer\"})]})})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{className:\"text-center\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-success\",children:formatAmount(totals.paid)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",children:\"Total pay\\xE9\"}),totals.has_global_discounts&&totals.global_discount_amount>0&&/*#__PURE__*/_jsxs(\"small\",{className:\"text-info d-block mt-1\",children:[formatAmount(totals.paid),\" +\",\" \",formatAmount(totals.global_discount_amount),\" =\",\" \",formatAmount(totals.required)]})]})})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{className:\"text-center\",children:/*#__PURE__*/_jsx(Card.Body,{children:totals.has_scholarships?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{className:totals.remaining>0?\"text-warning\":\"text-success\",children:formatAmount(totals.remaining)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",children:\"Reste \\xE0 payer\"}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-success\",children:[\"(Avec bourse de \",formatAmount(totals.scholarship_amount),\" \",\"d\\xE9j\\xE0 appliqu\\xE9e)\"]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{className:totals.remaining>0?\"text-warning\":\"text-success\",children:formatAmount(totals.remaining)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",children:\"Reste \\xE0 payer\"})]})})})})]}),totals.has_scholarships&&totals.remaining>0&&/*#__PURE__*/_jsx(Row,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(Alert,{variant:\"success\",className:\"text-center\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-award me-2\"}),/*#__PURE__*/_jsx(\"strong\",{children:\"Bonne nouvelle !\"}),\" Vous b\\xE9n\\xE9ficiez d'une bourse de\",\" \",formatAmount(totals.scholarship_amount),\".\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{children:\"Cette r\\xE9duction sera automatiquement appliqu\\xE9e lors du paiement.\"})]})})}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:7,children:/*#__PURE__*/_jsxs(Card,{className:\"mb-4\",children:[/*#__PURE__*/_jsx(Card.Header,{className:\"d-flex justify-content-between align-items-center\",children:/*#__PURE__*/_jsx(\"h5\",{className:\"mb-0\",children:\"Statut des Paiements par Tranche\"})}),/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(Table,{responsive:true,children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Tranche\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Montant Requis\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Montant Pay\\xE9\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Reste\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Statut\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:paymentStatus.map((status,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:status.is_physical_only?\"table-info\":status.is_optional?\"table-secondary\":\"\",children:[/*#__PURE__*/_jsxs(\"td\",{children:[status.tranche.name,status.is_physical_only&&/*#__PURE__*/_jsx(\"small\",{className:\"text-info d-block\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"(Paiement physique uniquement)\"})}),status.is_optional&&!status.is_physical_only&&/*#__PURE__*/_jsx(\"small\",{className:\"text-muted d-block\",children:\"(Optionnelle)\"})]}),/*#__PURE__*/_jsx(\"td\",{children:status.is_physical_only?/*#__PURE__*/_jsx(\"span\",{className:\"text-info\",children:\"Physical\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[formatAmount(status.required_amount),status.has_global_discount&&status.global_discount_amount>0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-success\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"Avec r\\xE9duction (\",status.discount_percentage,\"%):\",\" \",formatAmount(parseFloat(status.required_amount)-parseFloat(status.global_discount_amount))]})})]})}),/*#__PURE__*/_jsx(\"td\",{children:status.is_physical_only?/*#__PURE__*/_jsx(\"span\",{className:\"text-info\",children:\"Physical\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[formatAmount(status.paid_amount),status.has_scholarship&&status.scholarship_amount>0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-success\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"+ Bourse:\",\" \",formatAmount(status.scholarship_amount),/*#__PURE__*/_jsx(\"br\",{}),\"=\",\" \",formatAmount(parseFloat(status.paid_amount)+parseFloat(status.scholarship_amount))]})}),status.has_global_discount&&status.global_discount_amount>0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-success\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"+ R\\xE9duction:\",\" \",formatAmount(status.global_discount_amount),\" \",\"(\",status.discount_percentage,\"%)\",/*#__PURE__*/_jsx(\"br\",{}),\"=\",\" \",formatAmount(parseFloat(status.paid_amount)+parseFloat(status.global_discount_amount))]})})]})}),/*#__PURE__*/_jsx(\"td\",{children:status.is_physical_only?/*#__PURE__*/_jsx(\"span\",{className:\"text-info\",children:\"Physical\"}):/*#__PURE__*/_jsx(_Fragment,{children:status.has_scholarship&&status.scholarship_amount>0?/*#__PURE__*/_jsxs(_Fragment,{children:[formatAmount(Math.max(0,parseFloat(status.remaining_amount))),parseFloat(status.remaining_amount)-parseFloat(status.scholarship_amount)>0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-success\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"(Avec bourse:\",\" \",formatAmount(Math.max(0,parseFloat(status.remaining_amount)// parseFloat(\n//   status.scholarship_amount\n// )\n)),\")\"]})})]}):status.has_global_discount&&status.global_discount_amount>0?/*#__PURE__*/_jsxs(_Fragment,{children:[formatAmount(Math.max(0,parseFloat(status.remaining_amount)-parseFloat(status.global_discount_amount))),parseFloat(status.remaining_amount)-parseFloat(status.global_discount_amount)>0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-success\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"(Avec r\\xE9duction:\",\" \",formatAmount(Math.max(0,parseFloat(status.remaining_amount)-parseFloat(status.global_discount_amount))),\")\"]})})]}):formatAmount(status.remaining_amount)})}),/*#__PURE__*/_jsx(\"td\",{children:status.is_physical_only?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Badge,{bg:status.rame_paid?\"success\":\"warning\",children:status.rame_paid?\"Payé\":\"Non payé\"}),!status.rame_paid&&/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",size:\"sm\",className:\"ms-2\",onClick:()=>handlePayRame(),children:\"Payer RAME\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Badge,{bg:status.is_fully_paid?\"success\":\"warning\",children:status.is_fully_paid?status.has_scholarship&&status.scholarship_amount>0?\"Complet avec bourse\":\"Complet\":\"Partiel\"}),status.is_optional&&!status.is_fully_paid&&/*#__PURE__*/_jsx(\"small\",{className:\"text-muted d-block\",children:\"Non obligatoire\"})]})})]},index))})]})})]})}),/*#__PURE__*/_jsxs(Col,{md:5,children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-3\",children:/*#__PURE__*/_jsx(RameStatusToggle,{studentId:studentId,studentName:student?`${student.first_name} ${student.last_name}`:\"Étudiant\",onStatusChange:newStatus=>{console.log(\"Statut RAME mis à jour:\",newStatus);}})}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Header,{children:/*#__PURE__*/_jsx(\"h5\",{className:\"mb-0\",children:\"Historique des Paiements\"})}),/*#__PURE__*/_jsx(Card.Body,{children:paymentHistory.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-muted text-center\",children:\"Aucun paiement enregistr\\xE9\"}):/*#__PURE__*/_jsx(\"div\",{style:{maxHeight:\"400px\",overflowY:\"auto\"},children:paymentHistory.map(payment=>/*#__PURE__*/_jsxs(\"div\",{className:\"border-bottom pb-3 mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:formatAmount(payment.total_amount)}),payment.has_scholarship&&/*#__PURE__*/_jsx(\"div\",{className:\"text-success mt-1\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"Montant pay\\xE9:\",\" \",formatAmount(payment.total_amount),\" + Bourse appliqu\\xE9e:\",\" \",formatAmount(payment.scholarship_amount),\" = Valeur totale:\",\" \",formatAmount(payment.total_amount+payment.scholarship_amount)]})}),payment.has_reduction&&payment.reduction_amount>0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-info mt-1\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"Montant pay\\xE9:\",\" \",formatAmount(payment.total_amount),\" + R\\xE9duction appliqu\\xE9e:\",\" \",formatAmount(payment.reduction_amount),\" = Valeur totale:\",\" \",formatAmount(payment.total_amount+payment.reduction_amount)]})}),(payment.has_scholarship||payment.has_reduction)&&/*#__PURE__*/_jsx(\"span\",{className:`badge ms-2 ${payment.has_scholarship?\"bg-success\":\"bg-info\"}`,children:payment.has_scholarship&&payment.has_reduction?\"Bourse + Réduction\":payment.has_scholarship?\"Avec Bourse\":\"Avec Réduction\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-muted d-flex align-items-center gap-3\",children:[/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted d-flex align-items-center mt-2\",children:[/*#__PURE__*/_jsx(Calendar,{size:14,className:\"me-1\"}),formatDate(payment.payment_date)]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted d-flex align-items-center\",children:[/*#__PURE__*/_jsx(CreditCard,{size:14,className:\"me-1\"}),getPaymentMethodLabel(payment.payment_method,payment.is_rame_physical)]})]}),(payment.has_scholarship||payment.has_reduction)&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2\",children:[payment.has_scholarship&&/*#__PURE__*/_jsxs(\"div\",{className:\"badge bg-success me-1 mb-1\",children:[\"Bourse:\",\" \",formatAmount(payment.scholarship_amount)]}),payment.has_reduction&&payment.reduction_amount>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"badge bg-info me-1 mb-1\",children:[\"R\\xE9duction:\",\" \",formatAmount(payment.reduction_amount)]}),payment.discount_reason&&/*#__PURE__*/_jsx(\"small\",{className:\"text-success d-block\",children:/*#__PURE__*/_jsx(\"em\",{children:payment.discount_reason})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-1\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline-success\",size:\"sm\",disabled:isPrintingReceipt,onClick:()=>handleDownloadPDFFromHistory(payment.id),title:isPrintingReceipt?\"Téléchargement en cours...\":\"Télécharger le PDF\",children:isPrintingReceipt?/*#__PURE__*/_jsx(Spinner,{size:\"sm\"}):/*#__PURE__*/_jsx(_Fragment,{children:\"\\uD83D\\uDCC4\"})}),/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",size:\"sm\",disabled:isPrintingReceipt,onClick:()=>handlePrintReceiptFromHistory(payment.id),title:isPrintingReceipt?\"Impression en cours...\":\"Imprimer le reçu\",children:isPrintingReceipt?/*#__PURE__*/_jsx(Spinner,{size:\"sm\"}):/*#__PURE__*/_jsx(Receipt,{size:14})})]})]}),payment.notes&&/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted d-block mt-1\",children:[\"Note: \",payment.notes]})]},payment.id))})})]})]})]}),/*#__PURE__*/_jsxs(Modal,{show:showPaymentModal,onHide:handleModalClose,size:\"lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Nouveau Paiement\"})}),/*#__PURE__*/_jsxs(Form,{onSubmit:handlePaymentSubmit,children:[/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(Form.Label,{children:[\"Montant du versement (\",schoolSettings.currency||\"FCFA\",\") *\"]}),/*#__PURE__*/_jsx(Form.Control,{type:\"number\",min:\"1\",max:totals.remaining,step:\"1\",value:paymentForm.amount,onChange:e=>handleAmountChange(e.target.value),placeholder:\"Ex: 25000\",required:true}),/*#__PURE__*/_jsxs(Form.Text,{className:\"text-muted\",children:[\"Reste \\xE0 payer: \",formatAmount(totals.remaining),/*#__PURE__*/_jsx(\"br\",{}),paymentForm.payment_method===\"rame_physical\"?/*#__PURE__*/_jsx(\"small\",{className:\"text-info\",children:\"\\u2139\\uFE0F Paiement par rame physique - Montant \\xE9quivalent de la tranche RAME\"}):/*#__PURE__*/_jsx(\"small\",{className:\"text-warning\",children:\"\\u26A0\\uFE0F Le montant ne peut pas d\\xE9passer le solde restant\"})]})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Mode de paiement *\"}),/*#__PURE__*/_jsxs(Form.Select,{value:paymentForm.payment_method,onChange:e=>{const newMethod=e.target.value;setPaymentForm({...paymentForm,payment_method:newMethod,is_rame_physical:false// Reset RAME choice when method changes\n});},required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"Banque\"}),/*#__PURE__*/_jsx(\"option\",{value:\"card\",children:\"Carte bancaire\"}),/*#__PURE__*/_jsx(\"option\",{value:\"transfer\",children:\"Virement\"}),/*#__PURE__*/_jsx(\"option\",{value:\"check\",children:\"Ch\\xE8que\"})]})]})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Date de versement *\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"date\",value:paymentForm.versement_date,onChange:e=>{setPaymentForm({...paymentForm,versement_date:e.target.value});// Vérifier l'éligibilité aux réductions quand la date change\ncheckDiscountEligibilityInModal(e.target.value);},required:true}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\",children:\"Date effective du versement de l'\\xE9tudiant\"})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(Form.Label,{children:[\"Date de validation\",\" \",/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"(automatique)\"})]}),/*#__PURE__*/_jsx(Form.Control,{type:\"date\",value:paymentForm.payment_date,onChange:e=>setPaymentForm({...paymentForm,payment_date:e.target.value})}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\",children:\"Date officielle d'enregistrement du paiement dans le syst\\xE8me.\"})]})})]}),isCheckingDiscount&&/*#__PURE__*/_jsx(Row,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(Spinner,{animation:\"border\",size:\"sm\",className:\"me-2\"}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"V\\xE9rification des r\\xE9ductions disponibles...\"})]})})}),modalDiscountInfo&&!modalDiscountInfo.not_eligible&&!modalDiscountInfo.is_date_expired&&/*#__PURE__*/_jsx(Row,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{className:\"bg-success bg-opacity-10 border-success\",children:/*#__PURE__*/_jsxs(Card.Body,{className:\"py-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h6\",{className:\"text-success mb-1\",children:[\"\\uD83C\\uDF89 R\\xE9duction de\",\" \",modalDiscountInfo.discount_percentage,\"% disponible !\"]}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"\\xC9conomisez\",\" \",formatAmount(modalDiscountInfo.normal_totals.total_discount),\"en payant\",\" \",formatAmount(modalDiscountInfo.normal_totals.total_with_discount),\"au lieu de\",\" \",formatAmount(modalDiscountInfo.normal_totals.total_required)]})]}),/*#__PURE__*/_jsx(Form.Check,{type:\"checkbox\",label:\"Appliquer la r\\xE9duction\",checked:paymentForm.apply_discount,onChange:e=>handleDiscountToggle(e.target.checked),className:\"text-success\"})]}),paymentForm.apply_discount&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 p-2 bg-success bg-opacity-25 rounded\",children:/*#__PURE__*/_jsxs(\"small\",{className:\"text-success\",children:[\"\\u2705 \",/*#__PURE__*/_jsx(\"strong\",{children:\"R\\xE9duction activ\\xE9e :\"}),\" Le montant sera automatiquement r\\xE9parti sur toutes les tranches avec les montants r\\xE9duits.\"]})})]})})})}),modalDiscountInfo&&modalDiscountInfo.is_date_expired&&/*#__PURE__*/_jsx(Row,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{className:\"bg-warning bg-opacity-10 border-warning\",children:/*#__PURE__*/_jsxs(Card.Body,{className:\"py-3\",children:[/*#__PURE__*/_jsxs(\"h6\",{className:\"text-warning mb-1\",children:[\"\\u23F0 \",modalDiscountInfo.deadline_message]}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"La r\\xE9duction de \",modalDiscountInfo.discount_percentage,\"% n'est plus disponible pour cette date de versement.\"]})]})})})}),modalDiscountInfo&&modalDiscountInfo.not_eligible&&/*#__PURE__*/_jsx(Row,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{className:\"bg-secondary bg-opacity-10 border-secondary\",children:/*#__PURE__*/_jsxs(Card.Body,{className:\"py-3\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"text-muted mb-1\",children:\"\\u2139\\uFE0F R\\xE9duction non disponible\"}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:modalDiscountInfo.message})]})})})}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Num\\xE9ro de r\\xE9f\\xE9rence\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:paymentForm.reference_number,onChange:e=>setPaymentForm({...paymentForm,reference_number:e.target.value}),placeholder:\"Num\\xE9ro ch\\xE8que, virement...\"})]})}),/*#__PURE__*/_jsx(Col,{md:6})]}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Notes\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:3,value:paymentForm.notes,onChange:e=>setPaymentForm({...paymentForm,notes:e.target.value}),placeholder:\"Notes additionnelles...\"})]})})})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleModalClose,children:\"Annuler\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",disabled:paymentLoading,children:paymentLoading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Spinner,{animation:\"border\",size:\"sm\",className:\"me-2\"}),\"Enregistrement...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Check,{size:16,className:\"me-2\"}),\"Enregistrer le Paiement\"]})})]})]})]}),/*#__PURE__*/_jsxs(Modal,{show:showReceiptModal,onHide:()=>setShowReceiptModal(false),size:\"lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Re\\xE7u de Paiement\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(\"div\",{dangerouslySetInnerHTML:{__html:receiptHtml}})}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>setShowReceiptModal(false),children:\"Fermer\"}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:downloadReceiptPDF,disabled:isPrintingReceipt,className:\"me-2\",children:isPrintingReceipt?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Spinner,{size:\"sm\",className:\"me-2\"}),\"T\\xE9l\\xE9chargement...\"]}):/*#__PURE__*/_jsx(_Fragment,{children:\"\\uD83D\\uDCC4 PDF\"})})]})]})]});};export default StudentPayment;","map":{"version":3,"names":["useEffect","useState","Alert","Badge","Button","Card","Col","Container","Form","Modal","Row","Spinner","Table","ArrowLeft","Calendar","CashCoin","Check","CreditCard","Printer","Receipt","useNavigate","useParams","Swal","RameStatusToggle","useSchool","secureApiEndpoints","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","StudentPayment","_student$classSeries","_student$classSeries$","_student$classSeries2","studentId","navigate","schoolSettings","formatCurrency","getLogoUrl","student","setStudent","paymentStatus","setPaymentStatus","paymentHistory","setPaymentHistory","schoolYear","setSchoolYear","totals","setTotals","required","paid","remaining","scholarship_amount","has_scholarships","discountInfo","setDiscountInfo","eligible_for_scholarship","eligible_for_reduction","reduction_percentage","deadline","reasons","showPaymentModal","setShowPaymentModal","showReceiptModal","setShowReceiptModal","receiptHtml","setReceiptHtml","loading","setLoading","paymentLoading","setPaymentLoading","error","setError","success","setSuccess","isPrintingReceipt","setIsPrintingReceipt","printWindow","setPrintWindow","currentPaymentId","setCurrentPaymentId","paymentForm","setPaymentForm","amount","payment_method","reference_number","notes","payment_date","Date","toISOString","split","versement_date","is_rame_physical","rame_choice","apply_discount","modalDiscountInfo","setModalDiscountInfo","isCheckingDiscount","setIsCheckingDiscount","loadStudentPaymentInfo","loadPaymentHistory","response","payments","getStudentInfo","console","log","data","payment_status","school_year","totalGlobalDiscountAmount","hasGlobalDiscounts","Array","isArray","forEach","status","has_global_discount","global_discount_amount","parseFloat","currentTotals","total_required","total_paid","total_remaining","total_scholarship_amount","has_global_discounts","discount_info","message","getStudentHistory","handleModalClose","prev","handlePayRame","result","fire","title","html","first_name","last_name","icon","showCancelButton","confirmButtonText","cancelButtonText","confirmButtonColor","cancelButtonColor","preConfirm","document","getElementById","value","isConfirmed","payRamePhysically","getTime","text","timer","showConfirmButton","Error","handleQuickPayment","amountWithScholarship","Math","max","quickDiscountInfo","amountWithDiscount","discountResponse","getStudentInfoWithDiscount","discount_deadline","deadlineDate","versementDate","totalRequired","totalPaid","discountPercentage","discount_percentage","discountAmount","discount_amount","normal_totals","formatAmount","toLocaleDateString","width","didOpen","discountCheckbox","amountInput","addEventListener","checked","method","reference","trim","applyDiscountCheckbox","applyDiscount","showValidationMessage","apply_global_discount","create","student_id","parseInt","checkDiscountEligibilityInModal","selectedDate","parseFrenchDate","dateStr","parts","length","padStart","isNaN","selectedDateValid","deadlineValid","not_eligible","toDateString","isValid","is_date_expired","deadline_message","handleDiscountToggle","isChecked","newForm","payment_amount_required","toString","handleAmountChange","newAmount","handlePaymentSubmit","e","preventDefault","expectedAmount","paymentAmount","abs","paymentData","printResult","handlePrintReceipt","id","paymentId","generateReceipt","handlePrintReceiptFromHistory","handleDownloadPDFFromHistory","downloadReceiptPDF","printReceipt","closed","close","newPrintWindow","window","open","receiptNumberMatch","match","receiptNumber","slice","replace","write","setTimeout","checkClosed","setInterval","clearInterval","formatDate","dateString","getPaymentMethodLabel","isRamePhysical","arguments","undefined","methods","cash","card","transfer","check","fluid","className","children","animation","role","variant","size","onClick","classSeries","schoolClass","name","disabled","dismissible","onClose","md","Body","Header","responsive","map","index","is_physical_only","is_optional","tranche","required_amount","paid_amount","has_scholarship","remaining_amount","bg","rame_paid","is_fully_paid","studentName","onStatusChange","newStatus","style","maxHeight","overflowY","payment","total_amount","has_reduction","reduction_amount","discount_reason","show","onHide","closeButton","Title","onSubmit","Group","Label","currency","Control","type","min","step","onChange","target","placeholder","Text","Select","newMethod","total_discount","total_with_discount","label","as","rows","Footer","dangerouslySetInnerHTML","__html"],"sources":["/var/www/College-IUP/front/src/pages/Payments/StudentPayment.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport {\n  Alert,\n  Badge,\n  Button,\n  Card,\n  Col,\n  Container,\n  Form,\n  Modal,\n  Row,\n  Spinner,\n  Table,\n} from \"react-bootstrap\";\nimport {\n  ArrowLeft,\n  Calendar,\n  CashCoin,\n  Check,\n  CreditCard,\n  Printer,\n  Receipt,\n} from \"react-bootstrap-icons\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport Swal from \"sweetalert2\";\nimport RameStatusToggle from \"../../components/RameStatusToggle\";\nimport { useSchool } from \"../../contexts/SchoolContext\";\nimport { secureApiEndpoints } from \"../../utils/apiMigration\";\n\nconst StudentPayment = () => {\n  const { studentId } = useParams();\n  const navigate = useNavigate();\n  const { schoolSettings, formatCurrency, getLogoUrl } = useSchool();\n\n  const [student, setStudent] = useState(null);\n  const [paymentStatus, setPaymentStatus] = useState([]);\n  const [paymentHistory, setPaymentHistory] = useState([]);\n  const [schoolYear, setSchoolYear] = useState(null);\n  const [totals, setTotals] = useState({\n    required: 0,\n    paid: 0,\n    remaining: 0,\n    scholarship_amount: 0,\n    has_scholarships: false,\n  });\n\n  const [discountInfo, setDiscountInfo] = useState({\n    eligible_for_scholarship: false,\n    scholarship_amount: 0,\n    eligible_for_reduction: false,\n    reduction_percentage: 0,\n    deadline: null,\n    reasons: [],\n  });\n\n  // Variable supprimée - logique intégrée dans le modal\n\n  // Variables supprimées - ancienne logique de réduction\n\n  const [showPaymentModal, setShowPaymentModal] = useState(false);\n  const [showReceiptModal, setShowReceiptModal] = useState(false);\n  const [receiptHtml, setReceiptHtml] = useState(\"\");\n  const [loading, setLoading] = useState(true);\n  const [paymentLoading, setPaymentLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [success, setSuccess] = useState(\"\");\n  const [isPrintingReceipt, setIsPrintingReceipt] = useState(false);\n  const [printWindow, setPrintWindow] = useState(null);\n  const [currentPaymentId, setCurrentPaymentId] = useState(null);\n\n  const [paymentForm, setPaymentForm] = useState({\n    amount: \"\",\n    payment_method: \"cash\",\n    reference_number: \"\",\n    notes: \"\",\n    payment_date: new Date().toISOString().split(\"T\")[0],\n    versement_date: new Date().toISOString().split(\"T\")[0],\n    is_rame_physical: false,\n    rame_choice: \"none\", // Par défaut: ne pas payer la RAME\n    apply_discount: false, // Nouvelle option pour appliquer la réduction\n  });\n\n  // États pour la gestion de la réduction dans le modal\n  const [modalDiscountInfo, setModalDiscountInfo] = useState(null);\n  const [isCheckingDiscount, setIsCheckingDiscount] = useState(false);\n\n  useEffect(() => {\n    loadStudentPaymentInfo();\n    loadPaymentHistory();\n  }, [studentId]);\n\n  const loadStudentPaymentInfo = async () => {\n    try {\n      setLoading(true);\n      const response = await secureApiEndpoints.payments.getStudentInfo(\n        studentId\n      );\n\n      console.log(response);\n      \n      if (response.success) {\n        console.log(response);\n        \n        setStudent(response.data.student);\n        setPaymentStatus(response.data.payment_status);\n        setSchoolYear(response.data.school_year);\n\n        // Calculer le total des réductions globales appliquées\n        let totalGlobalDiscountAmount = 0;\n        let hasGlobalDiscounts = false;\n\n        if (\n          response.data.payment_status &&\n          Array.isArray(response.data.payment_status)\n        ) {\n          response.data.payment_status.forEach((status) => {\n            if (\n              status.has_global_discount &&\n              status.global_discount_amount > 0\n            ) {\n              totalGlobalDiscountAmount += parseFloat(\n                status.global_discount_amount\n              );\n              hasGlobalDiscounts = true;\n            }\n          });\n        }\n\n        // Gérer les montants (toujours normaux maintenant)\n        const currentTotals = {\n          required: response.data.total_required, // Montants normaux\n          paid: response.data.total_paid,\n          remaining: response.data.total_remaining,\n          scholarship_amount: response.data.total_scholarship_amount || 0,\n          has_scholarships: response.data.has_scholarships || false,\n          global_discount_amount: totalGlobalDiscountAmount,\n          has_global_discounts: hasGlobalDiscounts,\n        };\n        setTotals(currentTotals);\n\n        // Code simplifié - plus besoin de tracking des réductions existantes\n\n        setDiscountInfo({\n          eligible_for_scholarship: false,\n          scholarship_amount: 0,\n          eligible_for_reduction: false,\n          reduction_percentage: 0,\n          deadline: null,\n          reasons: [],\n          ...(response.data.discount_info || {}),\n        });\n\n        // Plus besoin de vérifier l'éligibilité au chargement initial\n      } else {\n        setError(response.message);\n      }\n    } catch (error) {\n      setError(\"Erreur lors du chargement des informations de paiement\");\n      console.error(\"Error loading payment info:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadPaymentHistory = async () => {\n    try {\n      const response = await secureApiEndpoints.payments.getStudentHistory(\n        studentId\n      );\n\n      if (response.success) {\n        setPaymentHistory(response.data);\n      }\n    } catch (error) {\n      console.error(\"Error loading payment history:\", error);\n    }\n  };\n\n  // Réinitialiser le formulaire quand le modal se ferme\n  const handleModalClose = () => {\n    setShowPaymentModal(false);\n    setModalDiscountInfo(null);\n    setPaymentForm((prev) => ({\n      ...prev,\n      amount: \"\",\n      apply_discount: false,\n      versement_date: new Date().toISOString().split(\"T\")[0],\n    }));\n  };\n\n  // Fonction pour payer la RAME physiquement\n  const handlePayRame = async () => {\n    const result = await Swal.fire({\n      title: \"Payer la RAME physiquement\",\n      html: `\n                <p>Confirmez-vous que l'étudiant <strong>${student?.first_name} ${student?.last_name}</strong> a apporté sa RAME physiquement ?</p>\n                <div class=\"mt-3\">\n                    <label for=\"rameNotes\" class=\"form-label\">Notes (optionnel):</label>\n                    <textarea id=\"rameNotes\" class=\"form-control\" placeholder=\"Commentaires sur le paiement RAME...\"></textarea>\n                </div>\n            `,\n      icon: \"question\",\n      showCancelButton: true,\n      confirmButtonText: \"Oui, marquer comme payé\",\n      cancelButtonText: \"Annuler\",\n      confirmButtonColor: \"#28a745\",\n      cancelButtonColor: \"#6c757d\",\n      preConfirm: () => {\n        const notes = document.getElementById(\"rameNotes\").value;\n        return { notes };\n      },\n    });\n\n    if (result.isConfirmed) {\n      try {\n        setPaymentLoading(true);\n        const response = await secureApiEndpoints.payments.payRamePhysically(\n          studentId,\n          {\n            notes: result.value.notes || \"RAME apportée physiquement\",\n            reference_number: \"RAME-PHYS-\" + new Date().getTime(),\n          }\n        );\n\n        if (response.success) {\n          Swal.fire({\n            title: \"Succès !\",\n            text: \"RAME marquée comme payée physiquement\",\n            icon: \"success\",\n            timer: 2000,\n            showConfirmButton: false,\n          });\n\n          // Recharger les données\n          await loadStudentPaymentInfo();\n          await loadPaymentHistory();\n        } else {\n          throw new Error(response.message || \"Erreur lors du paiement RAME\");\n        }\n      } catch (error) {\n        console.error(\"Error paying RAME:\", error);\n        Swal.fire({\n          title: \"Erreur\",\n          text: error.message || \"Erreur lors du paiement RAME\",\n          icon: \"error\",\n        });\n      } finally {\n        setPaymentLoading(false);\n      }\n    }\n  };\n\n  // Anciennes fonctions supprimées - logique intégrée dans le modal\n\n  // Fonction pour paiement rapide sans modal\n  const handleQuickPayment = async () => {\n    // Calculer le montant avec bourse (conversion en nombres)\n    const amountWithScholarship = Math.max(\n      0,\n      parseFloat(totals.remaining) - parseFloat(totals.scholarship_amount)\n    );\n\n    // Vérifier l'éligibilité aux réductions pour le paiement rapide\n    let quickDiscountInfo = null;\n    let amountWithDiscount = totals.remaining;\n\n    try {\n      // Utiliser la même logique que le modal normal\n      const discountResponse =\n        await secureApiEndpoints.payments.getStudentInfoWithDiscount(studentId);\n\n      if (\n        discountResponse.success &&\n        discountResponse.data.discount_deadline &&\n        !totals.has_scholarships\n      ) {\n        const deadlineDate = new Date(discountResponse.data.discount_deadline);\n        const versementDate = new Date(); // Date actuelle pour paiement rapide\n\n        if (versementDate <= deadlineDate) {\n          // Calculer le montant avec réduction\n          const totalRequired = discountResponse.data.total_required;\n          const totalPaid = discountResponse.data.total_paid;\n          const discountPercentage = discountResponse.data.discount_percentage;\n          const discountAmount =\n            (totalRequired - totalPaid) * (discountPercentage / 100);\n\n          quickDiscountInfo = {\n            discount_percentage: discountPercentage,\n            discount_amount: discountAmount,\n            deadline: discountResponse.data.discount_deadline,\n            normal_totals: {\n              total_required: totalRequired,\n              total_paid: totalPaid,\n            },\n          };\n\n          amountWithDiscount = totalRequired - totalPaid - discountAmount;\n        }\n      }\n    } catch (error) {\n      console.log(\n        \"Erreur lors de la vérification de l'éligibilité aux réductions pour paiement rapide:\",\n        error\n      );\n    }\n\n    const result = await Swal.fire({\n      title: \"Paiement Rapide\",\n      html: `\n                <div class=\"text-start\">\n                    <p><strong>Étudiant:</strong> ${student?.first_name} ${\n        student?.last_name\n      }</p>\n                    <p><strong>Montant restant:</strong> ${formatAmount(\n                      totals.remaining\n                    )}</p>\n                    ${\n                      totals.has_scholarships\n                        ? `\n                        <div class=\"alert alert-success mb-3\">\n                            <strong>🎉 Avec votre bourse:</strong><br>\n                            ${formatAmount(totals.remaining)} - ${formatAmount(\n                            totals.scholarship_amount\n                          )} = \n                            <strong>${formatAmount(\n                              amountWithScholarship\n                            )}</strong>\n                        </div>\n                    `\n                        : quickDiscountInfo\n                        ? `\n                        <div class=\"alert alert-info mb-3\">\n                            <strong>💰 Réduction disponible (${\n                              quickDiscountInfo.discount_percentage\n                            }%):</strong><br>\n                            ${formatAmount(totals.remaining)} - ${formatAmount(\n                            quickDiscountInfo.discount_amount\n                          )} = \n                            <strong>${formatAmount(amountWithDiscount)}</strong>\n                            <br><small>Paiement intégral avant le ${new Date(\n                              quickDiscountInfo.deadline\n                            ).toLocaleDateString(\"fr-FR\")}</small>\n                        </div>\n                    `\n                        : \"\"\n                    }\n                    <hr>\n                    <div class=\"mb-3\">\n                        <label for=\"quickAmount\" class=\"form-label\">Montant à payer *</label>\n                        <input type=\"number\" id=\"quickAmount\" class=\"form-control\" \n                               value=\"${\n                                 totals.has_scholarships\n                                   ? amountWithScholarship\n                                   : quickDiscountInfo\n                                   ? amountWithDiscount\n                                   : totals.remaining\n                               }\" \n                               min=\"1\" max=\"${totals.remaining}\">\n                    </div>\n                    ${\n                      quickDiscountInfo\n                        ? `\n                        <div class=\"mb-3\">\n                            <div class=\"form-check\">\n                                <input class=\"form-check-input\" type=\"checkbox\" id=\"quickApplyDiscount\" checked>\n                                <label class=\"form-check-label\" for=\"quickApplyDiscount\">\n                                    Appliquer la réduction de ${quickDiscountInfo.discount_percentage}%\n                                </label>\n                            </div>\n                        </div>\n                    `\n                        : \"\"\n                    }\n                    <div class=\"mb-3\">\n                        <label for=\"quickVersementDate\" class=\"form-label\">Date de versement *</label>\n                        <input type=\"date\" id=\"quickVersementDate\" class=\"form-control\" \n                               value=\"${\n                                 new Date().toISOString().split(\"T\")[0]\n                               }\" required>\n                    </div>\n                    <div class=\"mb-3\">\n                        <label for=\"quickMethod\" class=\"form-label\">Méthode de paiement *</label>\n                        <select id=\"quickMethod\" class=\"form-select\">\n                            <option value=\"cash\">Banque</option>\n                            <option value=\"card\">Carte bancaire</option>\n                            <option value=\"transfer\">Virement</option>\n                            <option value=\"check\">Chèque</option>\n                        </select>\n                    </div>\n                    <div class=\"mb-3\">\n                        <label for=\"quickReference\" class=\"form-label\">Référence (optionnel)</label>\n                        <input type=\"text\" id=\"quickReference\" class=\"form-control\" \n                               placeholder=\"Numéro de référence\">\n                    </div>\n                    <div class=\"mb-3\">\n                        <label for=\"quickNotes\" class=\"form-label\">Notes (optionnel)</label>\n                        <textarea id=\"quickNotes\" class=\"form-control\" rows=\"2\" \n                                  placeholder=\"Commentaires sur le paiement\"></textarea>\n                    </div>\n                </div>\n            `,\n      icon: \"question\",\n      showCancelButton: true,\n      confirmButtonText: \"💳 Enregistrer le Paiement\",\n      cancelButtonText: \"Annuler\",\n      confirmButtonColor: \"#28a745\",\n      cancelButtonColor: \"#6c757d\",\n      width: \"500px\",\n      didOpen: () => {\n        // Gestionnaire pour la checkbox de réduction\n        const discountCheckbox = document.getElementById(\"quickApplyDiscount\");\n        const amountInput = document.getElementById(\"quickAmount\");\n\n        if (discountCheckbox && amountInput && quickDiscountInfo) {\n          discountCheckbox.addEventListener(\"change\", () => {\n            if (discountCheckbox.checked) {\n              amountInput.value = amountWithDiscount;\n            } else {\n              amountInput.value = totals.remaining;\n            }\n          });\n        }\n      },\n      preConfirm: () => {\n        const amount = parseFloat(document.getElementById(\"quickAmount\").value);\n        const versementDate =\n          document.getElementById(\"quickVersementDate\").value;\n        const method = document.getElementById(\"quickMethod\").value;\n        const reference = document\n          .getElementById(\"quickReference\")\n          .value.trim();\n        const notes = document.getElementById(\"quickNotes\").value.trim();\n        const applyDiscountCheckbox =\n          document.getElementById(\"quickApplyDiscount\");\n        const applyDiscount = applyDiscountCheckbox\n          ? applyDiscountCheckbox.checked\n          : false;\n\n        if (!amount || amount <= 0) {\n          Swal.showValidationMessage(\"Veuillez saisir un montant valide\");\n          return false;\n        }\n\n        if (amount > totals.remaining) {\n          Swal.showValidationMessage(\n            \"Le montant ne peut pas dépasser le montant restant\"\n          );\n          return false;\n        }\n\n        if (!versementDate) {\n          Swal.showValidationMessage(\n            \"Veuillez sélectionner une date de versement\"\n          );\n          return false;\n        }\n\n        return {\n          amount: amount,\n          payment_method: method,\n          reference_number: reference || \"\",\n          notes: notes || \"\",\n          payment_date: new Date().toISOString().split(\"T\")[0],\n          versement_date: versementDate,\n          apply_global_discount: applyDiscount,\n        };\n      },\n    });\n\n    if (result.isConfirmed) {\n      try {\n        setPaymentLoading(true);\n        const response = await secureApiEndpoints.payments.create({\n          student_id: parseInt(studentId),\n          ...result.value,\n        });\n\n        if (response.success) {\n          Swal.fire({\n            title: \"Paiement Enregistré !\",\n            text: `Paiement de ${formatAmount(\n              result.value.amount\n            )} enregistré avec succès`,\n            icon: \"success\",\n            timer: 3000,\n            showConfirmButton: false,\n          });\n\n          // Recharger les données\n          await loadStudentPaymentInfo();\n          await loadPaymentHistory();\n        } else {\n          throw new Error(\n            response.message || \"Erreur lors de l'enregistrement du paiement\"\n          );\n        }\n      } catch (error) {\n        console.error(\"Error in quick payment:\", error);\n        Swal.fire({\n          title: \"Erreur\",\n          text: error.message || \"Erreur lors de l'enregistrement du paiement\",\n          icon: \"error\",\n        });\n      } finally {\n        setPaymentLoading(false);\n      }\n    }\n  };\n\n  // Fonction supprimée - logique maintenant intégrée dans le modal principal\n\n  // Fonction supprimée - logique intégrée dans le modal\n\n  // Fonction pour vérifier l'éligibilité aux réductions dans le modal\n  const checkDiscountEligibilityInModal = async (versementDate) => {\n    if (!studentId || !versementDate) {\n      setModalDiscountInfo(null);\n      return;\n    }\n\n    setIsCheckingDiscount(true);\n\n    try {\n      const response =\n        await secureApiEndpoints.payments.getStudentInfoWithDiscount(studentId);\n\n      if (response.success) {\n        console.log(\"Discount response data:\", response.data);\n\n        // Vérifier si une date limite existe\n        if (!response.data.discount_deadline) {\n          console.log(\"No discount deadline found - should be eligible\");\n          setModalDiscountInfo(response.data);\n          return;\n        }\n\n        // Vérifier si la date de versement est dans les délais\n        const selectedDate = new Date(versementDate);\n\n        // Parser la date française DD/MM/YYYY vers le format ISO\n        const parseFrenchDate = (dateStr) => {\n          const parts = dateStr.split(\"/\");\n          if (parts.length === 3) {\n            // Convertir DD/MM/YYYY vers YYYY-MM-DD\n            return new Date(\n              `${parts[2]}-${parts[1].padStart(2, \"0\")}-${parts[0].padStart(\n                2,\n                \"0\"\n              )}`\n            );\n          }\n          return new Date(dateStr); // Fallback\n        };\n\n        const deadline = parseFrenchDate(response.data.discount_deadline);\n\n        // Vérifier que les dates sont valides\n        if (isNaN(selectedDate.getTime()) || isNaN(deadline.getTime())) {\n          console.error(\"Invalid dates:\", {\n            versementDate,\n            discount_deadline: response.data.discount_deadline,\n            selectedDateValid: !isNaN(selectedDate.getTime()),\n            deadlineValid: !isNaN(deadline.getTime()),\n          });\n          setModalDiscountInfo({\n            not_eligible: true,\n            message: \"Erreur de format de date\",\n          });\n          return;\n        }\n\n        console.log(\"Date comparison:\", {\n          selectedDate: selectedDate.toDateString(),\n          deadline: deadline.toDateString(),\n          versementDate: versementDate,\n          discount_deadline: response.data.discount_deadline,\n          isValid: selectedDate <= deadline,\n        });\n\n        if (selectedDate <= deadline) {\n          setModalDiscountInfo(response.data);\n        } else {\n          setModalDiscountInfo({\n            ...response.data,\n            is_date_expired: true,\n            deadline_message: `Date limite dépassée (${response.data.discount_deadline})`,\n          });\n        }\n      } else {\n        // Étudiant non éligible aux réductions\n        setModalDiscountInfo({\n          not_eligible: true,\n          message: response.message,\n          reasons: response.reasons || [],\n        });\n      }\n    } catch (error) {\n      console.error(\"Error checking discount eligibility in modal:\", error);\n      setModalDiscountInfo(null);\n    } finally {\n      setIsCheckingDiscount(false);\n    }\n  };\n\n  // Fonction pour gérer l'activation/désactivation de la réduction dans le modal\n  const handleDiscountToggle = (isChecked) => {\n    setPaymentForm((prev) => {\n      const newForm = { ...prev, apply_discount: isChecked };\n\n      if (\n        isChecked &&\n        modalDiscountInfo &&\n        !modalDiscountInfo.not_eligible &&\n        !modalDiscountInfo.is_date_expired\n      ) {\n        // Appliquer le montant avec réduction\n        newForm.amount = modalDiscountInfo.payment_amount_required.toString();\n      } else {\n        // Revenir au montant par défaut (reste à payer)\n        newForm.amount = totals.remaining.toString();\n      }\n\n      return newForm;\n    });\n  };\n\n  // Fonction pour gérer les changements de montant\n  const handleAmountChange = (newAmount) => {\n    setPaymentForm((prev) => ({ ...prev, amount: newAmount }));\n  };\n\n  const handlePaymentSubmit = async (e) => {\n    e.preventDefault();\n\n    // Validation\n    if (!paymentForm.amount || parseFloat(paymentForm.amount) <= 0) {\n      setError(\"Veuillez saisir un montant valide\");\n      return;\n    }\n\n    if (parseFloat(paymentForm.amount) > totals.remaining) {\n      setError(\n        `Le montant saisi (${formatCurrency(\n          parseInt(paymentForm.amount)\n        )}) est supérieur au montant restant (${formatCurrency(\n          totals.remaining\n        )}). Veuillez saisir un montant inférieur ou égal au solde restant.`\n      );\n      return;\n    }\n\n    // NOUVELLE VALIDATION : Vérifier la cohérence entre la case cochée et le montant\n    if (\n      paymentForm.apply_discount &&\n      modalDiscountInfo &&\n      !modalDiscountInfo.not_eligible &&\n      !modalDiscountInfo.is_date_expired\n    ) {\n      const expectedAmount = modalDiscountInfo.payment_amount_required;\n      const paymentAmount = parseFloat(paymentForm.amount);\n\n      if (Math.abs(paymentAmount - expectedAmount) > 0.01) {\n        Swal.fire({\n          title: \"Montant incorrect pour la réduction\",\n          html: `\n                        <div class=\"text-left\">\n                            <p>Pour appliquer la réduction, le montant doit être exactement :</p>\n                            <p><strong>${formatAmount(\n                              expectedAmount\n                            )}</strong></p>\n                            <p>Montant actuel : <strong>${formatAmount(\n                              paymentAmount\n                            )}</strong></p>\n                        </div>\n                    `,\n          icon: \"warning\",\n        });\n        return;\n      }\n    }\n\n    // Validation si réduction cochée mais conditions non remplies\n    if (\n      paymentForm.apply_discount &&\n      (!modalDiscountInfo ||\n        modalDiscountInfo.not_eligible ||\n        modalDiscountInfo.is_date_expired)\n    ) {\n      Swal.fire({\n        title: \"Réduction non disponible\",\n        text: \"Les conditions pour la réduction ne sont pas remplies. Veuillez décocher l'option ou modifier la date de versement.\",\n        icon: \"warning\",\n      });\n      return;\n    }\n\n    try {\n      setPaymentLoading(true);\n      setError(\"\");\n\n      const paymentData = {\n        student_id: parseInt(studentId),\n        amount: parseFloat(paymentForm.amount),\n        payment_method: paymentForm.payment_method,\n        reference_number: paymentForm.reference_number || null,\n        notes: paymentForm.notes || null,\n        payment_date: paymentForm.payment_date,\n        versement_date: paymentForm.versement_date,\n        apply_global_discount: paymentForm.apply_discount, // Indiquer au backend d'appliquer la réduction\n      };\n\n      const response = await secureApiEndpoints.payments.create(paymentData);\n\n      if (response.success) {\n        setSuccess(\"Paiement enregistré avec succès\");\n        setShowPaymentModal(false);\n\n        // Réinitialiser le formulaire\n        setPaymentForm({\n          amount: \"\",\n          payment_method: \"cash\",\n          reference_number: \"\",\n          notes: \"\",\n          payment_date: new Date().toISOString().split(\"T\")[0],\n          versement_date: new Date().toISOString().split(\"T\")[0],\n          is_rame_physical: false,\n          rame_choice: \"none\",\n          apply_discount: false,\n        });\n        setModalDiscountInfo(null);\n\n        // Recharger les données\n        await loadStudentPaymentInfo();\n        await loadPaymentHistory();\n\n        // Proposer d'imprimer le reçu\n        const printResult = await Swal.fire({\n          title: \"Paiement enregistré !\",\n          text: \"Voulez-vous imprimer le reçu maintenant ?\",\n          icon: \"success\",\n          showCancelButton: true,\n          confirmButtonText: \"Imprimer le reçu\",\n          cancelButtonText: \"Plus tard\",\n        });\n\n        if (printResult.isConfirmed) {\n          handlePrintReceipt(response.data.id);\n        }\n      } else {\n        setError(\n          response.message || \"Erreur lors de l'enregistrement du paiement\"\n        );\n      }\n    } catch (error) {\n      setError(\"Erreur lors de l'enregistrement du paiement\");\n      console.error(\"Error creating payment:\", error);\n    } finally {\n      setPaymentLoading(false);\n    }\n  };\n\n  const handlePrintReceipt = async (paymentId) => {\n    if (isPrintingReceipt) return; // Éviter les appels multiples\n    \n    try {\n      setIsPrintingReceipt(true);\n      const response = await secureApiEndpoints.payments.generateReceipt(\n        paymentId\n      );\n\n      if (response.success) {\n        setReceiptHtml(response.data.html);\n        setCurrentPaymentId(paymentId);\n        setShowReceiptModal(true);\n      } else {\n        setError(\"Erreur lors de la génération du reçu\");\n      }\n    } catch (error) {\n      setError(\"Erreur lors de la génération du reçu\");\n      console.error(\"Error generating receipt:\", error);\n    } finally {\n      setIsPrintingReceipt(false);\n    }\n  };\n\n  const handlePrintReceiptFromHistory = async (paymentId) => {\n    await handlePrintReceipt(paymentId);\n  };\n\n  const handleDownloadPDFFromHistory = async (paymentId) => {\n    if (isPrintingReceipt) return;\n\n    try {\n      setIsPrintingReceipt(true);\n      await secureApiEndpoints.payments.downloadReceiptPDF(paymentId);\n      setSuccess(\"Le reçu PDF a été téléchargé avec succès\");\n    } catch (error) {\n      console.error('Erreur lors du téléchargement PDF:', error);\n      setError('Erreur lors du téléchargement du PDF: ' + error.message);\n    } finally {\n      setIsPrintingReceipt(false);\n    }\n  };\n\n  const downloadReceiptPDF = async () => {\n    if (isPrintingReceipt) return;\n\n    try {\n      setIsPrintingReceipt(true);\n      \n      if (!currentPaymentId) {\n        setError(\"Impossible de déterminer l'ID du paiement\");\n        return;\n      }\n\n      await secureApiEndpoints.payments.downloadReceiptPDF(currentPaymentId);\n      setSuccess(\"Le reçu PDF a été téléchargé avec succès\");\n      \n    } catch (error) {\n      console.error('Erreur lors du téléchargement PDF:', error);\n      setError('Erreur lors du téléchargement du PDF: ' + error.message);\n    } finally {\n      setIsPrintingReceipt(false);\n    }\n  };\n\n  const printReceipt = () => {\n    if (isPrintingReceipt) return; // Éviter les doubles ouvertures\n    \n    // Fermer la fenêtre précédente si elle existe\n    if (printWindow && !printWindow.closed) {\n      printWindow.close();\n    }\n    \n    setIsPrintingReceipt(true);\n    const newPrintWindow = window.open(\"\", \"_blank\");\n    \n    // Vérifier si la fenêtre a pu être créée (popups non bloqués)\n    if (!newPrintWindow) {\n      setIsPrintingReceipt(false);\n      setError(\"Impossible d'ouvrir la fenêtre d'impression. Veuillez autoriser les popups pour ce site.\");\n      return;\n    }\n    \n    setPrintWindow(newPrintWindow);\n    // Extraire le numéro de reçu depuis le HTML pour un titre unique\n    const receiptNumberMatch = receiptHtml.match(/Reçu N° :\\s*([^<]+)/);\n    const receiptNumber = receiptNumberMatch\n      ? receiptNumberMatch[1].trim()\n      : new Date()\n          .toISOString()\n          .slice(0, 19)\n          .replace(/[-:]/g, \"\")\n          .replace(\"T\", \"_\");\n\n    try {\n      newPrintWindow.document.write(`\n            <html>\n                <head>\n                    <title>Reçu_${receiptNumber}</title>\n                    <style>\n                        @page {\n                            size: A4 landscape;\n                            margin: 1cm;\n                        }\n                        \n                        body { \n                            font-family: Arial, sans-serif; \n                            margin: 0; \n                            padding: 0;\n                            font-size: 9px;\n                            line-height: 1.3;\n                        }\n                        \n                        @media print { \n                            body { \n                                margin: 0; \n                                -webkit-print-color-adjust: exact;\n                                print-color-adjust: exact;\n                            }\n                            .no-print { \n                                display: none !important; \n                            }\n                        }\n                        \n                        @media screen {\n                            body {\n                                background: #f0f0f0;\n                                padding: 20px;\n                            }\n                            \n                            .receipt-container {\n                                background: white;\n                                width: 294mm;  /* Deux reçus côte à côte (147mm x 2) */\n                                height: 148mm; /* Hauteur à 148mm */\n                                margin: 0 auto;\n                                box-shadow: 0 0 10px rgba(0,0,0,0.1);\n                            }\n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class=\"receipt-container\">\n                        ${receiptHtml}\n                    </div>\n                    <div class=\"no-print\" style=\"text-align: center; margin-top: 30px; background: white; padding: 20px;\">\n                        <button onclick=\"window.print(); setTimeout(() => window.close(), 2000);\" style=\"padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;\">📄 Imprimer & Fermer</button>\n                        <button onclick=\"window.close()\" style=\"padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;\">✖️ Fermer Maintenant</button>\n                        <div style=\"margin-top: 15px; font-size: 12px; color: #666;\">\n                            <p>📋 <strong>Instructions :</strong></p>\n                            <ul style=\"text-align: left; max-width: 500px; margin: 0 auto;\">\n                                <li>Configurez votre imprimante sur format <strong>A4 Paysage</strong></li>\n                                <li>Le reçu contient 2 exemplaires côte à côte</li>\n                                <li><strong>Côté gauche :</strong> Exemplaire parents</li>\n                                <li><strong>Côté droit :</strong> Exemplaire collège</li>\n                                <li>Découpez au milieu vertical pour séparer les exemplaires</li>\n                            </ul>\n                        </div>\n                    </div>\n                </body>\n            </html>\n        `);\n      newPrintWindow.document.close();\n      \n      // Libérer le verrou après un délai pour permettre l'ouverture de la fenêtre\n      setTimeout(() => {\n        setIsPrintingReceipt(false);\n      }, 1000);\n      \n      // Écouter la fermeture de la fenêtre pour libérer le verrou plus tôt si possible\n      if (newPrintWindow) {\n        const checkClosed = setInterval(() => {\n          if (newPrintWindow.closed) {\n            setIsPrintingReceipt(false);\n            setPrintWindow(null);\n            clearInterval(checkClosed);\n          }\n        }, 500);\n        \n        // Nettoyer l'intervalle après 30 secondes au maximum\n        setTimeout(() => {\n          clearInterval(checkClosed);\n          setIsPrintingReceipt(false);\n          setPrintWindow(null);\n        }, 30000);\n      }\n    } catch (error) {\n      console.error('Erreur lors de l\\'ouverture de la fenêtre d\\'impression:', error);\n      setError('Erreur lors de l\\'ouverture de la fenêtre d\\'impression. Veuillez réessayer.');\n      setIsPrintingReceipt(false);\n      setPrintWindow(null);\n    }\n  };\n\n\n  const formatAmount = (amount) => {\n    return formatCurrency(parseInt(amount));\n  };\n\n  const formatDate = (dateString) => {\n    return new Date(dateString).toLocaleDateString(\"fr-FR\");\n  };\n\n  const getPaymentMethodLabel = (method, isRamePhysical = false) => {\n    if (isRamePhysical) {\n      return \"RAME Physique\";\n    }\n    const methods = {\n      cash: \"Banque\",\n      card: \"Carte\",\n      transfer: \"Virement\",\n      check: \"Chèque\",\n    };\n    return methods[method] || method;\n  };\n\n  if (loading) {\n    return (\n      <Container fluid className=\"py-4\">\n        <div className=\"text-center\">\n          <Spinner animation=\"border\" role=\"status\">\n            <span className=\"visually-hidden\">Chargement...</span>\n          </Spinner>\n        </div>\n      </Container>\n    );\n  }\n\n  if (!student) {\n    return (\n      <Container fluid className=\"py-4\">\n        <Alert variant=\"danger\">\n          Étudiant non trouvé ou erreur lors du chargement des données.\n        </Alert>\n      </Container>\n    );\n  }\n\n  return (\n    <Container fluid className=\"py-4\">\n      {/* Header */}\n      <Row className=\"mb-4\">\n        <Col>\n          <div className=\"d-flex justify-content-between align-items-center\">\n            <div className=\"d-flex align-items-center\">\n              <Button\n                variant=\"outline-secondary\"\n                size=\"sm\"\n                onClick={() => navigate(-1)}\n                className=\"me-3\"\n              >\n                <ArrowLeft size={16} />\n              </Button>\n              <div>\n                <h2 className=\"mb-1\">\n                  Paiement - {student.last_name} {student.first_name}\n                </h2>\n                <p className=\"text-muted mb-0\">\n                  {student.classSeries?.schoolClass?.name} -{\" \"}\n                  {student.classSeries?.name} | {schoolYear?.name}\n                </p>\n              </div>\n            </div>\n            {totals.remaining <= 0 ? (\n              <Button variant=\"success\" disabled>\n                <CashCoin size={16} className=\"me-2\" />\n                Paiements Complets\n              </Button>\n            ) : (\n              <Button\n                variant=\"primary\"\n                onClick={() => {\n                  setShowPaymentModal(true);\n                  // Réinitialiser les états du modal\n                  setModalDiscountInfo(null);\n                  setPaymentForm((prev) => ({\n                    ...prev,\n                    amount: \"\",\n                    apply_discount: false,\n                    versement_date: new Date().toISOString().split(\"T\")[0],\n                  }));\n                }}\n              >\n                <CashCoin size={16} className=\"me-2\" />\n                Nouveau Paiement\n              </Button>\n            )}\n          </div>\n        </Col>\n      </Row>\n\n      {/* Alerts */}\n      {error && (\n        <Alert variant=\"danger\" dismissible onClose={() => setError(\"\")}>\n          {error}\n        </Alert>\n      )}\n      {success && (\n        <Alert variant=\"success\" dismissible onClose={() => setSuccess(\"\")}>\n          {success}\n        </Alert>\n      )}\n\n      {/* Interface épurée - pas d'info sur les réductions au chargement initial */}\n\n      {/* Summary Cards */}\n      <Row className=\"mb-4\">\n        <Col md={4}>\n          <Card className=\"text-center\">\n            <Card.Body>\n              <h3 className=\"text-primary\">{formatAmount(totals.required)}</h3>\n              <p className=\"text-muted mb-0\">Total à payer</p>\n            </Card.Body>\n          </Card>\n        </Col>\n        <Col md={4}>\n          <Card className=\"text-center\">\n            <Card.Body>\n              <h3 className=\"text-success\">{formatAmount(totals.paid)}</h3>\n              <p className=\"text-muted mb-0\">Total payé</p>\n              {totals.has_global_discounts &&\n                totals.global_discount_amount > 0 && (\n                  <small className=\"text-info d-block mt-1\">\n                    {formatAmount(totals.paid)} +{\" \"}\n                    {formatAmount(totals.global_discount_amount)} ={\" \"}\n                    {formatAmount(totals.required)}\n                  </small>\n                )}\n            </Card.Body>\n          </Card>\n        </Col>\n        <Col md={4}>\n          <Card className=\"text-center\">\n            <Card.Body>\n              {totals.has_scholarships ? (\n                <>\n                  <h3\n                    className={\n                      totals.remaining > 0 ? \"text-warning\" : \"text-success\"\n                    }\n                  >\n                    {formatAmount(totals.remaining)}\n                  </h3>\n                  <p className=\"text-muted mb-0\">Reste à payer</p>\n                  <small className=\"text-success\">\n                    (Avec bourse de {formatAmount(totals.scholarship_amount)}{\" \"}\n                    déjà appliquée)\n                  </small>\n                </>\n              ) : (\n                <>\n                  <h3\n                    className={\n                      totals.remaining > 0 ? \"text-warning\" : \"text-success\"\n                    }\n                  >\n                    {formatAmount(totals.remaining)}\n                  </h3>\n                  <p className=\"text-muted mb-0\">Reste à payer</p>\n                </>\n              )}\n            </Card.Body>\n          </Card>\n        </Col>\n      </Row>\n\n      {/* Information sur la bourse (si applicable) */}\n      {totals.has_scholarships && totals.remaining > 0 && (\n        <Row className=\"mb-3\">\n          <Col>\n            <Alert variant=\"success\" className=\"text-center\">\n              <i className=\"bi bi-award me-2\"></i>\n              <strong>Bonne nouvelle !</strong> Vous bénéficiez d'une bourse de{\" \"}\n              {formatAmount(totals.scholarship_amount)}.\n              <br />\n              <small>\n                Cette réduction sera automatiquement appliquée lors du paiement.\n              </small>\n            </Alert>\n          </Col>\n        </Row>\n      )}\n\n      <Row>\n        {/* Payment Status */}\n        <Col md={7}>\n          <Card className=\"mb-4\">\n            <Card.Header className=\"d-flex justify-content-between align-items-center\">\n              <h5 className=\"mb-0\">Statut des Paiements par Tranche</h5>\n              {/* <Button \n                                variant=\"success\" \n                                size=\"sm\"\n                                onClick={() => handleQuickPayment()}\n                                disabled={totals.remaining <= 0}\n                            >\n                                💳 Paiement Rapide\n                            </Button> */}\n            </Card.Header>\n            <Card.Body>\n              <Table responsive>\n                <thead>\n                  <tr>\n                    <th>Tranche</th>\n                    <th>Montant Requis</th>\n                    <th>Montant Payé</th>\n                    <th>Reste</th>\n                    <th>Statut</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {paymentStatus.map((status, index) => (\n                    <tr\n                      key={index}\n                      className={\n                        status.is_physical_only\n                          ? \"table-info\"\n                          : status.is_optional\n                          ? \"table-secondary\"\n                          : \"\"\n                      }\n                    >\n                      <td>\n                        {status.tranche.name}\n                        {status.is_physical_only && (\n                          <small className=\"text-info d-block\">\n                            <strong>(Paiement physique uniquement)</strong>\n                          </small>\n                        )}\n                        {status.is_optional && !status.is_physical_only && (\n                          <small className=\"text-muted d-block\">\n                            (Optionnelle)\n                          </small>\n                        )}\n                      </td>\n                      <td>\n                        {status.is_physical_only ? (\n                          <span className=\"text-info\">Physical</span>\n                        ) : (\n                          <>\n                            {formatAmount(status.required_amount)}\n                            {status.has_global_discount &&\n                              status.global_discount_amount > 0 && (\n                                <div className=\"text-success\">\n                                  <small>\n                                    Avec réduction ({status.discount_percentage}\n                                    %):{\" \"}\n                                    {formatAmount(\n                                      parseFloat(status.required_amount) -\n                                        parseFloat(\n                                          status.global_discount_amount\n                                        )\n                                    )}\n                                  </small>\n                                </div>\n                              )}\n                          </>\n                        )}\n                      </td>\n                      <td>\n                        {status.is_physical_only ? (\n                          <span className=\"text-info\">Physical</span>\n                        ) : (\n                          <>\n                            {formatAmount(status.paid_amount)}\n                            {status.has_scholarship &&\n                              status.scholarship_amount > 0 && (\n                                <div className=\"text-success\">\n                                  <small>\n                                    + Bourse:{\" \"}\n                                    {formatAmount(status.scholarship_amount)}\n                                    <br />={\" \"}\n                                    {formatAmount(\n                                      parseFloat(status.paid_amount) +\n                                        parseFloat(status.scholarship_amount)\n                                    )}\n                                  </small>\n                                </div>\n                              )}\n                            {status.has_global_discount &&\n                              status.global_discount_amount > 0 && (\n                                <div className=\"text-success\">\n                                  <small>\n                                    + Réduction:{\" \"}\n                                    {formatAmount(\n                                      status.global_discount_amount\n                                    )}{\" \"}\n                                    ({status.discount_percentage}%)\n                                    <br />={\" \"}\n                                    {formatAmount(\n                                      parseFloat(status.paid_amount) +\n                                        parseFloat(\n                                          status.global_discount_amount\n                                        )\n                                    )}\n                                  </small>\n                                </div>\n                              )}\n                          </>\n                        )}\n                      </td>\n                      <td>\n                        {status.is_physical_only ? (\n                          <span className=\"text-info\">Physical</span>\n                        ) : (\n                          <>\n                            {status.has_scholarship &&\n                            status.scholarship_amount > 0 ? (\n                              <>\n                                {formatAmount(\n                                  Math.max(\n                                    0,\n                                    parseFloat(status.remaining_amount) \n                                  )\n                                )}\n                                {parseFloat(status.remaining_amount) -\n                                  parseFloat(status.scholarship_amount) >\n                                  0 && (\n                                  <div className=\"text-success\">\n                                    <small>\n                                      (Avec bourse:{\" \"}\n                                      {formatAmount(\n                                        Math.max(\n                                          0,\n                                          parseFloat(status.remaining_amount) \n                                            // parseFloat(\n                                            //   status.scholarship_amount\n                                            // )\n                                        )\n                                      )}\n                                      )\n                                    </small>\n                                  </div>\n                                )}\n                              </>\n                            ) : status.has_global_discount &&\n                              status.global_discount_amount > 0 ? (\n                              <>\n                                {formatAmount(\n                                  Math.max(\n                                    0,\n                                    parseFloat(status.remaining_amount) -\n                                      parseFloat(status.global_discount_amount)\n                                  )\n                                )}\n                                {parseFloat(status.remaining_amount) -\n                                  parseFloat(status.global_discount_amount) >\n                                  0 && (\n                                  <div className=\"text-success\">\n                                    <small>\n                                      (Avec réduction:{\" \"}\n                                      {formatAmount(\n                                        Math.max(\n                                          0,\n                                          parseFloat(status.remaining_amount) -\n                                            parseFloat(\n                                              status.global_discount_amount\n                                            )\n                                        )\n                                      )}\n                                      )\n                                    </small>\n                                  </div>\n                                )}\n                              </>\n                            ) : (\n                              formatAmount(status.remaining_amount)\n                            )}\n                          </>\n                        )}\n                      </td>\n                      <td>\n                        {status.is_physical_only ? (\n                          <>\n                            <Badge\n                              bg={status.rame_paid ? \"success\" : \"warning\"}\n                            >\n                              {status.rame_paid ? \"Payé\" : \"Non payé\"}\n                            </Badge>\n                            {!status.rame_paid && (\n                              <Button\n                                variant=\"outline-primary\"\n                                size=\"sm\"\n                                className=\"ms-2\"\n                                onClick={() => handlePayRame()}\n                              >\n                                Payer RAME\n                              </Button>\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <Badge\n                              bg={status.is_fully_paid ? \"success\" : \"warning\"}\n                            >\n                              {status.is_fully_paid\n                                ? status.has_scholarship &&\n                                  status.scholarship_amount > 0\n                                  ? \"Complet avec bourse\"\n                                  : \"Complet\"\n                                : \"Partiel\"}\n                            </Badge>\n                            {status.is_optional && !status.is_fully_paid && (\n                              <small className=\"text-muted d-block\">\n                                Non obligatoire\n                              </small>\n                            )}\n                          </>\n                        )}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </Table>\n            </Card.Body>\n          </Card>\n        </Col>\n\n        {/* Payment History */}\n        <Col md={5}>\n          {/* Section RAME en haut de la colonne de droite */}\n          <div className=\"mb-3\">\n            <RameStatusToggle\n              studentId={studentId}\n              studentName={\n                student\n                  ? `${student.first_name} ${student.last_name}`\n                  : \"Étudiant\"\n              }\n              onStatusChange={(newStatus) => {\n                console.log(\"Statut RAME mis à jour:\", newStatus);\n              }}\n            />\n          </div>\n\n          <Card>\n            <Card.Header>\n              <h5 className=\"mb-0\">Historique des Paiements</h5>\n            </Card.Header>\n            <Card.Body>\n              {paymentHistory.length === 0 ? (\n                <p className=\"text-muted text-center\">\n                  Aucun paiement enregistré\n                </p>\n              ) : (\n                <div style={{ maxHeight: \"400px\", overflowY: \"auto\" }}>\n                  {paymentHistory.map((payment) => (\n                    <div key={payment.id} className=\"border-bottom pb-3 mb-3\">\n                      <div className=\"d-flex justify-content-between align-items-start\">\n                        <div>\n                          <strong>{formatAmount(payment.total_amount)}</strong>\n                          {payment.has_scholarship && (\n                            <div className=\"text-success mt-1\">\n                              <small>\n                                Montant payé:{\" \"}\n                                {formatAmount(payment.total_amount)} + Bourse\n                                appliquée:{\" \"}\n                                {formatAmount(payment.scholarship_amount)} =\n                                Valeur totale:{\" \"}\n                                {formatAmount(\n                                  payment.total_amount +\n                                    payment.scholarship_amount\n                                )}\n                              </small>\n                            </div>\n                          )}\n                          {payment.has_reduction &&\n                            payment.reduction_amount > 0 && (\n                              <div className=\"text-info mt-1\">\n                                <small>\n                                  Montant payé:{\" \"}\n                                  {formatAmount(payment.total_amount)} +\n                                  Réduction appliquée:{\" \"}\n                                  {formatAmount(payment.reduction_amount)} =\n                                  Valeur totale:{\" \"}\n                                  {formatAmount(\n                                    payment.total_amount +\n                                      payment.reduction_amount\n                                  )}\n                                </small>\n                              </div>\n                            )}\n                          {(payment.has_scholarship ||\n                            payment.has_reduction) && (\n                            <span\n                              className={`badge ms-2 ${\n                                payment.has_scholarship\n                                  ? \"bg-success\"\n                                  : \"bg-info\"\n                              }`}\n                            >\n                              {payment.has_scholarship && payment.has_reduction\n                                ? \"Bourse + Réduction\"\n                                : payment.has_scholarship\n                                ? \"Avec Bourse\"\n                                : \"Avec Réduction\"}\n                            </span>\n                          )}\n                          <br />\n                          <div className=\"text-muted d-flex align-items-center gap-3\">\n                            <small className=\"text-muted d-flex align-items-center mt-2\">\n                              <Calendar size={14} className=\"me-1\" />\n                              {formatDate(payment.payment_date)}\n                            </small>\n                            <br />\n                            <small className=\"text-muted d-flex align-items-center\">\n                              <CreditCard size={14} className=\"me-1\" />\n                              {getPaymentMethodLabel(\n                                payment.payment_method,\n                                payment.is_rame_physical\n                              )}\n                            </small>\n                          </div>\n\n                          {/* Affichage des réductions appliquées */}\n                          {(payment.has_scholarship ||\n                            payment.has_reduction) && (\n                            <div className=\"mt-2\">\n                              {payment.has_scholarship && (\n                                <div className=\"badge bg-success me-1 mb-1\">\n                                  Bourse:{\" \"}\n                                  {formatAmount(payment.scholarship_amount)}\n                                </div>\n                              )}\n                              {payment.has_reduction &&\n                                payment.reduction_amount > 0 && (\n                                  <div className=\"badge bg-info me-1 mb-1\">\n                                    Réduction:{\" \"}\n                                    {formatAmount(payment.reduction_amount)}\n                                  </div>\n                                )}\n                              {payment.discount_reason && (\n                                <small className=\"text-success d-block\">\n                                  <em>{payment.discount_reason}</em>\n                                </small>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                        <div className=\"d-flex gap-1\">\n                          <Button\n                            variant=\"outline-success\"\n                            size=\"sm\"\n                            disabled={isPrintingReceipt}\n                            onClick={() =>\n                              handleDownloadPDFFromHistory(payment.id)\n                            }\n                            title={isPrintingReceipt ? \"Téléchargement en cours...\" : \"Télécharger le PDF\"}\n                          >\n                            {isPrintingReceipt ? (\n                              <Spinner size=\"sm\" />\n                            ) : (\n                              <>📄</>\n                            )}\n                          </Button>\n                          <Button\n                            variant=\"outline-primary\"\n                            size=\"sm\"\n                            disabled={isPrintingReceipt}\n                            onClick={() =>\n                              handlePrintReceiptFromHistory(payment.id)\n                            }\n                            title={isPrintingReceipt ? \"Impression en cours...\" : \"Imprimer le reçu\"}\n                          >\n                            {isPrintingReceipt ? (\n                              <Spinner size=\"sm\" />\n                            ) : (\n                              <Receipt size={14} />\n                            )}\n                          </Button>\n                        </div>\n                      </div>\n                      {payment.notes && (\n                        <small className=\"text-muted d-block mt-1\">\n                          Note: {payment.notes}\n                        </small>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </Card.Body>\n          </Card>\n        </Col>\n      </Row>\n\n      {/* Payment Modal */}\n      <Modal show={showPaymentModal} onHide={handleModalClose} size=\"lg\">\n        <Modal.Header closeButton>\n          <Modal.Title>Nouveau Paiement</Modal.Title>\n        </Modal.Header>\n        <Form onSubmit={handlePaymentSubmit}>\n          <Modal.Body>\n            <Row>\n              <Col md={6}>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>\n                    Montant du versement ({schoolSettings.currency || \"FCFA\"}) *\n                  </Form.Label>\n                  <Form.Control\n                    type=\"number\"\n                    min=\"1\"\n                    max={totals.remaining}\n                    step=\"1\"\n                    value={paymentForm.amount}\n                    onChange={(e) => handleAmountChange(e.target.value)}\n                    placeholder=\"Ex: 25000\"\n                    required\n                  />\n                  <Form.Text className=\"text-muted\">\n                    Reste à payer: {formatAmount(totals.remaining)}\n                    <br />\n                    {paymentForm.payment_method === \"rame_physical\" ? (\n                      <small className=\"text-info\">\n                        ℹ️ Paiement par rame physique - Montant équivalent de la\n                        tranche RAME\n                      </small>\n                    ) : (\n                      <small className=\"text-warning\">\n                        ⚠️ Le montant ne peut pas dépasser le solde restant\n                      </small>\n                    )}\n                  </Form.Text>\n                </Form.Group>\n              </Col>\n              <Col md={6}>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>Mode de paiement *</Form.Label>\n                  <Form.Select\n                    value={paymentForm.payment_method}\n                    onChange={(e) => {\n                      const newMethod = e.target.value;\n                      setPaymentForm({\n                        ...paymentForm,\n                        payment_method: newMethod,\n                        is_rame_physical: false, // Reset RAME choice when method changes\n                      });\n                    }}\n                    required\n                  >\n                    <option value=\"cash\">Banque</option>\n                    <option value=\"card\">Carte bancaire</option>\n                    <option value=\"transfer\">Virement</option>\n                    <option value=\"check\">Chèque</option>\n                  </Form.Select>\n                </Form.Group>\n              </Col>\n            </Row>\n\n            {/* Anciennes sections de réduction supprimées - maintenant intégrées dans la logique de date */}\n\n            <Row>\n              <Col md={6}>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>Date de versement *</Form.Label>\n                  <Form.Control\n                    type=\"date\"\n                    value={paymentForm.versement_date}\n                    onChange={(e) => {\n                      setPaymentForm({\n                        ...paymentForm,\n                        versement_date: e.target.value,\n                      });\n                      // Vérifier l'éligibilité aux réductions quand la date change\n                      checkDiscountEligibilityInModal(e.target.value);\n                    }}\n                    required\n                  />\n                  <Form.Text className=\"text-muted\">\n                    Date effective du versement de l'étudiant\n                  </Form.Text>\n                </Form.Group>\n              </Col>\n              <Col md={6}>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>\n                    Date de validation{\" \"}\n                    <small className=\"text-muted\">(automatique)</small>\n                  </Form.Label>\n                  <Form.Control\n                    type=\"date\"\n                    value={paymentForm.payment_date}\n                    onChange={(e) =>\n                      setPaymentForm({\n                        ...paymentForm,\n                        payment_date: e.target.value,\n                      })\n                    }\n                  />\n                  <Form.Text className=\"text-muted\">\n                    Date officielle d'enregistrement du paiement dans le\n                    système.\n                  </Form.Text>\n                </Form.Group>\n              </Col>\n            </Row>\n\n            {/* Section de réduction dynamique basée sur la date de versement */}\n            {isCheckingDiscount && (\n              <Row className=\"mb-3\">\n                <Col>\n                  <div className=\"text-center\">\n                    <Spinner animation=\"border\" size=\"sm\" className=\"me-2\" />\n                    <small className=\"text-muted\">\n                      Vérification des réductions disponibles...\n                    </small>\n                  </div>\n                </Col>\n              </Row>\n            )}\n\n            {modalDiscountInfo &&\n              !modalDiscountInfo.not_eligible &&\n              !modalDiscountInfo.is_date_expired && (\n                <Row className=\"mb-3\">\n                  <Col>\n                    <Card className=\"bg-success bg-opacity-10 border-success\">\n                      <Card.Body className=\"py-3\">\n                        <div className=\"d-flex align-items-center justify-content-between\">\n                          <div>\n                            <h6 className=\"text-success mb-1\">\n                              🎉 Réduction de{\" \"}\n                              {modalDiscountInfo.discount_percentage}%\n                              disponible !\n                            </h6>\n                            <small className=\"text-muted\">\n                              Économisez{\" \"}\n                              {formatAmount(\n                                modalDiscountInfo.normal_totals.total_discount\n                              )}\n                              en payant{\" \"}\n                              {formatAmount(\n                                modalDiscountInfo.normal_totals\n                                  .total_with_discount\n                              )}\n                              au lieu de{\" \"}\n                              {formatAmount(\n                                modalDiscountInfo.normal_totals.total_required\n                              )}\n                            </small>\n                          </div>\n                          <Form.Check\n                            type=\"checkbox\"\n                            label=\"Appliquer la réduction\"\n                            checked={paymentForm.apply_discount}\n                            onChange={(e) =>\n                              handleDiscountToggle(e.target.checked)\n                            }\n                            className=\"text-success\"\n                          />\n                        </div>\n                        {paymentForm.apply_discount && (\n                          <div className=\"mt-2 p-2 bg-success bg-opacity-25 rounded\">\n                            <small className=\"text-success\">\n                              ✅ <strong>Réduction activée :</strong> Le montant\n                              sera automatiquement réparti sur toutes les\n                              tranches avec les montants réduits.\n                            </small>\n                          </div>\n                        )}\n                      </Card.Body>\n                    </Card>\n                  </Col>\n                </Row>\n              )}\n\n            {modalDiscountInfo && modalDiscountInfo.is_date_expired && (\n              <Row className=\"mb-3\">\n                <Col>\n                  <Card className=\"bg-warning bg-opacity-10 border-warning\">\n                    <Card.Body className=\"py-3\">\n                      <h6 className=\"text-warning mb-1\">\n                        ⏰ {modalDiscountInfo.deadline_message}\n                      </h6>\n                      <small className=\"text-muted\">\n                        La réduction de {modalDiscountInfo.discount_percentage}%\n                        n'est plus disponible pour cette date de versement.\n                      </small>\n                    </Card.Body>\n                  </Card>\n                </Col>\n              </Row>\n            )}\n\n            {modalDiscountInfo && modalDiscountInfo.not_eligible && (\n              <Row className=\"mb-3\">\n                <Col>\n                  <Card className=\"bg-secondary bg-opacity-10 border-secondary\">\n                    <Card.Body className=\"py-3\">\n                      <h6 className=\"text-muted mb-1\">\n                        ℹ️ Réduction non disponible\n                      </h6>\n                      <small className=\"text-muted\">\n                        {modalDiscountInfo.message}\n                      </small>\n                    </Card.Body>\n                  </Card>\n                </Col>\n              </Row>\n            )}\n\n            <Row>\n              <Col md={6}>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>Numéro de référence</Form.Label>\n                  <Form.Control\n                    type=\"text\"\n                    value={paymentForm.reference_number}\n                    onChange={(e) =>\n                      setPaymentForm({\n                        ...paymentForm,\n                        reference_number: e.target.value,\n                      })\n                    }\n                    placeholder=\"Numéro chèque, virement...\"\n                  />\n                </Form.Group>\n              </Col>\n              <Col md={6}>{/* Empty column for spacing */}</Col>\n            </Row>\n\n            <Row>\n              <Col>\n                <Form.Group className=\"mb-3\">\n                  <Form.Label>Notes</Form.Label>\n                  <Form.Control\n                    as=\"textarea\"\n                    rows={3}\n                    value={paymentForm.notes}\n                    onChange={(e) =>\n                      setPaymentForm({ ...paymentForm, notes: e.target.value })\n                    }\n                    placeholder=\"Notes additionnelles...\"\n                  />\n                </Form.Group>\n              </Col>\n            </Row>\n          </Modal.Body>\n          <Modal.Footer>\n            <Button variant=\"secondary\" onClick={handleModalClose}>\n              Annuler\n            </Button>\n            <Button variant=\"primary\" type=\"submit\" disabled={paymentLoading}>\n              {paymentLoading ? (\n                <>\n                  <Spinner animation=\"border\" size=\"sm\" className=\"me-2\" />\n                  Enregistrement...\n                </>\n              ) : (\n                <>\n                  <Check size={16} className=\"me-2\" />\n                  Enregistrer le Paiement\n                </>\n              )}\n            </Button>\n          </Modal.Footer>\n        </Form>\n      </Modal>\n\n      {/* Receipt Modal */}\n      <Modal\n        show={showReceiptModal}\n        onHide={() => setShowReceiptModal(false)}\n        size=\"lg\"\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>Reçu de Paiement</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <div dangerouslySetInnerHTML={{ __html: receiptHtml }} />\n        </Modal.Body>\n        <Modal.Footer>\n          <Button\n            variant=\"secondary\"\n            onClick={() => setShowReceiptModal(false)}\n          >\n            Fermer\n          </Button>\n          <Button \n            variant=\"success\" \n            onClick={downloadReceiptPDF}\n            disabled={isPrintingReceipt}\n            className=\"me-2\"\n          >\n            {isPrintingReceipt ? (\n              <>\n                <Spinner size=\"sm\" className=\"me-2\" />\n                Téléchargement...\n              </>\n            ) : (\n              <>\n                📄 PDF\n              </>\n            )}\n          </Button>\n          {/* <Button \n            variant=\"primary\" \n            onClick={printReceipt}\n            disabled={isPrintingReceipt}\n          >\n            {isPrintingReceipt ? (\n              <>\n                <Spinner size=\"sm\" className=\"me-2\" />\n                Ouverture...\n              </>\n            ) : (\n              <>\n                <Printer size={16} className=\"me-2\" />\n                Imprimer\n              </>\n            )}\n          </Button> */}\n        </Modal.Footer>\n      </Modal>\n    </Container>\n  );\n};\n\nexport default StudentPayment;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}