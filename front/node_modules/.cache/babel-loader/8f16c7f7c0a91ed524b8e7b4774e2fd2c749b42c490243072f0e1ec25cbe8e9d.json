{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{Plus,PencilSquare,Trash,Download,Upload,Person,Calendar,GeoAlt,Telephone,Envelope,Search,Grid,List,ArrowLeft,SortAlphaDown,GripVertical,Camera,X,Image,CashCoin,Printer,ArrowRightCircle}from'react-bootstrap-icons';import{secureApiEndpoints}from'../../utils/apiMigration';import{useAuth}from'../../hooks/useAuth';import{useSchool}from'../../contexts/SchoolContext';import{authService}from'../../services/authService';import ImportExportButton from'../../components/ImportExportButton';import BulkPhotoUpload from'../../components/BulkPhotoUpload';import StudentCardPrint from'../../components/StudentCardPrint';import StudentTransfer from'../../components/StudentTransfer';import StudentActionsDropdown from'../../components/StudentActionsDropdown';import Swal from'sweetalert2';import{DndContext,closestCenter,KeyboardSensor,PointerSensor,useSensor,useSensors}from'@dnd-kit/core';import{arrayMove,SortableContext,sortableKeyboardCoordinates,verticalListSortingStrategy}from'@dnd-kit/sortable';import{useSortable}from'@dnd-kit/sortable';import{CSS}from'@dnd-kit/utilities';import{host}from'../../utils/fetch';// Composant pour afficher les photos d'élèves avec fallback\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const StudentPhoto=_ref=>{let{student,size=40,className=\"\"}=_ref;const[imageError,setImageError]=useState(false);if(!student.photo_url||imageError){return/*#__PURE__*/_jsx(\"div\",{className:`bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center ${className}`,style:{width:`${size}px`,height:`${size}px`},children:/*#__PURE__*/_jsx(Person,{className:\"text-primary\",size:Math.floor(size*0.5)})});}return/*#__PURE__*/_jsx(\"img\",{src:student.photo_url,alt:student.full_name||`${student.last_name} ${student.first_name}`,className:`rounded-circle ${className}`,style:{width:`${size}px`,height:`${size}px`,objectFit:'cover'},onError:()=>setImageError(true)});};// Composant pour les éléments sortables\nconst SortableStudent=_ref2=>{let{student,handleEdit,handleDelete,handlePrintCard,handleTransferStudent,handleViewStudent,handleViewPayments,handleStatusChange,navigate,userRole}=_ref2;const{attributes,listeners,setNodeRef,transform,transition,isDragging}=useSortable({id:student.id});const style={transform:CSS.Transform.toString(transform),transition,opacity:isDragging?0.5:1};return/*#__PURE__*/_jsxs(\"tr\",{ref:setNodeRef,style:style,className:isDragging?'dragging':'',children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{...attributes,...listeners,className:\"drag-handle me-2\",style:{cursor:'grab'},children:/*#__PURE__*/_jsx(GripVertical,{size:14,className:\"text-muted\"})}),/*#__PURE__*/_jsx(StudentPhoto,{student:student,size:32,className:\"me-2\"}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"N\\xB0 \",student.student_number]})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"fw-medium\",children:student.full_name||`${student.last_name||student.subname||''} ${student.first_name||student.name||''}`}),student.student_status==='old'&&/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-success bg-opacity-25 text-success small mt-1\",children:\"Ancien \\xE9l\\xE8ve\"})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[student.date_of_birth&&/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center small mb-1\",children:[/*#__PURE__*/_jsx(Calendar,{size:12,className:\"me-2 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{children:new Date(student.date_of_birth).toLocaleDateString('fr-FR')})]}),student.place_of_birth&&/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center small text-muted\",children:[/*#__PURE__*/_jsx(GeoAlt,{size:12,className:\"me-2 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{children:student.place_of_birth})]})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:`badge ${student.gender==='M'?'bg-info':'bg-pink'}`,children:student.gender==='M'?'Masculin':'Féminin'})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"select\",{className:`form-select form-select-sm ${student.student_status==='old'?'text-success':'text-primary'}`,value:student.student_status||'new',onChange:e=>handleStatusChange(student.id,e.target.value),style:{minWidth:'100px'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"new\",children:\"Nouveau\"}),/*#__PURE__*/_jsx(\"option\",{value:\"old\",children:\"Ancien\"})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"small\",children:student.parent_name||student.father_name||'-'})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[student.parent_phone&&/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center small mb-1\",children:[/*#__PURE__*/_jsx(Telephone,{size:12,className:\"me-2 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{children:student.parent_phone})]}),student.parent_email&&/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center small text-muted\",children:[/*#__PURE__*/_jsx(Envelope,{size:12,className:\"me-2 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{children:student.parent_email})]})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",children:student.has_scholarship_enabled?/*#__PURE__*/_jsxs(\"span\",{className:\"badge bg-success bg-opacity-25 text-success\",children:[/*#__PURE__*/_jsx(CashCoin,{size:12,className:\"me-1\"}),\"Activ\\xE9e\"]}):/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-secondary bg-opacity-25 text-muted\",children:\"D\\xE9sactiv\\xE9e\"})})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(StudentActionsDropdown,{student:student,onPrintCard:handlePrintCard,onTransfer:handleTransferStudent,onEdit:handleEdit,onDelete:handleDelete,onViewPayments:handleViewPayments,onViewStudent:handleViewStudent,userRole:userRole})})]});};const SeriesStudents=()=>{var _series$school_class,_series$school_class$,_series$school_class$2,_series$school_class2,_series$school_class3,_series$school_class4;const{seriesId}=useParams();const navigate=useNavigate();const{user}=useAuth();const{schoolSettings,formatCurrency}=useSchool();const[students,setStudents]=useState([]);const[series,setSeries]=useState(null);const[schoolYear,setSchoolYear]=useState(null);const[schoolYears,setSchoolYears]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[success,setSuccess]=useState('');const[hasCustomOrder,setHasCustomOrder]=useState(false);// Sensors pour le drag & drop\nconst sensors=useSensors(useSensor(PointerSensor),useSensor(KeyboardSensor,{coordinateGetter:sortableKeyboardCoordinates}));// Filters and search\nconst[searchTerm,setSearchTerm]=useState('');const[statusFilter,setStatusFilter]=useState('all');const[viewMode,setViewMode]=useState('list');// Modal states\nconst[showAddModal,setShowAddModal]=useState(false);const[showEditModal,setShowEditModal]=useState(false);const[showImportModal,setShowImportModal]=useState(false);const[showCardPrint,setShowCardPrint]=useState(false);const[showTransferModal,setShowTransferModal]=useState(false);const[showStudentsListModal,setShowStudentsListModal]=useState(false);const[selectedStudent,setSelectedStudent]=useState(null);const[newStudentForCard,setNewStudentForCard]=useState(null);const[studentToTransfer,setStudentToTransfer]=useState(null);// Form data\nconst[formData,setFormData]=useState({first_name:'',last_name:'',date_of_birth:'',place_of_birth:'',gender:'M',parent_name:'',parent_phone:'',parent_email:'',mother_name:'',mother_phone:'',address:'',class_series_id:seriesId,student_status:'new',has_scholarship_enabled:false});// Photo states\nconst[studentPhoto,setStudentPhoto]=useState(null);const[photoPreview,setPhotoPreview]=useState('');const[showCamera,setShowCamera]=useState(false);const[cameraStream,setCameraStream]=useState(null);// Import data\nconst[importFile,setImportFile]=useState(null);const[selectedSchoolYear,setSelectedSchoolYear]=useState('');useEffect(()=>{loadStudents();loadSchoolYears();},[seriesId]);// Cleanup camera stream on unmount\nuseEffect(()=>{return()=>{if(cameraStream){cameraStream.getTracks().forEach(track=>track.stop());}};},[cameraStream]);const loadStudents=async()=>{try{setLoading(true);const response=await secureApiEndpoints.students.getByClassSeries(seriesId);if(response.success){setStudents(response.data.students);setSeries(response.data.series);setSchoolYear(response.data.school_year);// L'année scolaire est maintenant gérée automatiquement par le backend\n// Vérifier si les élèves ont un ordre personnalisé\nconst hasCustom=response.data.students.some(student=>student.order!=null);setHasCustomOrder(hasCustom);}else{setError(response.message||'Erreur lors du chargement des élèves');}}catch(error){console.error('Error loading students:',error);setError('Erreur lors du chargement des élèves');}finally{setLoading(false);}};const downloadStudentsListPdf=async()=>{try{setLoading(true);setError('');const response=await fetch(`${host}/api/students/export/pdf/${seriesId}`,{method:'GET',headers:{'Authorization':`Bearer ${authService.getToken()}`,'Accept':'application/pdf'}});if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}const pdfBlob=await response.blob();const blobUrl=window.URL.createObjectURL(pdfBlob);// Créer un lien de téléchargement\nconst link=document.createElement('a');link.href=blobUrl;link.download=`liste_eleves_${(series===null||series===void 0?void 0:series.name)||'serie'}_${new Date().toISOString().split('T')[0]}.pdf`;document.body.appendChild(link);link.click();document.body.removeChild(link);setTimeout(()=>window.URL.revokeObjectURL(blobUrl),1000);setSuccess('Liste des élèves téléchargée avec succès');}catch(error){console.error('Error downloading students list PDF:',error);setError('Erreur lors du téléchargement de la liste PDF');}finally{setLoading(false);}};const loadSchoolYears=async()=>{try{const response=await secureApiEndpoints.students.getSchoolYears();if(response.success){setSchoolYears(response.data);const currentYear=response.data.find(year=>year.is_current);if(currentYear){setSelectedSchoolYear(currentYear.id);}}}catch(error){console.error('Error loading school years:',error);}};const handleSubmit=async e=>{e.preventDefault();// Validation côté client\nconst requiredFields=['first_name','last_name','date_of_birth','place_of_birth','gender','parent_name'];const missingFields=requiredFields.filter(field=>!formData[field]||formData[field].trim()==='');if(missingFields.length>0){setError(`Champs obligatoires manquants: ${missingFields.map(field=>{const labels={first_name:'Prénom',last_name:'Nom',date_of_birth:'Date de naissance',place_of_birth:'Lieu de naissance',gender:'Sexe',parent_name:'Nom du parent'};return labels[field];}).join(', ')}`);return;}// L'année scolaire est maintenant gérée automatiquement par le backend\nif(!seriesId){setError('Série de classe manquante');return;}// Debug: afficher les données avant envoi\nconsole.log('Form data before submission:',formData);console.log('School year:',schoolYear);console.log('Series ID:',seriesId);try{setLoading(true);setError('');// Préparer les données finales (school_year_id géré automatiquement par le backend)\nconst finalFormData={...formData,class_series_id:parseInt(seriesId)};// Validation finale des IDs\nif(!finalFormData.class_series_id||isNaN(finalFormData.class_series_id)){setError('ID de série de classe invalide');return;}console.log('Final form data:',finalFormData);let response;// Debug pour l'édition\nif(selectedStudent){console.log('Editing student:',selectedStudent.id);console.log('Has new photo:',!!studentPhoto);console.log('Student photo type:',typeof studentPhoto);console.log('Student photo:',studentPhoto);}// Si on a une photo, utiliser FormData, sinon utiliser JSON\nif(studentPhoto){// Créer FormData pour inclure la photo\nconst formDataToSend=new FormData();// Ajouter tous les champs du formulaire \nObject.keys(finalFormData).forEach(key=>{const value=finalFormData[key];// S'assurer que les valeurs ne sont pas undefined ou null\nif(value!==undefined&&value!==null&&value!==''){formDataToSend.append(key,String(value));}else if(['first_name','last_name','date_of_birth','place_of_birth','gender','parent_name','class_series_id'].includes(key)){// Pour les champs requis, utiliser une chaîne vide si la valeur est manquante\nformDataToSend.append(key,'');}});// Ajouter la photo\nformDataToSend.append('photo',studentPhoto);// Debug: afficher le contenu de FormData\nconsole.log('FormData contents:');for(let[key,value]of formDataToSend.entries()){console.log(`${key}:`,value);}response=selectedStudent?await secureApiEndpoints.students.updateWithPhoto(selectedStudent.id,formDataToSend):await secureApiEndpoints.students.createWithPhoto(formDataToSend);}else{// Pas de photo, utiliser l'API normale avec JSON\nconst jsonData={...formData,class_series_id:parseInt(seriesId)};response=selectedStudent?await secureApiEndpoints.students.update(selectedStudent.id,jsonData):await secureApiEndpoints.students.create(jsonData);}if(response.success){setSuccess(response.message||`Élève ${selectedStudent?'modifié':'créé'} avec succès`);resetForm();setShowAddModal(false);setShowEditModal(false);loadStudents();// Si c'est une création d'élève (pas une modification), proposer l'impression de la carte\nif(!selectedStudent&&response.data){// Enrichir les données de l'élève créé avec les infos de la série\nconst enrichedStudent={...response.data,class_series:series,current_class:series===null||series===void 0?void 0:series.name};setNewStudentForCard(enrichedStudent);Swal.fire({title:'Élève créé avec succès !',text:'Voulez-vous imprimer sa carte scolaire maintenant ?',icon:'success',showCancelButton:true,confirmButtonText:'🖨️ Imprimer la carte',cancelButtonText:'Plus tard',confirmButtonColor:'#28a745',cancelButtonColor:'#6c757d'}).then(result=>{if(result.isConfirmed){setShowCardPrint(true);}});}else{Swal.fire({title:'Succès',text:response.message||`Élève ${selectedStudent?'modifié':'créé'} avec succès`,icon:'success',timer:2000,showConfirmButton:false});}}else{setError(response.message||`Erreur lors de ${selectedStudent?'la modification':'la création'} de l'élève`);}}catch(error){console.error('Error saving student:',error);console.error('Error details:',error.message);// Essayer d'extraire le message d'erreur détaillé\nlet errorMessage=`Erreur lors de ${selectedStudent?'la modification':'la création'} de l'élève`;if(error.message){// Si c'est une erreur de validation avec détails\ntry{const errorData=JSON.parse(error.message);if(errorData.errors){const validationErrors=Object.entries(errorData.errors).map(_ref3=>{let[field,messages]=_ref3;return`${field}: ${messages.join(', ')}`;}).join('\\n');errorMessage+=`\\n\\nDétails:\\n${validationErrors}`;}}catch(parseError){// Si ce n'est pas du JSON, utiliser le message tel quel\nerrorMessage+=`\\n\\nDétails: ${error.message}`;}}setError(errorMessage);}finally{setLoading(false);}};const handlePrintCard=student=>{// Enrichir les données de l'élève avec les infos de la série\nconst enrichedStudent={...student,class_series:series,current_class:series===null||series===void 0?void 0:series.name};setNewStudentForCard(enrichedStudent);setShowCardPrint(true);};const handleTransferStudent=student=>{// Enrichir les données de l'élève avec les infos de la série actuelle\nconst enrichedStudent={...student,class_series:series,class_series_id:series===null||series===void 0?void 0:series.id,current_class:series===null||series===void 0?void 0:series.name};setStudentToTransfer(enrichedStudent);setShowTransferModal(true);};const handleTransferSuccess=(transferredStudent,newClassInfo)=>{// Recharger la liste des étudiants pour refléter le changement\nloadStudents();// Optionnel: message de confirmation déjà géré dans le composant StudentTransfer\nconsole.log(`Élève transféré vers ${newClassInfo.className} - ${newClassInfo.seriesName}`);};const handleViewStudent=student=>{// Naviguer vers la page détaillée de l'élève ou ouvrir un modal\nconsole.log('Voir élève:',student);// navigate(`/students/${student.id}`); // Si vous avez une page dédiée\n};const handleViewPayments=student=>{// Naviguer vers la page des paiements de l'élève\nnavigate(`/student-payment/${student.id}`);};const handleEdit=student=>{setSelectedStudent(student);// Convertir la date au format YYYY-MM-DD pour l'input HTML\nlet dateOfBirth='';if(student.date_of_birth){try{const date=new Date(student.date_of_birth);if(!isNaN(date.getTime())){dateOfBirth=date.toISOString().split('T')[0];}}catch(error){console.error('Error parsing date:',error);}}setFormData({first_name:student.first_name||'',last_name:student.last_name||'',date_of_birth:dateOfBirth,place_of_birth:student.place_of_birth||'',gender:student.gender||'M',parent_name:student.parent_name||'',parent_phone:student.parent_phone||'',parent_email:student.parent_email||'',mother_name:student.mother_name||'',mother_phone:student.mother_phone||'',address:student.address||'',class_series_id:seriesId,student_status:student.student_status||'new',has_scholarship_enabled:student.has_scholarship_enabled||false// school_year_id géré automatiquement par le backend\n});// Charger la photo existante\nif(student.photo_url){setPhotoPreview(student.photo_url);}else{setPhotoPreview('');}setStudentPhoto(null);// Reset file input for new photo\nsetShowEditModal(true);};const handleStatusChange=async(studentId,newStatus)=>{try{const response=await secureApiEndpoints.students.updateStatus(studentId,newStatus);if(response.success){// Mettre à jour l'état local\nsetStudents(prevStudents=>prevStudents.map(student=>student.id===studentId?{...student,student_status:newStatus}:student));setSuccess(`Statut mis à jour: ${newStatus==='old'?'Ancien élève':'Nouvel élève'}`);setTimeout(()=>setSuccess(''),3000);}else{setError(response.message||'Erreur lors de la mise à jour du statut');}}catch(error){setError('Erreur lors de la mise à jour du statut');console.error('Error updating student status:',error);}};const handleDelete=async student=>{const result=await Swal.fire({title:'Confirmer la suppression',text:`Êtes-vous sûr de vouloir supprimer l'élève \"${student.full_name}\" ?`,icon:'warning',showCancelButton:true,confirmButtonColor:'#EF4444',cancelButtonColor:'#6B7280',confirmButtonText:'Oui, supprimer',cancelButtonText:'Annuler'});if(result.isConfirmed){try{const response=await secureApiEndpoints.students.delete(student.id);if(response.success){loadStudents();setSuccess(response.message||'Élève supprimé avec succès');Swal.fire({title:'Supprimé',text:response.message||'Élève supprimé avec succès',icon:'success',timer:2000,showConfirmButton:false});}else{setError(response.message||'Erreur lors de la suppression de l\\'élève');}}catch(error){console.error('Error deleting student:',error);setError('Erreur lors de la suppression de l\\'élève');}}};const handleExportCsv=async()=>{try{var _series$name;setLoading(true);console.log('Exporting CSV for series:',seriesId);const blob=await secureApiEndpoints.students.exportCsv(seriesId);// Créer le lien de téléchargement\nconst url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`eleves_${(series===null||series===void 0?void 0:(_series$name=series.name)===null||_series$name===void 0?void 0:_series$name.replace(/[^a-zA-Z0-9]/g,'_'))||'serie'}_${new Date().toISOString().split('T')[0]}.csv`;document.body.appendChild(a);a.click();document.body.removeChild(a);window.URL.revokeObjectURL(url);setSuccess('Export CSV réalisé avec succès');}catch(error){console.error('Error exporting CSV:',error);setError('Erreur lors de l\\'export CSV: '+error.message);}finally{setLoading(false);}};const handleExportPdf=async()=>{try{setLoading(true);console.log('Exporting PDF for series:',seriesId);const response=await secureApiEndpoints.students.exportPdf(seriesId);// Le backend retourne du HTML formaté pour impression\nconst htmlContent=await response.text();// Créer une nouvelle fenêtre avec le HTML formaté\nconst printWindow=window.open('','_blank');printWindow.document.write(htmlContent);printWindow.document.close();// Attendre que le contenu soit chargé puis déclencher l'impression\nprintWindow.onload=()=>{setTimeout(()=>{printWindow.focus();printWindow.print();},500);};setSuccess('Fenêtre d\\'impression ouverte. Vous pouvez maintenant imprimer ou sauvegarder en PDF.');}catch(error){console.error('Error exporting PDF:',error);setError('Erreur lors de l\\'export PDF: '+error.message);}finally{setLoading(false);}};const handleImportCsv=async e=>{e.preventDefault();// Validation détaillée\nif(!importFile){setError('Veuillez sélectionner un fichier CSV');return;}if(!selectedSchoolYear){setError('Veuillez sélectionner une année scolaire');return;}if(!seriesId){setError('ID de série manquant');return;}// Validation du type de fichier\nconst validTypes=['text/csv','application/csv','text/plain'];const fileExtension=importFile.name.toLowerCase().split('.').pop();if(!validTypes.includes(importFile.type)&&fileExtension!=='csv'){setError('Le fichier doit être au format CSV (.csv)');return;}try{var _schoolYears$find;setLoading(true);setError('');// Clear any previous errors\nconst formData=new FormData();formData.append('file',importFile);// class_series_id et school_year_id gérés automatiquement par la nouvelle route\n// Debug log détaillé\nconsole.log('Import CSV - FormData contents:',{file:{name:importFile.name,type:importFile.type,size:importFile.size,lastModified:importFile.lastModified},seriesIdFromUrl:seriesId,seriesInfo:series===null||series===void 0?void 0:series.name,schoolYearInfo:(_schoolYears$find=schoolYears.find(y=>y.id==selectedSchoolYear))===null||_schoolYears$find===void 0?void 0:_schoolYears$find.name});// Vérifier que FormData contient bien les données\nfor(let[key,value]of formData.entries()){console.log('FormData entry:',key,value);}const response=await secureApiEndpoints.students.importCsv(formData,seriesId);if(response.success){setSuccess(response.message);setShowImportModal(false);setImportFile(null);loadStudents();// Afficher les erreurs s'il y en a\nif(response.data.errors&&response.data.errors.length>0){Swal.fire({title:'Import terminé avec des erreurs',html:`\n                            <p><strong>${response.data.imported} élève(s) importé(s)</strong></p>\n                            <p>Erreurs :</p>\n                            <ul style=\"text-align: left;\">\n                                ${response.data.errors.map(error=>`<li>${error}</li>`).join('')}\n                            </ul>\n                        `,icon:'warning'});}else{Swal.fire({title:'Import réussi',text:response.message,icon:'success',timer:2000,showConfirmButton:false});}}else{// Gérer les erreurs de validation du backend\nif(response.errors){let errorMessage='Erreurs de validation:\\n';Object.keys(response.errors).forEach(field=>{errorMessage+=`• ${field}: ${response.errors[field].join(', ')}\\n`;});setError(errorMessage);}else{setError(response.message||'Erreur lors de l\\'import');}}}catch(error){console.error('Error importing CSV:',error);// Gestion d'erreur plus détaillée\nlet errorMessage='Erreur lors de l\\'import CSV';if(error.message){errorMessage+=': '+error.message;}// Si c'est une erreur réseau\nif(error.name==='TypeError'&&error.message.includes('fetch')){errorMessage='Impossible de se connecter au serveur. Vérifiez votre connexion.';}// Si c'est une erreur de parsing JSON\nif(error.message.includes('JSON')){errorMessage='Erreur de format de réponse du serveur.';}setError(errorMessage);}finally{setLoading(false);}};// Fonction pour télécharger un modèle CSV\nconst handleDownloadTemplate=()=>{const headers=['Nom','Prénom','Date de naissance (DD/MM/YYYY)','Lieu de naissance','Sexe (M/F)','Nom du parent','Téléphone parent (optionnel)','Email parent (optionnel)','Adresse (optionnel)'];const sampleData=[['NGUEME','Jean','15/03/2010','Douala','M','NGUEME Paul','690123456','parent@email.com','Bonanjo, Douala'],['TCHOUA','Marie','20/08/2009','Yaoundé','F','TCHOUA Pierre','691234567','marie.parent@email.com','Melen, Yaoundé']];// Créer le contenu CSV\nconst csvContent=[headers,...sampleData].map(row=>row.map(field=>`\"${field}\"`).join(';')).join('\\n');// Créer le blob et télécharger\nconst blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='modele_import_eleves.csv';document.body.appendChild(a);a.click();document.body.removeChild(a);window.URL.revokeObjectURL(url);setSuccess('Modèle CSV téléchargé avec succès');};// Fonction pour prévisualiser le fichier CSV avant import\nconst handleFilePreview=file=>{if(!file)return;const reader=new FileReader();reader.onload=e=>{try{var _lines$;const csvText=e.target.result;const lines=csvText.split('\\n').filter(line=>line.trim());if(lines.length<2){setError('Le fichier CSV doit contenir au moins une ligne d\\'en-têtes et une ligne de données');return;}const headers=lines[0].split(';').map(h=>h.replace(/\"/g,'').trim());const expectedHeaders=['Nom','Prénom','Date de naissance','Lieu de naissance','Sexe','Nom du parent'];// Vérifier les en-têtes obligatoires\nconst missingHeaders=expectedHeaders.filter(expected=>!headers.some(header=>header.toLowerCase().includes(expected.toLowerCase())||expected.toLowerCase().includes(header.toLowerCase())));if(missingHeaders.length>0){setError(`En-têtes manquants dans le CSV: ${missingHeaders.join(', ')}`);return;}console.log('Prévisualisation CSV:',{totalLines:lines.length,headers:headers,dataLines:lines.length-1,firstDataLine:(_lines$=lines[1])===null||_lines$===void 0?void 0:_lines$.split(';').map(d=>d.replace(/\"/g,'').trim())});setError('');// Clear any previous errors\nsetSuccess(`Fichier CSV valide: ${lines.length-1} ligne(s) de données détectée(s)`);}catch(error){setError('Erreur lors de la lecture du fichier CSV: '+error.message);}};reader.onerror=()=>{setError('Erreur lors de la lecture du fichier');};reader.readAsText(file,'UTF-8');};// Fonctions pour la gestion des photos\nconst handlePhotoUpload=e=>{const file=e.target.files[0];if(file){// Validation du type de fichier\nif(!file.type.startsWith('image/')){setError('Veuillez sélectionner un fichier image valide');return;}// Validation de la taille (max 5MB)\nif(file.size>5*1024*1024){setError('La taille de l\\'image ne doit pas dépasser 5MB');return;}setStudentPhoto(file);// Créer un aperçu\nconst reader=new FileReader();reader.onload=e=>{setPhotoPreview(e.target.result);};reader.readAsDataURL(file);setError('');// Clear any errors\n}};const startCamera=async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:'user'// Utiliser la caméra frontale si disponible\n}});setCameraStream(stream);setShowCamera(true);}catch(error){console.error('Erreur d\\'accès à la caméra:',error);setError('Impossible d\\'accéder à la caméra. Vérifiez les permissions.');}};const stopCamera=()=>{if(cameraStream){cameraStream.getTracks().forEach(track=>track.stop());setCameraStream(null);}setShowCamera(false);};const capturePhoto=()=>{const video=document.getElementById('cameraVideo');const canvas=document.createElement('canvas');canvas.width=video.videoWidth;canvas.height=video.videoHeight;const context=canvas.getContext('2d');context.drawImage(video,0,0);// Convertir en blob\ncanvas.toBlob(blob=>{const file=new File([blob],'photo_eleve.jpg',{type:'image/jpeg'});setStudentPhoto(file);setPhotoPreview(canvas.toDataURL());stopCamera();},'image/jpeg',0.8);};const removePhoto=()=>{setStudentPhoto(null);setPhotoPreview('');setError('');};// Fonction pour gérer le drag & drop\nconst handleDragEnd=async event=>{const{active,over}=event;if(active.id!==over.id){const oldIndex=students.findIndex(student=>student.id===active.id);const newIndex=students.findIndex(student=>student.id===over.id);const newStudents=arrayMove(students,oldIndex,newIndex);setStudents(newStudents);setHasCustomOrder(true);// Mettre à jour l'ordre sur le serveur\ntry{const studentsWithOrder=newStudents.map((student,index)=>({id:student.id,order:index+1}));await secureApiEndpoints.students.reorder({students:studentsWithOrder,class_series_id:parseInt(seriesId)// school_year_id géré automatiquement par le backend\n});setSuccess('Ordre des élèves mis à jour avec succès');setTimeout(()=>setSuccess(''),3000);}catch(error){console.error('Error reordering students:',error);setError('Erreur lors de la réorganisation des élèves');// Remettre l'ordre original en cas d'erreur\nloadStudents();}}};// Fonction pour reclasser par ordre alphabétique\nconst handleSortAlphabetically=async()=>{const result=await Swal.fire({title:'Reclasser par ordre alphabétique',text:'Cette action va réorganiser tous les élèves par ordre alphabétique (Nom + Prénom). Continuer ?',icon:'question',showCancelButton:true,confirmButtonColor:'#0d6efd',cancelButtonColor:'#6c757d',confirmButtonText:'Oui, reclasser',cancelButtonText:'Annuler'});if(result.isConfirmed){try{setLoading(true);const response=await secureApiEndpoints.students.sortAlphabetically(seriesId,{}// school_year_id géré automatiquement par le backend\n);if(response.success){setStudents(response.data);setHasCustomOrder(false);setSuccess(response.message);setTimeout(()=>setSuccess(''),3000);}else{setError(response.message||'Erreur lors du reclassement');}}catch(error){console.error('Error sorting alphabetically:',error);setError('Erreur lors du reclassement alphabétique');}finally{setLoading(false);}}};const resetForm=()=>{setFormData({first_name:'',last_name:'',date_of_birth:'',place_of_birth:'',gender:'M',parent_name:'',parent_phone:'',parent_email:'',mother_name:'',mother_phone:'',address:'',class_series_id:seriesId,student_status:'new',has_scholarship_enabled:false// school_year_id géré automatiquement par le backend\n});setSelectedStudent(null);setStudentPhoto(null);setPhotoPreview('');stopCamera();// Arrêter la caméra si elle est active\n};const handleCloseModal=()=>{setShowAddModal(false);setShowEditModal(false);setShowImportModal(false);resetForm();setError('');setImportFile(null);};// Filter students\nconst filteredStudents=students.filter(student=>{// Nom + Prénom (au lieu de Prénom Nom)\nconst fullName=`${student.last_name||student.subname||''} ${student.first_name||student.name||''}`.toLowerCase();const parentName=(student.parent_name||student.father_name||'').toLowerCase();const matchesSearch=fullName.includes(searchTerm.toLowerCase())||parentName.includes(searchTerm.toLowerCase())||(student.student_number||'').toLowerCase().includes(searchTerm.toLowerCase());const matchesStatus=statusFilter==='all'||statusFilter==='new'&&(student.student_status==='new'||!student.student_status)||statusFilter==='old'&&student.student_status==='old';return matchesSearch&&matchesStatus;});if(loading&&students.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"container-fluid py-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner-border\",role:\"status\",children:/*#__PURE__*/_jsx(\"span\",{className:\"visually-hidden\",children:\"Chargement des \\xE9l\\xE8ves...\"})})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container-fluid py-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"row mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-outline-secondary me-3\",onClick:()=>navigate('/school-classes'),children:[/*#__PURE__*/_jsx(ArrowLeft,{size:16,className:\"me-1\"}),\"Retour\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"h4 mb-1\",children:[\"\\xC9l\\xE8ves - \",series===null||series===void 0?void 0:series.name]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted mb-0\",children:[series===null||series===void 0?void 0:(_series$school_class=series.school_class)===null||_series$school_class===void 0?void 0:(_series$school_class$=_series$school_class.level)===null||_series$school_class$===void 0?void 0:(_series$school_class$2=_series$school_class$.section)===null||_series$school_class$2===void 0?void 0:_series$school_class$2.name,\" - \",series===null||series===void 0?void 0:(_series$school_class2=series.school_class)===null||_series$school_class2===void 0?void 0:(_series$school_class3=_series$school_class2.level)===null||_series$school_class3===void 0?void 0:_series$school_class3.name,\" - \",series===null||series===void 0?void 0:(_series$school_class4=series.school_class)===null||_series$school_class4===void 0?void 0:_series$school_class4.name,schoolYear&&` • Année ${schoolYear.name}`,filteredStudents.length>0&&` • ${filteredStudents.length} élève${filteredStudents.length>1?'s':''}`]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex gap-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(ImportExportButton,{title:\"\\xC9l\\xE8ves\",apiBasePath:\"/api/students\",onImportSuccess:loadStudents,templateFileName:\"template_eleves.csv\",seriesId:seriesId}),/*#__PURE__*/_jsx(BulkPhotoUpload,{onUploadSuccess:loadStudents}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-info d-flex align-items-center gap-2 me-2\",onClick:()=>setShowStudentsListModal(true),children:[/*#__PURE__*/_jsx(List,{size:16}),\"Liste des \\xE9l\\xE8ves\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-primary d-flex align-items-center gap-2\",onClick:()=>setShowAddModal(true),children:[/*#__PURE__*/_jsx(Plus,{size:16}),\"Nouvel \\xC9l\\xE8ve\"]})]})})]})})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"row mb-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-danger alert-dismissible fade show\",role:\"alert\",children:[error,/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:()=>setError(''),\"aria-label\":\"Close\"})]})})}),success&&/*#__PURE__*/_jsx(\"div\",{className:\"row mb-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-success alert-dismissible fade show\",role:\"alert\",children:[success,/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:()=>setSuccess(''),\"aria-label\":\"Close\"})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"row mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row g-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Rechercher\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"position-relative\",children:[/*#__PURE__*/_jsx(Search,{className:\"position-absolute top-50 start-0 translate-middle-y ms-3 text-muted\",size:16}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control ps-5\",placeholder:\"Rechercher par nom, pr\\xE9nom, parent ou num\\xE9ro...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Statut\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:statusFilter,onChange:e=>setStatusFilter(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"Tous les \\xE9l\\xE8ves\"}),/*#__PURE__*/_jsx(\"option\",{value:\"new\",children:\"Nouveaux \\xE9l\\xE8ves\"}),/*#__PURE__*/_jsx(\"option\",{value:\"old\",children:\"Anciens \\xE9l\\xE8ves\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3 d-flex align-items-end\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"btn-group me-3\",role:\"group\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:`btn ${viewMode==='grid'?'btn-primary':'btn-outline-secondary'}`,onClick:()=>setViewMode('grid'),title:\"Vue grille\",children:/*#__PURE__*/_jsx(Grid,{size:16})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:`btn ${viewMode==='list'?'btn-primary':'btn-outline-secondary'}`,onClick:()=>setViewMode('list'),title:\"Vue liste\",children:/*#__PURE__*/_jsx(List,{size:16})})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-secondary me-2\",onClick:()=>setSearchTerm(''),children:\"R\\xE9initialiser\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-warning\",onClick:handleSortAlphabetically,title:\"Reclasser par ordre alphab\\xE9tique\",children:[/*#__PURE__*/_jsx(SortAlphaDown,{size:16,className:\"me-1\"}),\"Ordre alphab\\xE9tique\"]})]})]})})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12\",children:filteredStudents.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body text-center py-5\",children:[/*#__PURE__*/_jsx(Person,{size:48,className:\"text-muted mb-3\"}),/*#__PURE__*/_jsx(\"h5\",{className:\"text-muted\",children:\"Aucun \\xE9l\\xE8ve trouv\\xE9\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-4\",children:searchTerm?'Aucun élève ne correspond à vos critères de recherche.':'Commencez par ajouter le premier élève de cette série.'}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-primary\",onClick:()=>setShowAddModal(true),children:[/*#__PURE__*/_jsx(Plus,{size:16,className:\"me-2\"}),\"Ajouter un \\xE9l\\xE8ve\"]})]})}):viewMode==='grid'?/*#__PURE__*/// Vue en grilles (cartes)\n_jsx(\"div\",{className:\"row\",children:filteredStudents.map(student=>/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6 col-lg-4 mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card h-100 hover-card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-start mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(StudentPhoto,{student:student,size:40,className:\"me-3\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h6\",{className:\"card-title mb-1\",children:student.full_name||`${student.last_name||student.subname||''} ${student.first_name||student.name||''}`}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex align-items-center\",children:/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"N\\xB0 \",student.student_number]})})]})]}),/*#__PURE__*/_jsx(\"span\",{className:`badge ${student.gender==='M'?'bg-info':'bg-pink'}`,children:student.gender==='M'?'M':'F'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[student.date_of_birth&&/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center mb-2\",children:[/*#__PURE__*/_jsx(Calendar,{size:14,className:\"text-muted me-2 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:new Date(student.date_of_birth).toLocaleDateString('fr-FR')})]}),student.place_of_birth&&/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center mb-2\",children:[/*#__PURE__*/_jsx(GeoAlt,{size:14,className:\"text-muted me-2 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:student.place_of_birth})]}),(student.parent_name||student.father_name)&&/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center mb-2\",children:[/*#__PURE__*/_jsx(Person,{size:14,className:\"text-muted me-2 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"Parent: \",student.parent_name||student.father_name]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(CashCoin,{size:14,className:\"text-muted me-2 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"small\",{children:student.has_scholarship_enabled?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-success bg-opacity-25 text-success\",children:\"Bourse activ\\xE9e\"}):/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-secondary bg-opacity-25 text-muted\",children:\"Bourse d\\xE9sactiv\\xE9e\"})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-end mt-auto\",children:/*#__PURE__*/_jsx(StudentActionsDropdown,{student:student,onPrintCard:handlePrintCard,onTransfer:handleTransferStudent,onEdit:handleEdit,onDelete:handleDelete,onViewPayments:handleViewPayments,onViewStudent:handleViewStudent,userRole:user===null||user===void 0?void 0:user.role})})]})})},student.id))}):/*#__PURE__*/// Vue en liste (tableau) avec drag & drop\n_jsx(\"div\",{className:\"card\",style:{overflow:'visible'},children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body p-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflow:'visible'},children:/*#__PURE__*/_jsx(DndContext,{sensors:sensors,collisionDetection:closestCenter,onDragEnd:handleDragEnd,children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-hover mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Photo & N\\xB0\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Nom & Pr\\xE9nom\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Date/Lieu naissance\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Sexe\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Statut\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Parent\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Contact\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Bourse\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(SortableContext,{items:filteredStudents.map(s=>s.id),strategy:verticalListSortingStrategy,children:/*#__PURE__*/_jsx(\"tbody\",{children:filteredStudents.map(student=>/*#__PURE__*/_jsx(SortableStudent,{student:student,handleEdit:handleEdit,handleDelete:handleDelete,handlePrintCard:handlePrintCard,handleTransferStudent:handleTransferStudent,handleViewStudent:handleViewStudent,handleViewPayments:handleViewPayments,handleStatusChange:handleStatusChange,navigate:navigate,userRole:user===null||user===void 0?void 0:user.role},student.id))})})]})})})})})})}),(showAddModal||showEditModal)&&/*#__PURE__*/_jsx(\"div\",{className:\"modal fade show d-block\",style:{backgroundColor:'rgba(0,0,0,0.5)'},children:/*#__PURE__*/_jsx(\"div\",{className:\"modal-dialog modal-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"modal-title\",children:selectedStudent?'Modifier l\\'élève':'Ajouter un élève'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleCloseModal})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"row mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-12\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Photo de l'\\xE9l\\xE8ve\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-3 position-relative\",style:{width:'150px',height:'150px'},children:photoPreview?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"img\",{src:photoPreview,alt:\"Aper\\xE7u photo \\xE9l\\xE8ve\",className:\"img-thumbnail border-2 shadow-sm\",style:{width:'150px',height:'150px',objectFit:'cover'}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-sm btn-danger position-absolute\",onClick:removePhoto,style:{top:'-8px',right:'-8px'},title:\"Supprimer la photo\",children:/*#__PURE__*/_jsx(X,{size:12})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column align-items-center justify-content-center border border-dashed border-2 rounded h-100\",style:{backgroundColor:'#f8f9fa'},children:[/*#__PURE__*/_jsx(Person,{size:48,className:\"text-muted mb-2\"}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted text-center\",children:\"Aucune photo\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2 mb-3\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-outline-primary btn-sm\",onClick:startCamera,children:[/*#__PURE__*/_jsx(Camera,{size:16,className:\"me-1\"}),\"Capturer\"]}),/*#__PURE__*/_jsxs(\"label\",{className:\"btn btn-outline-secondary btn-sm\",htmlFor:\"photoUpload\",children:[/*#__PURE__*/_jsx(Image,{size:16,className:\"me-1\"}),\"Choisir fichier\"]}),/*#__PURE__*/_jsx(\"input\",{id:\"photoUpload\",type:\"file\",accept:\"image/*\",onChange:handlePhotoUpload,style:{display:'none'}})]}),showCamera&&/*#__PURE__*/_jsx(\"div\",{className:\"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center\",style:{backgroundColor:'rgba(0,0,0,0.8)',zIndex:9999},children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-3\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"mb-0\",children:\"Capture Photo\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:stopCamera})]}),/*#__PURE__*/_jsx(\"video\",{id:\"cameraVideo\",autoPlay:true,playsInline:true,ref:video=>{if(video&&cameraStream){video.srcObject=cameraStream;}},style:{width:'400px',height:'300px'},className:\"border rounded mb-3\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center gap-2\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-primary\",onClick:capturePhoto,children:[/*#__PURE__*/_jsx(Camera,{size:16,className:\"me-1\"}),\"Capturer\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:stopCamera,children:\"Annuler\"})]})]})})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Nom *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",value:formData.last_name,onChange:e=>setFormData({...formData,last_name:e.target.value}),required:true})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Pr\\xE9nom *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",value:formData.first_name,onChange:e=>setFormData({...formData,first_name:e.target.value}),required:true})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Date de naissance *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"form-control\",value:formData.date_of_birth,onChange:e=>setFormData({...formData,date_of_birth:e.target.value}),required:true})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Lieu de naissance *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",value:formData.place_of_birth,onChange:e=>setFormData({...formData,place_of_birth:e.target.value}),required:true})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Sexe *\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:formData.gender,onChange:e=>setFormData({...formData,gender:e.target.value}),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"S\\xE9lectionner\"}),/*#__PURE__*/_jsx(\"option\",{value:\"M\",children:\"Masculin\"}),/*#__PURE__*/_jsx(\"option\",{value:\"F\",children:\"F\\xE9minin\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Statut\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:formData.student_status||'new',onChange:e=>setFormData({...formData,student_status:e.target.value}),children:[/*#__PURE__*/_jsx(\"option\",{value:\"new\",children:\"Nouveau \\xE9l\\xE8ve\"}),/*#__PURE__*/_jsx(\"option\",{value:\"old\",children:\"Ancien \\xE9l\\xE8ve\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Nom du parent *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",value:formData.parent_name,onChange:e=>setFormData({...formData,parent_name:e.target.value}),required:true})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"T\\xE9l\\xE9phone parent\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",className:\"form-control\",value:formData.parent_phone,onChange:e=>setFormData({...formData,parent_phone:e.target.value})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Email parent\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",className:\"form-control\",value:formData.parent_email,onChange:e=>setFormData({...formData,parent_email:e.target.value})})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Nom de la m\\xE8re\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",value:formData.mother_name,onChange:e=>setFormData({...formData,mother_name:e.target.value})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"T\\xE9l\\xE9phone m\\xE8re\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",className:\"form-control\",value:formData.mother_phone,onChange:e=>setFormData({...formData,mother_phone:e.target.value})})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Adresse\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"form-control\",rows:\"3\",value:formData.address,onChange:e=>setFormData({...formData,address:e.target.value})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form-check\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",type:\"checkbox\",id:\"scholarshipEnabled\",checked:formData.has_scholarship_enabled,onChange:e=>setFormData({...formData,has_scholarship_enabled:e.target.checked})}),/*#__PURE__*/_jsxs(\"label\",{className:\"form-check-label\",htmlFor:\"scholarshipEnabled\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Activer les bourses pour cet \\xE9l\\xE8ve\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"Si coch\\xE9, l'\\xE9l\\xE8ve pourra b\\xE9n\\xE9ficier des bourses configur\\xE9es pour sa classe lors des paiements\"})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:handleCloseModal,children:\"Annuler\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",disabled:loading,children:loading?'Enregistrement...':selectedStudent?'Modifier':'Créer'})]})]})]})})}),showImportModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal fade show d-block\",style:{backgroundColor:'rgba(0,0,0,0.5)'},children:/*#__PURE__*/_jsx(\"div\",{className:\"modal-dialog\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"modal-title\",children:\"Importer des \\xE9l\\xE8ves (CSV)\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleCloseModal})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleImportCsv,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Ann\\xE9e scolaire *\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:selectedSchoolYear,onChange:e=>setSelectedSchoolYear(e.target.value),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"S\\xE9lectionner une ann\\xE9e\"}),schoolYears.map(year=>/*#__PURE__*/_jsxs(\"option\",{value:year.id,children:[year.name,\" \",year.is_current?'(Courante)':'']},year.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label mb-0\",children:\"Fichier CSV *\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-sm btn-outline-info\",onClick:handleDownloadTemplate,title:\"T\\xE9l\\xE9charger le mod\\xE8le CSV\",children:[/*#__PURE__*/_jsx(Download,{size:14,className:\"me-1\"}),\"Mod\\xE8le CSV\"]})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",className:\"form-control\",accept:\".csv,.txt\",onChange:e=>{const file=e.target.files[0];setImportFile(file);if(file){handleFilePreview(file);}},required:true}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-text\",children:[\"Le fichier doit contenir les colonnes : Nom, Pr\\xE9nom, Date naissance, Lieu naissance, Sexe, Nom parent, T\\xE9l\\xE9phone parent (optionnel), Email parent (optionnel), Adresse (optionnel)\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"\\uD83D\\uDCA1 Cliquez sur \\\"Mod\\xE8le CSV\\\" pour t\\xE9l\\xE9charger un exemple de format\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:handleCloseModal,children:\"Annuler\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",disabled:loading,children:loading?'Import en cours...':'Importer'})]})]})]})})}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:`\n                .hover-card {\n                    transition: box-shadow 0.2s ease-in-out;\n                }\n                .hover-card:hover {\n                    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;\n                }\n                .bg-pink {\n                    background-color: #e91e63 !important;\n                }\n                .drag-handle {\n                    opacity: 0.6;\n                    transition: opacity 0.2s ease;\n                }\n                .drag-handle:hover {\n                    opacity: 1;\n                }\n                .dragging {\n                    background-color: rgba(0, 123, 255, 0.1) !important;\n                }\n                tbody tr:hover .drag-handle {\n                    opacity: 1;\n                }\n            `}),showCardPrint&&newStudentForCard&&/*#__PURE__*/_jsx(StudentCardPrint,{student:newStudentForCard,schoolYear:schoolYear,show:showCardPrint,onHide:()=>{setShowCardPrint(false);setNewStudentForCard(null);},onPrintSuccess:()=>{console.log('Carte imprimée avec succès');}}),showTransferModal&&studentToTransfer&&/*#__PURE__*/_jsx(StudentTransfer,{student:studentToTransfer,show:showTransferModal,onHide:()=>{setShowTransferModal(false);setStudentToTransfer(null);},onTransferSuccess:handleTransferSuccess}),showStudentsListModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal fade show d-block\",style:{backgroundColor:'rgba(0,0,0,0.5)'},children:/*#__PURE__*/_jsx(\"div\",{className:\"modal-dialog modal-xl\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"modal-title\",children:[/*#__PURE__*/_jsx(List,{className:\"me-2\"}),\"Liste des \\xE9l\\xE8ves - \",series===null||series===void 0?void 0:series.name]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:()=>setShowStudentsListModal(false)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped table-hover\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-dark\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Num\\xE9ro\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Nom et Pr\\xE9nom\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Date de naissance\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Nom du p\\xE8re avec num\\xE9ro\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Nom de la m\\xE8re avec num\\xE9ro\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:students.map((student,index)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-primary\",children:student.student_number||`N°${index+1}`})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(StudentPhoto,{student:student,size:32,className:\"me-2\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"fw-bold\",children:[student.last_name||student.subname,\" \",student.first_name||student.name]}),student.gender&&/*#__PURE__*/_jsx(\"small\",{className:`text-${student.gender==='M'?'info':'pink'}`,children:student.gender==='M'?'Masculin':'Féminin'})]})]})}),/*#__PURE__*/_jsx(\"td\",{children:student.date_of_birth?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Calendar,{size:14,className:\"me-1 text-muted\"}),new Date(student.date_of_birth).toLocaleDateString('fr-FR'),student.place_of_birth&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[/*#__PURE__*/_jsx(GeoAlt,{size:12,className:\"me-1\"}),student.place_of_birth]})})]}):/*#__PURE__*/_jsx(\"span\",{className:\"text-muted\",children:\"Non renseign\\xE9\"})}),/*#__PURE__*/_jsx(\"td\",{children:student.parent_name||student.father_name?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"fw-medium\",children:[/*#__PURE__*/_jsx(Person,{size:14,className:\"me-1 text-primary\"}),student.parent_name||student.father_name]}),student.parent_phone&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"small\",{className:\"text-success\",children:[/*#__PURE__*/_jsx(Telephone,{size:12,className:\"me-1\"}),student.parent_phone]})})]}):/*#__PURE__*/_jsx(\"span\",{className:\"text-muted\",children:\"Non renseign\\xE9\"})}),/*#__PURE__*/_jsx(\"td\",{children:student.mother_name?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"fw-medium\",children:[/*#__PURE__*/_jsx(Person,{size:14,className:\"me-1 text-danger\"}),student.mother_name]}),student.mother_phone&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"small\",{className:\"text-success\",children:[/*#__PURE__*/_jsx(Telephone,{size:12,className:\"me-1\"}),student.mother_phone]})})]}):/*#__PURE__*/_jsx(\"span\",{className:\"text-muted\",children:\"Non renseign\\xE9\"})})]},student.id))})]})}),students.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-4\",children:[/*#__PURE__*/_jsx(Person,{size:48,className:\"text-muted mb-3\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:\"Aucun \\xE9l\\xE8ve trouv\\xE9 dans cette s\\xE9rie.\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"me-auto\",children:/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"Total: \",students.length,\" \\xE9l\\xE8ve\",students.length>1?'s':'']})}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-danger me-2\",onClick:downloadStudentsListPdf,disabled:loading||students.length===0,children:[/*#__PURE__*/_jsx(Download,{size:16,className:\"me-2\"}),\"T\\xE9l\\xE9charger PDF\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:()=>setShowStudentsListModal(false),children:\"Fermer\"})]})]})})})]});};export default SeriesStudents;","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","Plus","PencilSquare","Trash","Download","Upload","Person","Calendar","GeoAlt","Telephone","Envelope","Search","Grid","List","ArrowLeft","SortAlphaDown","GripVertical","Camera","X","Image","CashCoin","Printer","ArrowRightCircle","secureApiEndpoints","useAuth","useSchool","authService","ImportExportButton","BulkPhotoUpload","StudentCardPrint","StudentTransfer","StudentActionsDropdown","Swal","DndContext","closestCenter","KeyboardSensor","PointerSensor","useSensor","useSensors","arrayMove","SortableContext","sortableKeyboardCoordinates","verticalListSortingStrategy","useSortable","CSS","host","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","StudentPhoto","_ref","student","size","className","imageError","setImageError","photo_url","style","width","height","children","Math","floor","src","alt","full_name","last_name","first_name","objectFit","onError","SortableStudent","_ref2","handleEdit","handleDelete","handlePrintCard","handleTransferStudent","handleViewStudent","handleViewPayments","handleStatusChange","navigate","userRole","attributes","listeners","setNodeRef","transform","transition","isDragging","id","Transform","toString","opacity","ref","cursor","student_number","subname","name","student_status","date_of_birth","Date","toLocaleDateString","place_of_birth","gender","value","onChange","e","target","minWidth","parent_name","father_name","parent_phone","parent_email","has_scholarship_enabled","onPrintCard","onTransfer","onEdit","onDelete","onViewPayments","onViewStudent","SeriesStudents","_series$school_class","_series$school_class$","_series$school_class$2","_series$school_class2","_series$school_class3","_series$school_class4","seriesId","user","schoolSettings","formatCurrency","students","setStudents","series","setSeries","schoolYear","setSchoolYear","schoolYears","setSchoolYears","loading","setLoading","error","setError","success","setSuccess","hasCustomOrder","setHasCustomOrder","sensors","coordinateGetter","searchTerm","setSearchTerm","statusFilter","setStatusFilter","viewMode","setViewMode","showAddModal","setShowAddModal","showEditModal","setShowEditModal","showImportModal","setShowImportModal","showCardPrint","setShowCardPrint","showTransferModal","setShowTransferModal","showStudentsListModal","setShowStudentsListModal","selectedStudent","setSelectedStudent","newStudentForCard","setNewStudentForCard","studentToTransfer","setStudentToTransfer","formData","setFormData","mother_name","mother_phone","address","class_series_id","studentPhoto","setStudentPhoto","photoPreview","setPhotoPreview","showCamera","setShowCamera","cameraStream","setCameraStream","importFile","setImportFile","selectedSchoolYear","setSelectedSchoolYear","loadStudents","loadSchoolYears","getTracks","forEach","track","stop","response","getByClassSeries","data","school_year","hasCustom","some","order","message","console","downloadStudentsListPdf","fetch","method","headers","getToken","ok","Error","status","pdfBlob","blob","blobUrl","window","URL","createObjectURL","link","document","createElement","href","download","toISOString","split","body","appendChild","click","removeChild","setTimeout","revokeObjectURL","getSchoolYears","currentYear","find","year","is_current","handleSubmit","preventDefault","requiredFields","missingFields","filter","field","trim","length","map","labels","join","log","finalFormData","parseInt","isNaN","formDataToSend","FormData","Object","keys","key","undefined","append","String","includes","entries","updateWithPhoto","createWithPhoto","jsonData","update","create","resetForm","enrichedStudent","class_series","current_class","fire","title","text","icon","showCancelButton","confirmButtonText","cancelButtonText","confirmButtonColor","cancelButtonColor","then","result","isConfirmed","timer","showConfirmButton","errorMessage","errorData","JSON","parse","errors","validationErrors","_ref3","messages","parseError","handleTransferSuccess","transferredStudent","newClassInfo","seriesName","dateOfBirth","date","getTime","studentId","newStatus","updateStatus","prevStudents","delete","handleExportCsv","_series$name","exportCsv","url","a","replace","handleExportPdf","exportPdf","htmlContent","printWindow","open","write","close","onload","focus","print","handleImportCsv","validTypes","fileExtension","toLowerCase","pop","type","_schoolYears$find","file","lastModified","seriesIdFromUrl","seriesInfo","schoolYearInfo","y","importCsv","html","imported","handleDownloadTemplate","sampleData","csvContent","row","Blob","handleFilePreview","reader","FileReader","_lines$","csvText","lines","line","h","expectedHeaders","missingHeaders","expected","header","totalLines","dataLines","firstDataLine","d","onerror","readAsText","handlePhotoUpload","files","startsWith","readAsDataURL","startCamera","stream","navigator","mediaDevices","getUserMedia","video","facingMode","stopCamera","capturePhoto","getElementById","canvas","videoWidth","videoHeight","context","getContext","drawImage","toBlob","File","toDataURL","removePhoto","handleDragEnd","event","active","over","oldIndex","findIndex","newIndex","newStudents","studentsWithOrder","index","reorder","handleSortAlphabetically","sortAlphabetically","handleCloseModal","filteredStudents","fullName","parentName","matchesSearch","matchesStatus","role","onClick","school_class","level","section","apiBasePath","onImportSuccess","templateFileName","onUploadSuccess","placeholder","overflow","collisionDetection","onDragEnd","items","s","strategy","backgroundColor","onSubmit","top","right","htmlFor","accept","display","zIndex","autoPlay","playsInline","srcObject","required","rows","checked","disabled","show","onHide","onPrintSuccess","onTransferSuccess"],"sources":["/var/www/College-IUP/front/src/pages/Students/SeriesStudents.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport {\n    Plus,\n    PencilSquare,\n    Trash,\n    Download,\n    Upload,\n    Person,\n    Calendar,\n    GeoAlt,\n    Telephone,\n    Envelope,\n    Search,\n    Grid,\n    List,\n    ArrowLeft,\n    SortAlphaDown,\n    GripVertical,\n    Camera,\n    X,\n    Image,\n    CashCoin,\n    Printer,\n    ArrowRightCircle\n} from 'react-bootstrap-icons';\nimport { secureApiEndpoints } from '../../utils/apiMigration';\nimport { useAuth } from '../../hooks/useAuth';\nimport { useSchool } from '../../contexts/SchoolContext';\nimport { authService } from '../../services/authService';\nimport ImportExportButton from '../../components/ImportExportButton';\nimport BulkPhotoUpload from '../../components/BulkPhotoUpload';\nimport StudentCardPrint from '../../components/StudentCardPrint';\nimport StudentTransfer from '../../components/StudentTransfer';\nimport StudentActionsDropdown from '../../components/StudentActionsDropdown';\nimport Swal from 'sweetalert2';\nimport {\n    DndContext,\n    closestCenter,\n    KeyboardSensor,\n    PointerSensor,\n    useSensor,\n    useSensors,\n} from '@dnd-kit/core';\nimport {\n    arrayMove,\n    SortableContext,\n    sortableKeyboardCoordinates,\n    verticalListSortingStrategy,\n} from '@dnd-kit/sortable';\nimport {\n    useSortable,\n} from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\nimport { host } from '../../utils/fetch';\n\n// Composant pour afficher les photos d'élèves avec fallback\nconst StudentPhoto = ({ student, size = 40, className = \"\" }) => {\n    const [imageError, setImageError] = useState(false);\n    \n    if (!student.photo_url || imageError) {\n        return (\n            <div \n                className={`bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center ${className}`}\n                style={{ width: `${size}px`, height: `${size}px` }}\n            >\n                <Person className=\"text-primary\" size={Math.floor(size * 0.5)} />\n            </div>\n        );\n    }\n    \n    return (\n        <img \n            src={student.photo_url} \n            alt={student.full_name || `${student.last_name} ${student.first_name}`}\n            className={`rounded-circle ${className}`}\n            style={{ width: `${size}px`, height: `${size}px`, objectFit: 'cover' }}\n            onError={() => setImageError(true)}\n        />\n    );\n};\n\n// Composant pour les éléments sortables\nconst SortableStudent = ({ student, handleEdit, handleDelete, handlePrintCard, handleTransferStudent, handleViewStudent, handleViewPayments, handleStatusChange, navigate, userRole }) => {\n    const {\n        attributes,\n        listeners,\n        setNodeRef,\n        transform,\n        transition,\n        isDragging,\n    } = useSortable({ id: student.id });\n\n    const style = {\n        transform: CSS.Transform.toString(transform),\n        transition,\n        opacity: isDragging ? 0.5 : 1,\n    };\n\n    return (\n        <tr ref={setNodeRef} style={style} className={isDragging ? 'dragging' : ''}>\n            <td>\n                <div className=\"d-flex align-items-center\">\n                    <div \n                        {...attributes} \n                        {...listeners}\n                        className=\"drag-handle me-2\"\n                        style={{ cursor: 'grab' }}\n                    >\n                        <GripVertical size={14} className=\"text-muted\" />\n                    </div>\n                    <StudentPhoto student={student} size={32} className=\"me-2\" />\n                    <small className=\"text-muted\">\n                        N° {student.student_number}\n                    </small>\n                </div>\n            </td>\n            <td>\n                <div>\n                    <div className=\"fw-medium\">\n                        {student.full_name || `${student.last_name || student.subname || ''} ${student.first_name || student.name || ''}`}\n                    </div>\n                    {student.student_status === 'old' && (\n                        <span className=\"badge bg-success bg-opacity-25 text-success small mt-1\">\n                            Ancien élève\n                        </span>\n                    )}\n                </div>\n            </td>\n            <td>\n                <div>\n                    {student.date_of_birth && (\n                        <div className=\"d-flex align-items-center small mb-1\">\n                            <Calendar size={12} className=\"me-2 flex-shrink-0\" />\n                            <span>{new Date(student.date_of_birth).toLocaleDateString('fr-FR')}</span>\n                        </div>\n                    )}\n                    {student.place_of_birth && (\n                        <div className=\"d-flex align-items-center small text-muted\">\n                            <GeoAlt size={12} className=\"me-2 flex-shrink-0\" />\n                            <span>{student.place_of_birth}</span>\n                        </div>\n                    )}\n                </div>\n            </td>\n            <td>\n                <span className={`badge ${student.gender === 'M' ? 'bg-info' : 'bg-pink'}`}>\n                    {student.gender === 'M' ? 'Masculin' : 'Féminin'}\n                </span>\n            </td>\n            <td>\n                <select \n                    className={`form-select form-select-sm ${student.student_status === 'old' ? 'text-success' : 'text-primary'}`}\n                    value={student.student_status || 'new'}\n                    onChange={(e) => handleStatusChange(student.id, e.target.value)}\n                    style={{ minWidth: '100px' }}\n                >\n                    <option value=\"new\">Nouveau</option>\n                    <option value=\"old\">Ancien</option>\n                </select>\n            </td>\n            <td>\n                <div className=\"small\">\n                    {student.parent_name || student.father_name || '-'}\n                </div>\n            </td>\n            <td>\n                <div>\n                    {student.parent_phone && (\n                        <div className=\"d-flex align-items-center small mb-1\">\n                            <Telephone size={12} className=\"me-2 flex-shrink-0\" />\n                            <span>{student.parent_phone}</span>\n                        </div>\n                    )}\n                    {student.parent_email && (\n                        <div className=\"d-flex align-items-center small text-muted\">\n                            <Envelope size={12} className=\"me-2 flex-shrink-0\" />\n                            <span>{student.parent_email}</span>\n                        </div>\n                    )}\n                </div>\n            </td>\n            <td>\n                <div className=\"text-center\">\n                    {student.has_scholarship_enabled ? (\n                        <span className=\"badge bg-success bg-opacity-25 text-success\">\n                            <CashCoin size={12} className=\"me-1\" />\n                            Activée\n                        </span>\n                    ) : (\n                        <span className=\"badge bg-secondary bg-opacity-25 text-muted\">\n                            Désactivée\n                        </span>\n                    )}\n                </div>\n            </td>\n            <td>\n                <StudentActionsDropdown\n                    student={student}\n                    onPrintCard={handlePrintCard}\n                    onTransfer={handleTransferStudent}\n                    onEdit={handleEdit}\n                    onDelete={handleDelete}\n                    onViewPayments={handleViewPayments}\n                    onViewStudent={handleViewStudent}\n                    userRole={userRole}\n                />\n            </td>\n        </tr>\n    );\n};\n\nconst SeriesStudents = () => {\n    const { seriesId } = useParams();\n    const navigate = useNavigate();\n    const { user } = useAuth();\n    const { schoolSettings, formatCurrency } = useSchool();\n    \n    const [students, setStudents] = useState([]);\n    const [series, setSeries] = useState(null);\n    const [schoolYear, setSchoolYear] = useState(null);\n    const [schoolYears, setSchoolYears] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState('');\n    const [success, setSuccess] = useState('');\n    const [hasCustomOrder, setHasCustomOrder] = useState(false);\n\n    // Sensors pour le drag & drop\n    const sensors = useSensors(\n        useSensor(PointerSensor),\n        useSensor(KeyboardSensor, {\n            coordinateGetter: sortableKeyboardCoordinates,\n        })\n    );\n    \n    // Filters and search\n    const [searchTerm, setSearchTerm] = useState('');\n    const [statusFilter, setStatusFilter] = useState('all');\n    const [viewMode, setViewMode] = useState('list');\n    \n    // Modal states\n    const [showAddModal, setShowAddModal] = useState(false);\n    const [showEditModal, setShowEditModal] = useState(false);\n    const [showImportModal, setShowImportModal] = useState(false);\n    const [showCardPrint, setShowCardPrint] = useState(false);\n    const [showTransferModal, setShowTransferModal] = useState(false);\n    const [showStudentsListModal, setShowStudentsListModal] = useState(false);\n    const [selectedStudent, setSelectedStudent] = useState(null);\n    const [newStudentForCard, setNewStudentForCard] = useState(null);\n    const [studentToTransfer, setStudentToTransfer] = useState(null);\n    \n    // Form data\n    const [formData, setFormData] = useState({\n        first_name: '',\n        last_name: '',\n        date_of_birth: '',\n        place_of_birth: '',\n        gender: 'M',\n        parent_name: '',\n        parent_phone: '',\n        parent_email: '',\n        mother_name: '',\n        mother_phone: '',\n        address: '',\n        class_series_id: seriesId,\n        student_status: 'new',\n        has_scholarship_enabled: false,\n    });\n    \n    // Photo states\n    const [studentPhoto, setStudentPhoto] = useState(null);\n    const [photoPreview, setPhotoPreview] = useState('');\n    const [showCamera, setShowCamera] = useState(false);\n    const [cameraStream, setCameraStream] = useState(null);\n    \n    // Import data\n    const [importFile, setImportFile] = useState(null);\n    const [selectedSchoolYear, setSelectedSchoolYear] = useState('');\n\n    useEffect(() => {\n        loadStudents();\n        loadSchoolYears();\n    }, [seriesId]);\n\n    // Cleanup camera stream on unmount\n    useEffect(() => {\n        return () => {\n            if (cameraStream) {\n                cameraStream.getTracks().forEach(track => track.stop());\n            }\n        };\n    }, [cameraStream]);\n\n    const loadStudents = async () => {\n        try {\n            setLoading(true);\n            const response = await secureApiEndpoints.students.getByClassSeries(seriesId);\n            \n            if (response.success) {\n                setStudents(response.data.students);\n                setSeries(response.data.series);\n                setSchoolYear(response.data.school_year);\n                // L'année scolaire est maintenant gérée automatiquement par le backend\n                \n                // Vérifier si les élèves ont un ordre personnalisé\n                const hasCustom = response.data.students.some(student => student.order != null);\n                setHasCustomOrder(hasCustom);\n            } else {\n                setError(response.message || 'Erreur lors du chargement des élèves');\n            }\n        } catch (error) {\n            console.error('Error loading students:', error);\n            setError('Erreur lors du chargement des élèves');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const downloadStudentsListPdf = async () => {\n        try {\n            setLoading(true);\n            setError('');\n\n            const response = await fetch(`${host}/api/students/export/pdf/${seriesId}`, {\n                method: 'GET',\n                headers: {\n                    'Authorization': `Bearer ${authService.getToken()}`,\n                    'Accept': 'application/pdf'\n                }\n            });\n\n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n\n            const pdfBlob = await response.blob();\n            const blobUrl = window.URL.createObjectURL(pdfBlob);\n            \n            // Créer un lien de téléchargement\n            const link = document.createElement('a');\n            link.href = blobUrl;\n            link.download = `liste_eleves_${series?.name || 'serie'}_${new Date().toISOString().split('T')[0]}.pdf`;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            \n            setTimeout(() => window.URL.revokeObjectURL(blobUrl), 1000);\n            setSuccess('Liste des élèves téléchargée avec succès');\n            \n        } catch (error) {\n            console.error('Error downloading students list PDF:', error);\n            setError('Erreur lors du téléchargement de la liste PDF');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const loadSchoolYears = async () => {\n        try {\n            const response = await secureApiEndpoints.students.getSchoolYears();\n            if (response.success) {\n                setSchoolYears(response.data);\n                const currentYear = response.data.find(year => year.is_current);\n                if (currentYear) {\n                    setSelectedSchoolYear(currentYear.id);\n                }\n            }\n        } catch (error) {\n            console.error('Error loading school years:', error);\n        }\n    };\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        \n        // Validation côté client\n        const requiredFields = ['first_name', 'last_name', 'date_of_birth', 'place_of_birth', 'gender', 'parent_name'];\n        const missingFields = requiredFields.filter(field => !formData[field] || formData[field].trim() === '');\n        \n        if (missingFields.length > 0) {\n            setError(`Champs obligatoires manquants: ${missingFields.map(field => {\n                const labels = {\n                    first_name: 'Prénom',\n                    last_name: 'Nom',\n                    date_of_birth: 'Date de naissance',\n                    place_of_birth: 'Lieu de naissance',\n                    gender: 'Sexe',\n                    parent_name: 'Nom du parent'\n                };\n                return labels[field];\n            }).join(', ')}`);\n            return;\n        }\n        \n        // L'année scolaire est maintenant gérée automatiquement par le backend\n        \n        if (!seriesId) {\n            setError('Série de classe manquante');\n            return;\n        }\n        \n        // Debug: afficher les données avant envoi\n        console.log('Form data before submission:', formData);\n        console.log('School year:', schoolYear);\n        console.log('Series ID:', seriesId);\n        \n        try {\n            setLoading(true);\n            setError('');\n            \n            // Préparer les données finales (school_year_id géré automatiquement par le backend)\n            const finalFormData = {\n                ...formData,\n                class_series_id: parseInt(seriesId)\n            };\n            \n            // Validation finale des IDs\n            if (!finalFormData.class_series_id || isNaN(finalFormData.class_series_id)) {\n                setError('ID de série de classe invalide');\n                return;\n            }\n            \n            console.log('Final form data:', finalFormData);\n            \n            let response;\n\n            // Debug pour l'édition\n            if (selectedStudent) {\n                console.log('Editing student:', selectedStudent.id);\n                console.log('Has new photo:', !!studentPhoto);\n                console.log('Student photo type:', typeof studentPhoto);\n                console.log('Student photo:', studentPhoto);\n            }\n            \n            // Si on a une photo, utiliser FormData, sinon utiliser JSON\n            if (studentPhoto) {\n                // Créer FormData pour inclure la photo\n                const formDataToSend = new FormData();\n                \n                // Ajouter tous les champs du formulaire \n                Object.keys(finalFormData).forEach(key => {\n                    const value = finalFormData[key];\n                    // S'assurer que les valeurs ne sont pas undefined ou null\n                    if (value !== undefined && value !== null && value !== '') {\n                        formDataToSend.append(key, String(value));\n                    } else if (['first_name', 'last_name', 'date_of_birth', 'place_of_birth', 'gender', 'parent_name', 'class_series_id'].includes(key)) {\n                        // Pour les champs requis, utiliser une chaîne vide si la valeur est manquante\n                        formDataToSend.append(key, '');\n                    }\n                });\n                \n                // Ajouter la photo\n                formDataToSend.append('photo', studentPhoto);\n                \n                // Debug: afficher le contenu de FormData\n                console.log('FormData contents:');\n                for (let [key, value] of formDataToSend.entries()) {\n                    console.log(`${key}:`, value);\n                }\n                \n                response = selectedStudent \n                    ? await secureApiEndpoints.students.updateWithPhoto(selectedStudent.id, formDataToSend)\n                    : await secureApiEndpoints.students.createWithPhoto(formDataToSend);\n            } else {\n                \n                // Pas de photo, utiliser l'API normale avec JSON\n                const jsonData = {\n                    ...formData,\n                    class_series_id: parseInt(seriesId)\n                };\n                \n                \n                response = selectedStudent \n                    ? await secureApiEndpoints.students.update(selectedStudent.id, jsonData)\n                    : await secureApiEndpoints.students.create(jsonData);\n            }\n\n            if (response.success) {\n                setSuccess(response.message || `Élève ${selectedStudent ? 'modifié' : 'créé'} avec succès`);\n                resetForm();\n                setShowAddModal(false);\n                setShowEditModal(false);\n                loadStudents();\n                \n                // Si c'est une création d'élève (pas une modification), proposer l'impression de la carte\n                if (!selectedStudent && response.data) {\n                    // Enrichir les données de l'élève créé avec les infos de la série\n                    const enrichedStudent = {\n                        ...response.data,\n                        class_series: series,\n                        current_class: series?.name\n                    };\n                    \n                    setNewStudentForCard(enrichedStudent);\n                    \n                    Swal.fire({\n                        title: 'Élève créé avec succès !',\n                        text: 'Voulez-vous imprimer sa carte scolaire maintenant ?',\n                        icon: 'success',\n                        showCancelButton: true,\n                        confirmButtonText: '🖨️ Imprimer la carte',\n                        cancelButtonText: 'Plus tard',\n                        confirmButtonColor: '#28a745',\n                        cancelButtonColor: '#6c757d'\n                    }).then((result) => {\n                        if (result.isConfirmed) {\n                            setShowCardPrint(true);\n                        }\n                    });\n                } else {\n                    Swal.fire({\n                        title: 'Succès',\n                        text: response.message || `Élève ${selectedStudent ? 'modifié' : 'créé'} avec succès`,\n                        icon: 'success',\n                        timer: 2000,\n                        showConfirmButton: false\n                    });\n                }\n            } else {\n                setError(response.message || `Erreur lors de ${selectedStudent ? 'la modification' : 'la création'} de l'élève`);\n            }\n        } catch (error) {\n            console.error('Error saving student:', error);\n            console.error('Error details:', error.message);\n            \n            // Essayer d'extraire le message d'erreur détaillé\n            let errorMessage = `Erreur lors de ${selectedStudent ? 'la modification' : 'la création'} de l'élève`;\n            \n            if (error.message) {\n                // Si c'est une erreur de validation avec détails\n                try {\n                    const errorData = JSON.parse(error.message);\n                    if (errorData.errors) {\n                        const validationErrors = Object.entries(errorData.errors)\n                            .map(([field, messages]) => `${field}: ${messages.join(', ')}`)\n                            .join('\\n');\n                        errorMessage += `\\n\\nDétails:\\n${validationErrors}`;\n                    }\n                } catch (parseError) {\n                    // Si ce n'est pas du JSON, utiliser le message tel quel\n                    errorMessage += `\\n\\nDétails: ${error.message}`;\n                }\n            }\n            \n            setError(errorMessage);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handlePrintCard = (student) => {\n        // Enrichir les données de l'élève avec les infos de la série\n        const enrichedStudent = {\n            ...student,\n            class_series: series,\n            current_class: series?.name\n        };\n        \n        setNewStudentForCard(enrichedStudent);\n        setShowCardPrint(true);\n    };\n\n    const handleTransferStudent = (student) => {\n        // Enrichir les données de l'élève avec les infos de la série actuelle\n        const enrichedStudent = {\n            ...student,\n            class_series: series,\n            class_series_id: series?.id,\n            current_class: series?.name\n        };\n        \n        setStudentToTransfer(enrichedStudent);\n        setShowTransferModal(true);\n    };\n\n    const handleTransferSuccess = (transferredStudent, newClassInfo) => {\n        // Recharger la liste des étudiants pour refléter le changement\n        loadStudents();\n        \n        // Optionnel: message de confirmation déjà géré dans le composant StudentTransfer\n        console.log(`Élève transféré vers ${newClassInfo.className} - ${newClassInfo.seriesName}`);\n    };\n\n    const handleViewStudent = (student) => {\n        // Naviguer vers la page détaillée de l'élève ou ouvrir un modal\n        console.log('Voir élève:', student);\n        // navigate(`/students/${student.id}`); // Si vous avez une page dédiée\n    };\n\n    const handleViewPayments = (student) => {\n        // Naviguer vers la page des paiements de l'élève\n        navigate(`/student-payment/${student.id}`);\n    };\n\n    const handleEdit = (student) => {\n        setSelectedStudent(student);\n        \n        // Convertir la date au format YYYY-MM-DD pour l'input HTML\n        let dateOfBirth = '';\n        if (student.date_of_birth) {\n            try {\n                const date = new Date(student.date_of_birth);\n                if (!isNaN(date.getTime())) {\n                    dateOfBirth = date.toISOString().split('T')[0];\n                }\n            } catch (error) {\n                console.error('Error parsing date:', error);\n            }\n        }\n        \n        setFormData({\n            first_name: student.first_name || '',\n            last_name: student.last_name || '',\n            date_of_birth: dateOfBirth,\n            place_of_birth: student.place_of_birth || '',\n            gender: student.gender || 'M',\n            parent_name: student.parent_name || '',\n            parent_phone: student.parent_phone || '',\n            parent_email: student.parent_email || '',\n            mother_name: student.mother_name || '',\n            mother_phone: student.mother_phone || '',\n            address: student.address || '',\n            class_series_id: seriesId,\n            student_status: student.student_status || 'new',\n            has_scholarship_enabled: student.has_scholarship_enabled || false,\n            // school_year_id géré automatiquement par le backend\n        });\n        \n        // Charger la photo existante\n        if (student.photo_url) {\n            setPhotoPreview(student.photo_url);\n        } else {\n            setPhotoPreview('');\n        }\n        setStudentPhoto(null); // Reset file input for new photo\n        \n        setShowEditModal(true);\n    };\n\n    const handleStatusChange = async (studentId, newStatus) => {\n        try {\n            const response = await secureApiEndpoints.students.updateStatus(studentId, newStatus);\n            \n            if (response.success) {\n                // Mettre à jour l'état local\n                setStudents(prevStudents => \n                    prevStudents.map(student => \n                        student.id === studentId \n                            ? { ...student, student_status: newStatus }\n                            : student\n                    )\n                );\n                \n                setSuccess(`Statut mis à jour: ${newStatus === 'old' ? 'Ancien élève' : 'Nouvel élève'}`);\n                setTimeout(() => setSuccess(''), 3000);\n            } else {\n                setError(response.message || 'Erreur lors de la mise à jour du statut');\n            }\n        } catch (error) {\n            setError('Erreur lors de la mise à jour du statut');\n            console.error('Error updating student status:', error);\n        }\n    };\n\n    const handleDelete = async (student) => {\n        const result = await Swal.fire({\n            title: 'Confirmer la suppression',\n            text: `Êtes-vous sûr de vouloir supprimer l'élève \"${student.full_name}\" ?`,\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonColor: '#EF4444',\n            cancelButtonColor: '#6B7280',\n            confirmButtonText: 'Oui, supprimer',\n            cancelButtonText: 'Annuler'\n        });\n\n        if (result.isConfirmed) {\n            try {\n                const response = await secureApiEndpoints.students.delete(student.id);\n                \n                if (response.success) {\n                    loadStudents();\n                    setSuccess(response.message || 'Élève supprimé avec succès');\n                    \n                    Swal.fire({\n                        title: 'Supprimé',\n                        text: response.message || 'Élève supprimé avec succès',\n                        icon: 'success',\n                        timer: 2000,\n                        showConfirmButton: false\n                    });\n                } else {\n                    setError(response.message || 'Erreur lors de la suppression de l\\'élève');\n                }\n            } catch (error) {\n                console.error('Error deleting student:', error);\n                setError('Erreur lors de la suppression de l\\'élève');\n            }\n        }\n    };\n\n    const handleExportCsv = async () => {\n        try {\n            setLoading(true);\n            console.log('Exporting CSV for series:', seriesId);\n            \n            const blob = await secureApiEndpoints.students.exportCsv(seriesId);\n            \n            // Créer le lien de téléchargement\n            const url = window.URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = `eleves_${series?.name?.replace(/[^a-zA-Z0-9]/g, '_') || 'serie'}_${new Date().toISOString().split('T')[0]}.csv`;\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n            window.URL.revokeObjectURL(url);\n            \n            setSuccess('Export CSV réalisé avec succès');\n        } catch (error) {\n            console.error('Error exporting CSV:', error);\n            setError('Erreur lors de l\\'export CSV: ' + error.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleExportPdf = async () => {\n        try {\n            setLoading(true);\n            console.log('Exporting PDF for series:', seriesId);\n            \n            const response = await secureApiEndpoints.students.exportPdf(seriesId);\n            \n            // Le backend retourne du HTML formaté pour impression\n            const htmlContent = await response.text();\n            \n            // Créer une nouvelle fenêtre avec le HTML formaté\n            const printWindow = window.open('', '_blank');\n            printWindow.document.write(htmlContent);\n            printWindow.document.close();\n            \n            // Attendre que le contenu soit chargé puis déclencher l'impression\n            printWindow.onload = () => {\n                setTimeout(() => {\n                    printWindow.focus();\n                    printWindow.print();\n                }, 500);\n            };\n            \n            setSuccess('Fenêtre d\\'impression ouverte. Vous pouvez maintenant imprimer ou sauvegarder en PDF.');\n        } catch (error) {\n            console.error('Error exporting PDF:', error);\n            setError('Erreur lors de l\\'export PDF: ' + error.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleImportCsv = async (e) => {\n        e.preventDefault();\n        \n        // Validation détaillée\n        if (!importFile) {\n            setError('Veuillez sélectionner un fichier CSV');\n            return;\n        }\n        \n        if (!selectedSchoolYear) {\n            setError('Veuillez sélectionner une année scolaire');\n            return;\n        }\n        \n        if (!seriesId) {\n            setError('ID de série manquant');\n            return;\n        }\n\n        // Validation du type de fichier\n        const validTypes = ['text/csv', 'application/csv', 'text/plain'];\n        const fileExtension = importFile.name.toLowerCase().split('.').pop();\n        \n        if (!validTypes.includes(importFile.type) && fileExtension !== 'csv') {\n            setError('Le fichier doit être au format CSV (.csv)');\n            return;\n        }\n\n        try {\n            setLoading(true);\n            setError(''); // Clear any previous errors\n            \n            const formData = new FormData();\n            formData.append('file', importFile);\n            // class_series_id et school_year_id gérés automatiquement par la nouvelle route\n\n            // Debug log détaillé\n            console.log('Import CSV - FormData contents:', {\n                file: {\n                    name: importFile.name,\n                    type: importFile.type,\n                    size: importFile.size,\n                    lastModified: importFile.lastModified\n                },\n                seriesIdFromUrl: seriesId,\n                seriesInfo: series?.name,\n                schoolYearInfo: schoolYears.find(y => y.id == selectedSchoolYear)?.name\n            });\n\n            // Vérifier que FormData contient bien les données\n            for (let [key, value] of formData.entries()) {\n                console.log('FormData entry:', key, value);\n            }\n\n            const response = await secureApiEndpoints.students.importCsv(formData, seriesId);\n            \n            if (response.success) {\n                setSuccess(response.message);\n                setShowImportModal(false);\n                setImportFile(null);\n                loadStudents();\n                \n                // Afficher les erreurs s'il y en a\n                if (response.data.errors && response.data.errors.length > 0) {\n                    Swal.fire({\n                        title: 'Import terminé avec des erreurs',\n                        html: `\n                            <p><strong>${response.data.imported} élève(s) importé(s)</strong></p>\n                            <p>Erreurs :</p>\n                            <ul style=\"text-align: left;\">\n                                ${response.data.errors.map(error => `<li>${error}</li>`).join('')}\n                            </ul>\n                        `,\n                        icon: 'warning'\n                    });\n                } else {\n                    Swal.fire({\n                        title: 'Import réussi',\n                        text: response.message,\n                        icon: 'success',\n                        timer: 2000,\n                        showConfirmButton: false\n                    });\n                }\n            } else {\n                // Gérer les erreurs de validation du backend\n                if (response.errors) {\n                    let errorMessage = 'Erreurs de validation:\\n';\n                    Object.keys(response.errors).forEach(field => {\n                        errorMessage += `• ${field}: ${response.errors[field].join(', ')}\\n`;\n                    });\n                    setError(errorMessage);\n                } else {\n                    setError(response.message || 'Erreur lors de l\\'import');\n                }\n            }\n        } catch (error) {\n            console.error('Error importing CSV:', error);\n            \n            // Gestion d'erreur plus détaillée\n            let errorMessage = 'Erreur lors de l\\'import CSV';\n            \n            if (error.message) {\n                errorMessage += ': ' + error.message;\n            }\n            \n            // Si c'est une erreur réseau\n            if (error.name === 'TypeError' && error.message.includes('fetch')) {\n                errorMessage = 'Impossible de se connecter au serveur. Vérifiez votre connexion.';\n            }\n            \n            // Si c'est une erreur de parsing JSON\n            if (error.message.includes('JSON')) {\n                errorMessage = 'Erreur de format de réponse du serveur.';\n            }\n            \n            setError(errorMessage);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    // Fonction pour télécharger un modèle CSV\n    const handleDownloadTemplate = () => {\n        const headers = [\n            'Nom',\n            'Prénom', \n            'Date de naissance (DD/MM/YYYY)',\n            'Lieu de naissance',\n            'Sexe (M/F)',\n            'Nom du parent',\n            'Téléphone parent (optionnel)',\n            'Email parent (optionnel)',\n            'Adresse (optionnel)'\n        ];\n        \n        const sampleData = [\n            [\n                'NGUEME',\n                'Jean',\n                '15/03/2010',\n                'Douala',\n                'M',\n                'NGUEME Paul',\n                '690123456',\n                'parent@email.com',\n                'Bonanjo, Douala'\n            ],\n            [\n                'TCHOUA',\n                'Marie',\n                '20/08/2009',\n                'Yaoundé',\n                'F',\n                'TCHOUA Pierre',\n                '691234567',\n                'marie.parent@email.com',\n                'Melen, Yaoundé'\n            ]\n        ];\n        \n        // Créer le contenu CSV\n        const csvContent = [headers, ...sampleData]\n            .map(row => row.map(field => `\"${field}\"`).join(';'))\n            .join('\\n');\n        \n        // Créer le blob et télécharger\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'modele_import_eleves.csv';\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        window.URL.revokeObjectURL(url);\n        \n        setSuccess('Modèle CSV téléchargé avec succès');\n    };\n\n    // Fonction pour prévisualiser le fichier CSV avant import\n    const handleFilePreview = (file) => {\n        if (!file) return;\n        \n        const reader = new FileReader();\n        reader.onload = (e) => {\n            try {\n                const csvText = e.target.result;\n                const lines = csvText.split('\\n').filter(line => line.trim());\n                \n                if (lines.length < 2) {\n                    setError('Le fichier CSV doit contenir au moins une ligne d\\'en-têtes et une ligne de données');\n                    return;\n                }\n                \n                const headers = lines[0].split(';').map(h => h.replace(/\"/g, '').trim());\n                const expectedHeaders = ['Nom', 'Prénom', 'Date de naissance', 'Lieu de naissance', 'Sexe', 'Nom du parent'];\n                \n                // Vérifier les en-têtes obligatoires\n                const missingHeaders = expectedHeaders.filter(expected => \n                    !headers.some(header => \n                        header.toLowerCase().includes(expected.toLowerCase()) ||\n                        expected.toLowerCase().includes(header.toLowerCase())\n                    )\n                );\n                \n                if (missingHeaders.length > 0) {\n                    setError(`En-têtes manquants dans le CSV: ${missingHeaders.join(', ')}`);\n                    return;\n                }\n                \n                console.log('Prévisualisation CSV:', {\n                    totalLines: lines.length,\n                    headers: headers,\n                    dataLines: lines.length - 1,\n                    firstDataLine: lines[1]?.split(';').map(d => d.replace(/\"/g, '').trim())\n                });\n                \n                setError(''); // Clear any previous errors\n                setSuccess(`Fichier CSV valide: ${lines.length - 1} ligne(s) de données détectée(s)`);\n                \n            } catch (error) {\n                setError('Erreur lors de la lecture du fichier CSV: ' + error.message);\n            }\n        };\n        \n        reader.onerror = () => {\n            setError('Erreur lors de la lecture du fichier');\n        };\n        \n        reader.readAsText(file, 'UTF-8');\n    };\n\n    // Fonctions pour la gestion des photos\n    const handlePhotoUpload = (e) => {\n        const file = e.target.files[0];\n        if (file) {\n            // Validation du type de fichier\n            if (!file.type.startsWith('image/')) {\n                setError('Veuillez sélectionner un fichier image valide');\n                return;\n            }\n            \n            // Validation de la taille (max 5MB)\n            if (file.size > 5 * 1024 * 1024) {\n                setError('La taille de l\\'image ne doit pas dépasser 5MB');\n                return;\n            }\n            \n            setStudentPhoto(file);\n            \n            // Créer un aperçu\n            const reader = new FileReader();\n            reader.onload = (e) => {\n                setPhotoPreview(e.target.result);\n            };\n            reader.readAsDataURL(file);\n            \n            setError(''); // Clear any errors\n        }\n    };\n\n    const startCamera = async () => {\n        try {\n            const stream = await navigator.mediaDevices.getUserMedia({ \n                video: { \n                    width: 640, \n                    height: 480,\n                    facingMode: 'user' // Utiliser la caméra frontale si disponible\n                } \n            });\n            setCameraStream(stream);\n            setShowCamera(true);\n        } catch (error) {\n            console.error('Erreur d\\'accès à la caméra:', error);\n            setError('Impossible d\\'accéder à la caméra. Vérifiez les permissions.');\n        }\n    };\n\n    const stopCamera = () => {\n        if (cameraStream) {\n            cameraStream.getTracks().forEach(track => track.stop());\n            setCameraStream(null);\n        }\n        setShowCamera(false);\n    };\n\n    const capturePhoto = () => {\n        const video = document.getElementById('cameraVideo');\n        const canvas = document.createElement('canvas');\n        \n        canvas.width = video.videoWidth;\n        canvas.height = video.videoHeight;\n        \n        const context = canvas.getContext('2d');\n        context.drawImage(video, 0, 0);\n        \n        // Convertir en blob\n        canvas.toBlob((blob) => {\n            const file = new File([blob], 'photo_eleve.jpg', { type: 'image/jpeg' });\n            setStudentPhoto(file);\n            setPhotoPreview(canvas.toDataURL());\n            stopCamera();\n        }, 'image/jpeg', 0.8);\n    };\n\n    const removePhoto = () => {\n        setStudentPhoto(null);\n        setPhotoPreview('');\n        setError('');\n    };\n\n    // Fonction pour gérer le drag & drop\n    const handleDragEnd = async (event) => {\n        const { active, over } = event;\n\n        if (active.id !== over.id) {\n            const oldIndex = students.findIndex((student) => student.id === active.id);\n            const newIndex = students.findIndex((student) => student.id === over.id);\n\n            const newStudents = arrayMove(students, oldIndex, newIndex);\n            setStudents(newStudents);\n            setHasCustomOrder(true);\n\n            // Mettre à jour l'ordre sur le serveur\n            try {\n                const studentsWithOrder = newStudents.map((student, index) => ({\n                    id: student.id,\n                    order: index + 1\n                }));\n\n                await secureApiEndpoints.students.reorder({\n                    students: studentsWithOrder,\n                    class_series_id: parseInt(seriesId)\n                    // school_year_id géré automatiquement par le backend\n                });\n\n                setSuccess('Ordre des élèves mis à jour avec succès');\n                setTimeout(() => setSuccess(''), 3000);\n            } catch (error) {\n                console.error('Error reordering students:', error);\n                setError('Erreur lors de la réorganisation des élèves');\n                // Remettre l'ordre original en cas d'erreur\n                loadStudents();\n            }\n        }\n    };\n\n    // Fonction pour reclasser par ordre alphabétique\n    const handleSortAlphabetically = async () => {\n        const result = await Swal.fire({\n            title: 'Reclasser par ordre alphabétique',\n            text: 'Cette action va réorganiser tous les élèves par ordre alphabétique (Nom + Prénom). Continuer ?',\n            icon: 'question',\n            showCancelButton: true,\n            confirmButtonColor: '#0d6efd',\n            cancelButtonColor: '#6c757d',\n            confirmButtonText: 'Oui, reclasser',\n            cancelButtonText: 'Annuler'\n        });\n\n        if (result.isConfirmed) {\n            try {\n                setLoading(true);\n                const response = await secureApiEndpoints.students.sortAlphabetically(\n                    seriesId, \n                    {} // school_year_id géré automatiquement par le backend\n                );\n\n                if (response.success) {\n                    setStudents(response.data);\n                    setHasCustomOrder(false);\n                    setSuccess(response.message);\n                    setTimeout(() => setSuccess(''), 3000);\n                } else {\n                    setError(response.message || 'Erreur lors du reclassement');\n                }\n            } catch (error) {\n                console.error('Error sorting alphabetically:', error);\n                setError('Erreur lors du reclassement alphabétique');\n            } finally {\n                setLoading(false);\n            }\n        }\n    };\n\n    const resetForm = () => {\n        setFormData({\n            first_name: '',\n            last_name: '',\n            date_of_birth: '',\n            place_of_birth: '',\n            gender: 'M',\n            parent_name: '',\n            parent_phone: '',\n            parent_email: '',\n            mother_name: '',\n            mother_phone: '',\n            address: '',\n            class_series_id: seriesId,\n            student_status: 'new',\n            has_scholarship_enabled: false,\n            // school_year_id géré automatiquement par le backend\n        });\n        setSelectedStudent(null);\n        setStudentPhoto(null);\n        setPhotoPreview('');\n        stopCamera(); // Arrêter la caméra si elle est active\n    };\n\n    const handleCloseModal = () => {\n        setShowAddModal(false);\n        setShowEditModal(false);\n        setShowImportModal(false);\n        resetForm();\n        setError('');\n        setImportFile(null);\n    };\n\n    // Filter students\n    const filteredStudents = students.filter(student => {\n        // Nom + Prénom (au lieu de Prénom Nom)\n        const fullName = `${student.last_name || student.subname || ''} ${student.first_name || student.name || ''}`.toLowerCase();\n        const parentName = (student.parent_name || student.father_name || '').toLowerCase();\n        \n        const matchesSearch = fullName.includes(searchTerm.toLowerCase()) || \n               parentName.includes(searchTerm.toLowerCase()) ||\n               (student.student_number || '').toLowerCase().includes(searchTerm.toLowerCase());\n        \n        const matchesStatus = statusFilter === 'all' || \n            (statusFilter === 'new' && (student.student_status === 'new' || !student.student_status)) ||\n            (statusFilter === 'old' && student.student_status === 'old');\n        \n        return matchesSearch && matchesStatus;\n    });\n\n    if (loading && students.length === 0) {\n        return (\n            <div className=\"container-fluid py-4\">\n                <div className=\"text-center py-5\">\n                    <div className=\"spinner-border\" role=\"status\">\n                        <span className=\"visually-hidden\">Chargement des élèves...</span>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"container-fluid py-4\">\n            {/* Header */}\n            <div className=\"row mb-4\">\n                <div className=\"col-12\">\n                    <div className=\"d-flex justify-content-between align-items-center\">\n                        <div className=\"d-flex align-items-center\">\n                            <button\n                                className=\"btn btn-outline-secondary me-3\"\n                                onClick={() => navigate('/school-classes')}\n                            >\n                                <ArrowLeft size={16} className=\"me-1\" />\n                                Retour\n                            </button>\n                            <div>\n                                <h2 className=\"h4 mb-1\">\n                                    Élèves - {series?.name}\n                                </h2>\n                                <p className=\"text-muted mb-0\">\n                                    {series?.school_class?.level?.section?.name} - {series?.school_class?.level?.name} - {series?.school_class?.name}\n                                    {schoolYear && ` • Année ${schoolYear.name}`}\n                                    {filteredStudents.length > 0 && ` • ${filteredStudents.length} élève${filteredStudents.length > 1 ? 's' : ''}`}\n                                </p>\n                            </div>\n                        </div>\n                        <div className=\"d-flex gap-2\">\n                            <div className=\"d-flex gap-2\">\n                                <ImportExportButton\n                                    title=\"Élèves\"\n                                    apiBasePath=\"/api/students\"\n                                    onImportSuccess={loadStudents}\n                                    templateFileName=\"template_eleves.csv\"\n                                    seriesId={seriesId}\n                                />\n                                <BulkPhotoUpload\n                                    onUploadSuccess={loadStudents}\n                                />\n                                <button\n                                    className=\"btn btn-info d-flex align-items-center gap-2 me-2\"\n                                    onClick={() => setShowStudentsListModal(true)}\n                                >\n                                    <List size={16} />\n                                    Liste des élèves\n                                </button>\n                                <button\n                                    className=\"btn btn-primary d-flex align-items-center gap-2\"\n                                    onClick={() => setShowAddModal(true)}\n                                >\n                                    <Plus size={16} />\n                                    Nouvel Élève\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Alerts */}\n            {error && (\n                <div className=\"row mb-3\">\n                    <div className=\"col-12\">\n                        <div className=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">\n                            {error}\n                            <button \n                                type=\"button\" \n                                className=\"btn-close\" \n                                onClick={() => setError('')}\n                                aria-label=\"Close\"\n                            ></button>\n                        </div>\n                    </div>\n                </div>\n            )}\n            {success && (\n                <div className=\"row mb-3\">\n                    <div className=\"col-12\">\n                        <div className=\"alert alert-success alert-dismissible fade show\" role=\"alert\">\n                            {success}\n                            <button \n                                type=\"button\" \n                                className=\"btn-close\" \n                                onClick={() => setSuccess('')}\n                                aria-label=\"Close\"\n                            ></button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Filters */}\n            <div className=\"row mb-4\">\n                <div className=\"col-12\">\n                    <div className=\"card\">\n                        <div className=\"card-body\">\n                            <div className=\"row g-3\">\n                                <div className=\"col-md-6\">\n                                    <label className=\"form-label\">Rechercher</label>\n                                    <div className=\"position-relative\">\n                                        <Search className=\"position-absolute top-50 start-0 translate-middle-y ms-3 text-muted\" size={16} />\n                                        <input\n                                            type=\"text\"\n                                            className=\"form-control ps-5\"\n                                            placeholder=\"Rechercher par nom, prénom, parent ou numéro...\"\n                                            value={searchTerm}\n                                            onChange={(e) => setSearchTerm(e.target.value)}\n                                        />\n                                    </div>\n                                </div>\n                                <div className=\"col-md-3\">\n                                    <label className=\"form-label\">Statut</label>\n                                    <select\n                                        className=\"form-select\"\n                                        value={statusFilter}\n                                        onChange={(e) => setStatusFilter(e.target.value)}\n                                    >\n                                        <option value=\"all\">Tous les élèves</option>\n                                        <option value=\"new\">Nouveaux élèves</option>\n                                        <option value=\"old\">Anciens élèves</option>\n                                    </select>\n                                </div>\n                                <div className=\"col-md-3 d-flex align-items-end\">\n                                    <div className=\"btn-group me-3\" role=\"group\">\n                                        <button\n                                            type=\"button\"\n                                            className={`btn ${viewMode === 'grid' ? 'btn-primary' : 'btn-outline-secondary'}`}\n                                            onClick={() => setViewMode('grid')}\n                                            title=\"Vue grille\"\n                                        >\n                                            <Grid size={16} />\n                                        </button>\n                                        <button\n                                            type=\"button\"\n                                            className={`btn ${viewMode === 'list' ? 'btn-primary' : 'btn-outline-secondary'}`}\n                                            onClick={() => setViewMode('list')}\n                                            title=\"Vue liste\"\n                                        >\n                                            <List size={16} />\n                                        </button>\n                                    </div>\n                                    <button\n                                        className=\"btn btn-outline-secondary me-2\"\n                                        onClick={() => setSearchTerm('')}\n                                    >\n                                        Réinitialiser\n                                    </button>\n                                    {/* {hasCustomOrder && ( */}\n                                        <button\n                                            className=\"btn btn-warning\"\n                                            onClick={handleSortAlphabetically}\n                                            title=\"Reclasser par ordre alphabétique\"\n                                        >\n                                            <SortAlphaDown size={16} className=\"me-1\" />\n                                            Ordre alphabétique\n                                        </button>\n                                    {/* )} */}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Students List */}\n            <div className=\"row\">\n                <div className=\"col-12\">\n                    {filteredStudents.length === 0 ? (\n                        <div className=\"card\">\n                            <div className=\"card-body text-center py-5\">\n                                <Person size={48} className=\"text-muted mb-3\" />\n                                <h5 className=\"text-muted\">Aucun élève trouvé</h5>\n                                <p className=\"text-muted mb-4\">\n                                    {searchTerm \n                                        ? 'Aucun élève ne correspond à vos critères de recherche.'\n                                        : 'Commencez par ajouter le premier élève de cette série.'\n                                    }\n                                </p>\n                                <button\n                                    className=\"btn btn-primary\"\n                                    onClick={() => setShowAddModal(true)}\n                                >\n                                    <Plus size={16} className=\"me-2\" />\n                                    Ajouter un élève\n                                </button>\n                            </div>\n                        </div>\n                    ) : viewMode === 'grid' ? (\n                        // Vue en grilles (cartes)\n                        <div className=\"row\">\n                            {filteredStudents.map((student) => (\n                                <div key={student.id} className=\"col-md-6 col-lg-4 mb-4\">\n                                    <div className=\"card h-100 hover-card\">\n                                        <div className=\"card-body\">\n                                            <div className=\"d-flex justify-content-between align-items-start mb-3\">\n                                                <div className=\"d-flex align-items-center\">\n                                                    <StudentPhoto student={student} size={40} className=\"me-3\" />\n                                                    <div>\n                                                        <h6 className=\"card-title mb-1\">\n                                                            {student.full_name || `${student.last_name || student.subname || ''} ${student.first_name || student.name || ''}`}\n                                                        </h6>\n                                                        <div className=\"d-flex align-items-center\">\n                                                            <small className=\"text-muted\">\n                                                                N° {student.student_number}\n                                                            </small>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                                <span className={`badge ${student.gender === 'M' ? 'bg-info' : 'bg-pink'}`}>\n                                                    {student.gender === 'M' ? 'M' : 'F'}\n                                                </span>\n                                            </div>\n                                            \n                                            <div className=\"mb-3\">\n                                                {student.date_of_birth && (\n                                                    <div className=\"d-flex align-items-center mb-2\">\n                                                        <Calendar size={14} className=\"text-muted me-2 flex-shrink-0\" />\n                                                        <small className=\"text-muted\">\n                                                            {new Date(student.date_of_birth).toLocaleDateString('fr-FR')}\n                                                        </small>\n                                                    </div>\n                                                )}\n                                                {student.place_of_birth && (\n                                                    <div className=\"d-flex align-items-center mb-2\">\n                                                        <GeoAlt size={14} className=\"text-muted me-2 flex-shrink-0\" />\n                                                        <small className=\"text-muted\">{student.place_of_birth}</small>\n                                                    </div>\n                                                )}\n                                                {(student.parent_name || student.father_name) && (\n                                                    <div className=\"d-flex align-items-center mb-2\">\n                                                        <Person size={14} className=\"text-muted me-2 flex-shrink-0\" />\n                                                        <small className=\"text-muted\">\n                                                            Parent: {student.parent_name || student.father_name}\n                                                        </small>\n                                                    </div>\n                                                )}\n                                                \n                                                {/* Indicateur de bourse */}\n                                                <div className=\"d-flex align-items-center\">\n                                                    <CashCoin size={14} className=\"text-muted me-2 flex-shrink-0\" />\n                                                    <small>\n                                                        {student.has_scholarship_enabled ? (\n                                                            <span className=\"badge bg-success bg-opacity-25 text-success\">\n                                                                Bourse activée\n                                                            </span>\n                                                        ) : (\n                                                            <span className=\"badge bg-secondary bg-opacity-25 text-muted\">\n                                                                Bourse désactivée\n                                                            </span>\n                                                        )}\n                                                    </small>\n                                                </div>\n                                            </div>\n                                            \n                                            <div className=\"d-flex justify-content-end mt-auto\">\n                                                <StudentActionsDropdown\n                                                    student={student}\n                                                    onPrintCard={handlePrintCard}\n                                                    onTransfer={handleTransferStudent}\n                                                    onEdit={handleEdit}\n                                                    onDelete={handleDelete}\n                                                    onViewPayments={handleViewPayments}\n                                                    onViewStudent={handleViewStudent}\n                                                    userRole={user?.role}\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    ) : (\n                        // Vue en liste (tableau) avec drag & drop\n                        <div className=\"card\" style={{ overflow: 'visible' }}>\n                            <div className=\"card-body p-0\">\n                                <div className=\"table-responsive\"  style={{ overflow: 'visible' }}>\n                                    <DndContext\n                                        sensors={sensors}\n                                        collisionDetection={closestCenter}\n                                        onDragEnd={handleDragEnd}\n                                    >\n                                        <table className=\"table table-hover mb-0\">\n                                            <thead className=\"table-light\">\n                                                <tr>\n                                                    <th>Photo & N°</th>\n                                                    <th>Nom & Prénom</th>\n                                                    <th>Date/Lieu naissance</th>\n                                                    <th>Sexe</th>\n                                                    <th>Statut</th>\n                                                    <th>Parent</th>\n                                                    <th>Contact</th>\n                                                    <th>Bourse</th>\n                                                    <th>Actions</th>\n                                                </tr>\n                                            </thead>\n                                            <SortableContext\n                                                items={filteredStudents.map(s => s.id)}\n                                                strategy={verticalListSortingStrategy}\n                                            >\n                                                <tbody>\n                                                    {filteredStudents.map((student) => (\n                                                        <SortableStudent\n                                                            key={student.id}\n                                                            student={student}\n                                                            handleEdit={handleEdit}\n                                                            handleDelete={handleDelete}\n                                                            handlePrintCard={handlePrintCard}\n                                                            handleTransferStudent={handleTransferStudent}\n                                                            handleViewStudent={handleViewStudent}\n                                                            handleViewPayments={handleViewPayments}\n                                                            handleStatusChange={handleStatusChange}\n                                                            navigate={navigate}\n                                                            userRole={user?.role}\n                                                        />\n                                                    ))}\n                                                </tbody>\n                                            </SortableContext>\n                                        </table>\n                                    </DndContext>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n\n            {/* Add/Edit Student Modal */}\n            {(showAddModal || showEditModal) && (\n                <div className=\"modal fade show d-block\" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>\n                    <div className=\"modal-dialog modal-lg\">\n                        <div className=\"modal-content\">\n                            <div className=\"modal-header\">\n                                <h5 className=\"modal-title\">\n                                    {selectedStudent ? 'Modifier l\\'élève' : 'Ajouter un élève'}\n                                </h5>\n                                <button\n                                    type=\"button\"\n                                    className=\"btn-close\"\n                                    onClick={handleCloseModal}\n                                ></button>\n                            </div>\n                            <form onSubmit={handleSubmit}>\n                                <div className=\"modal-body\">\n                                    {/* Section Photo */}\n                                    <div className=\"row mb-4\">\n                                        <div className=\"col-12\">\n                                            <label className=\"form-label\">Photo de l'élève</label>\n                                            <div className=\"d-flex flex-column align-items-center\">\n                                                {/* Aperçu de la photo */}\n                                                <div className=\"mb-3 position-relative\" style={{ width: '150px', height: '150px' }}>\n                                                    {photoPreview ? (\n                                                        <>\n                                                            <img \n                                                                src={photoPreview} \n                                                                alt=\"Aperçu photo élève\" \n                                                                className=\"img-thumbnail border-2 shadow-sm\"\n                                                                style={{ width: '150px', height: '150px', objectFit: 'cover' }}\n                                                            />\n                                                            <button\n                                                                type=\"button\"\n                                                                className=\"btn btn-sm btn-danger position-absolute\"\n                                                                onClick={removePhoto}\n                                                                style={{ top: '-8px', right: '-8px' }}\n                                                                title=\"Supprimer la photo\"\n                                                            >\n                                                                <X size={12} />\n                                                            </button>\n                                                        </>\n                                                    ) : (\n                                                        <div \n                                                            className=\"d-flex flex-column align-items-center justify-content-center border border-dashed border-2 rounded h-100\"\n                                                            style={{ backgroundColor: '#f8f9fa' }}\n                                                        >\n                                                            <Person size={48} className=\"text-muted mb-2\" />\n                                                            <small className=\"text-muted text-center\">Aucune photo</small>\n                                                        </div>\n                                                    )}\n                                                </div>\n                                                \n                                                {/* Boutons d'action photo */}\n                                                <div className=\"d-flex gap-2 mb-3\">\n                                                    <button\n                                                        type=\"button\"\n                                                        className=\"btn btn-outline-primary btn-sm\"\n                                                        onClick={startCamera}\n                                                    >\n                                                        <Camera size={16} className=\"me-1\" />\n                                                        Capturer\n                                                    </button>\n                                                    <label className=\"btn btn-outline-secondary btn-sm\" htmlFor=\"photoUpload\">\n                                                        <Image size={16} className=\"me-1\" />\n                                                        Choisir fichier\n                                                    </label>\n                                                    <input\n                                                        id=\"photoUpload\"\n                                                        type=\"file\"\n                                                        accept=\"image/*\"\n                                                        onChange={handlePhotoUpload}\n                                                        style={{ display: 'none' }}\n                                                    />\n                                                </div>\n                                                \n                                                {/* Modal caméra */}\n                                                {showCamera && (\n                                                    <div className=\"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center\" \n                                                         style={{ backgroundColor: 'rgba(0,0,0,0.8)', zIndex: 9999 }}>\n                                                        <div className=\"bg-white p-4 rounded\">\n                                                            <div className=\"d-flex justify-content-between align-items-center mb-3\">\n                                                                <h5 className=\"mb-0\">Capture Photo</h5>\n                                                                <button\n                                                                    type=\"button\"\n                                                                    className=\"btn-close\"\n                                                                    onClick={stopCamera}\n                                                                ></button>\n                                                            </div>\n                                                            <video\n                                                                id=\"cameraVideo\"\n                                                                autoPlay\n                                                                playsInline\n                                                                ref={(video) => {\n                                                                    if (video && cameraStream) {\n                                                                        video.srcObject = cameraStream;\n                                                                    }\n                                                                }}\n                                                                style={{ width: '400px', height: '300px' }}\n                                                                className=\"border rounded mb-3\"\n                                                            />\n                                                            <div className=\"d-flex justify-content-center gap-2\">\n                                                                <button\n                                                                    type=\"button\"\n                                                                    className=\"btn btn-primary\"\n                                                                    onClick={capturePhoto}\n                                                                >\n                                                                    <Camera size={16} className=\"me-1\" />\n                                                                    Capturer\n                                                                </button>\n                                                                <button\n                                                                    type=\"button\"\n                                                                    className=\"btn btn-secondary\"\n                                                                    onClick={stopCamera}\n                                                                >\n                                                                    Annuler\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                )}\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    <div className=\"row\">\n                                        <div className=\"col-md-6\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Nom *</label>\n                                                <input\n                                                    type=\"text\"\n                                                    className=\"form-control\"\n                                                    value={formData.last_name}\n                                                    onChange={(e) => setFormData({...formData, last_name: e.target.value})}\n                                                    required\n                                                />\n                                            </div>\n                                        </div>\n                                        <div className=\"col-md-6\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Prénom *</label>\n                                                <input\n                                                    type=\"text\"\n                                                    className=\"form-control\"\n                                                    value={formData.first_name}\n                                                    onChange={(e) => setFormData({...formData, first_name: e.target.value})}\n                                                    required\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n                                    \n                                    <div className=\"row\">\n                                        <div className=\"col-md-6\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Date de naissance *</label>\n                                                <input\n                                                    type=\"date\"\n                                                    className=\"form-control\"\n                                                    value={formData.date_of_birth}\n                                                    onChange={(e) => setFormData({...formData, date_of_birth: e.target.value})}\n                                                    required\n                                                />\n                                            </div>\n                                        </div>\n                                        <div className=\"col-md-6\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Lieu de naissance *</label>\n                                                <input\n                                                    type=\"text\"\n                                                    className=\"form-control\"\n                                                    value={formData.place_of_birth}\n                                                    onChange={(e) => setFormData({...formData, place_of_birth: e.target.value})}\n                                                    required\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n                                    \n                                    <div className=\"row\">\n                                        <div className=\"col-md-4\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Sexe *</label>\n                                                <select\n                                                    className=\"form-select\"\n                                                    value={formData.gender}\n                                                    onChange={(e) => setFormData({...formData, gender: e.target.value})}\n                                                    required\n                                                >\n                                                    <option value=\"\">Sélectionner</option>\n                                                    <option value=\"M\">Masculin</option>\n                                                    <option value=\"F\">Féminin</option>\n                                                </select>\n                                            </div>\n                                        </div>\n                                        <div className=\"col-md-4\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Statut</label>\n                                                <select\n                                                    className=\"form-select\"\n                                                    value={formData.student_status || 'new'}\n                                                    onChange={(e) => setFormData({...formData, student_status: e.target.value})}\n                                                >\n                                                    <option value=\"new\">Nouveau élève</option>\n                                                    <option value=\"old\">Ancien élève</option>\n                                                </select>\n                                            </div>\n                                        </div>\n                                        <div className=\"col-md-4\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Nom du parent *</label>\n                                                <input\n                                                    type=\"text\"\n                                                    className=\"form-control\"\n                                                    value={formData.parent_name}\n                                                    onChange={(e) => setFormData({...formData, parent_name: e.target.value})}\n                                                    required\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n                                    \n                                    <div className=\"row\">\n                                        <div className=\"col-md-6\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Téléphone parent</label>\n                                                <input\n                                                    type=\"tel\"\n                                                    className=\"form-control\"\n                                                    value={formData.parent_phone}\n                                                    onChange={(e) => setFormData({...formData, parent_phone: e.target.value})}\n                                                />\n                                            </div>\n                                        </div>\n                                        <div className=\"col-md-6\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Email parent</label>\n                                                <input\n                                                    type=\"email\"\n                                                    className=\"form-control\"\n                                                    value={formData.parent_email}\n                                                    onChange={(e) => setFormData({...formData, parent_email: e.target.value})}\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    {/* Informations mère */}\n                                    <div className=\"row\">\n                                        <div className=\"col-md-6\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Nom de la mère</label>\n                                                <input\n                                                    type=\"text\"\n                                                    className=\"form-control\"\n                                                    value={formData.mother_name}\n                                                    onChange={(e) => setFormData({...formData, mother_name: e.target.value})}\n                                                />\n                                            </div>\n                                        </div>\n                                        <div className=\"col-md-6\">\n                                            <div className=\"mb-3\">\n                                                <label className=\"form-label\">Téléphone mère</label>\n                                                <input\n                                                    type=\"tel\"\n                                                    className=\"form-control\"\n                                                    value={formData.mother_phone}\n                                                    onChange={(e) => setFormData({...formData, mother_phone: e.target.value})}\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n                                    \n                                    <div className=\"mb-3\">\n                                        <label className=\"form-label\">Adresse</label>\n                                        <textarea\n                                            className=\"form-control\"\n                                            rows=\"3\"\n                                            value={formData.address}\n                                            onChange={(e) => setFormData({...formData, address: e.target.value})}\n                                        />\n                                    </div>\n                                    \n                                    <div className=\"mb-3\">\n                                        <div className=\"form-check\">\n                                            <input\n                                                className=\"form-check-input\"\n                                                type=\"checkbox\"\n                                                id=\"scholarshipEnabled\"\n                                                checked={formData.has_scholarship_enabled}\n                                                onChange={(e) => setFormData({...formData, has_scholarship_enabled: e.target.checked})}\n                                            />\n                                            <label className=\"form-check-label\" htmlFor=\"scholarshipEnabled\">\n                                                <strong>Activer les bourses pour cet élève</strong>\n                                                <br />\n                                                <small className=\"text-muted\">\n                                                    Si coché, l'élève pourra bénéficier des bourses configurées pour sa classe lors des paiements\n                                                </small>\n                                            </label>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div className=\"modal-footer\">\n                                    <button\n                                        type=\"button\"\n                                        className=\"btn btn-secondary\"\n                                        onClick={handleCloseModal}\n                                    >\n                                        Annuler\n                                    </button>\n                                    <button\n                                        type=\"submit\"\n                                        className=\"btn btn-primary\"\n                                        disabled={loading}\n                                    >\n                                        {loading ? 'Enregistrement...' : (selectedStudent ? 'Modifier' : 'Créer')}\n                                    </button>\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Import CSV Modal */}\n            {showImportModal && (\n                <div className=\"modal fade show d-block\" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>\n                    <div className=\"modal-dialog\">\n                        <div className=\"modal-content\">\n                            <div className=\"modal-header\">\n                                <h5 className=\"modal-title\">Importer des élèves (CSV)</h5>\n                                <button\n                                    type=\"button\"\n                                    className=\"btn-close\"\n                                    onClick={handleCloseModal}\n                                ></button>\n                            </div>\n                            <form onSubmit={handleImportCsv}>\n                                <div className=\"modal-body\">\n                                    <div className=\"mb-3\">\n                                        <label className=\"form-label\">Année scolaire *</label>\n                                        <select\n                                            className=\"form-select\"\n                                            value={selectedSchoolYear}\n                                            onChange={(e) => setSelectedSchoolYear(e.target.value)}\n                                            required\n                                        >\n                                            <option value=\"\">Sélectionner une année</option>\n                                            {schoolYears.map(year => (\n                                                <option key={year.id} value={year.id}>\n                                                    {year.name} {year.is_current ? '(Courante)' : ''}\n                                                </option>\n                                            ))}\n                                        </select>\n                                    </div>\n                                    \n                                    <div className=\"mb-3\">\n                                        <div className=\"d-flex justify-content-between align-items-center mb-2\">\n                                            <label className=\"form-label mb-0\">Fichier CSV *</label>\n                                            <button\n                                                type=\"button\"\n                                                className=\"btn btn-sm btn-outline-info\"\n                                                onClick={handleDownloadTemplate}\n                                                title=\"Télécharger le modèle CSV\"\n                                            >\n                                                <Download size={14} className=\"me-1\" />\n                                                Modèle CSV\n                                            </button>\n                                        </div>\n                                        <input\n                                            type=\"file\"\n                                            className=\"form-control\"\n                                            accept=\".csv,.txt\"\n                                            onChange={(e) => {\n                                                const file = e.target.files[0];\n                                                setImportFile(file);\n                                                if (file) {\n                                                    handleFilePreview(file);\n                                                }\n                                            }}\n                                            required\n                                        />\n                                        <div className=\"form-text\">\n                                            Le fichier doit contenir les colonnes : Nom, Prénom, Date naissance, Lieu naissance, Sexe, Nom parent, Téléphone parent (optionnel), Email parent (optionnel), Adresse (optionnel)\n                                            <br />\n                                            <small className=\"text-muted\">💡 Cliquez sur \"Modèle CSV\" pour télécharger un exemple de format</small>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div className=\"modal-footer\">\n                                    <button\n                                        type=\"button\"\n                                        className=\"btn btn-secondary\"\n                                        onClick={handleCloseModal}\n                                    >\n                                        Annuler\n                                    </button>\n                                    <button\n                                        type=\"submit\"\n                                        className=\"btn btn-primary\"\n                                        disabled={loading}\n                                    >\n                                        {loading ? 'Import en cours...' : 'Importer'}\n                                    </button>\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* CSS for hover effects and drag & drop */}\n            <style jsx>{`\n                .hover-card {\n                    transition: box-shadow 0.2s ease-in-out;\n                }\n                .hover-card:hover {\n                    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;\n                }\n                .bg-pink {\n                    background-color: #e91e63 !important;\n                }\n                .drag-handle {\n                    opacity: 0.6;\n                    transition: opacity 0.2s ease;\n                }\n                .drag-handle:hover {\n                    opacity: 1;\n                }\n                .dragging {\n                    background-color: rgba(0, 123, 255, 0.1) !important;\n                }\n                tbody tr:hover .drag-handle {\n                    opacity: 1;\n                }\n            `}</style>\n\n            {/* Modal d'impression de carte scolaire */}\n            {showCardPrint && newStudentForCard && (\n                <StudentCardPrint\n                    student={newStudentForCard}\n                    schoolYear={schoolYear}\n                    show={showCardPrint}\n                    onHide={() => {\n                        setShowCardPrint(false);\n                        setNewStudentForCard(null);\n                    }}\n                    onPrintSuccess={() => {\n                        console.log('Carte imprimée avec succès');\n                    }}\n                />\n            )}\n\n            {/* Modal de transfert d'élève */}\n            {showTransferModal && studentToTransfer && (\n                <StudentTransfer\n                    student={studentToTransfer}\n                    show={showTransferModal}\n                    onHide={() => {\n                        setShowTransferModal(false);\n                        setStudentToTransfer(null);\n                    }}\n                    onTransferSuccess={handleTransferSuccess}\n                />\n            )}\n\n            {/* Modal Liste des élèves */}\n            {showStudentsListModal && (\n                <div className=\"modal fade show d-block\" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>\n                    <div className=\"modal-dialog modal-xl\">\n                        <div className=\"modal-content\">\n                            <div className=\"modal-header\">\n                                <h5 className=\"modal-title\">\n                                    <List className=\"me-2\" />\n                                    Liste des élèves - {series?.name}\n                                </h5>\n                                <button\n                                    type=\"button\"\n                                    className=\"btn-close\"\n                                    onClick={() => setShowStudentsListModal(false)}\n                                ></button>\n                            </div>\n                            <div className=\"modal-body\">\n                                <div className=\"table-responsive\">\n                                    <table className=\"table table-striped table-hover\">\n                                        <thead className=\"table-dark\">\n                                            <tr>\n                                                <th>Numéro</th>\n                                                <th>Nom et Prénom</th>\n                                                <th>Date de naissance</th>\n                                                <th>Nom du père avec numéro</th>\n                                                <th>Nom de la mère avec numéro</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                            {students.map((student, index) => (\n                                                <tr key={student.id}>\n                                                    <td>\n                                                        <span className=\"badge bg-primary\">\n                                                            {student.student_number || `N°${index + 1}`}\n                                                        </span>\n                                                    </td>\n                                                    <td>\n                                                        <div className=\"d-flex align-items-center\">\n                                                            <StudentPhoto student={student} size={32} className=\"me-2\" />\n                                                            <div>\n                                                                <div className=\"fw-bold\">\n                                                                    {student.last_name || student.subname} {student.first_name || student.name}\n                                                                </div>\n                                                                {student.gender && (\n                                                                    <small className={`text-${student.gender === 'M' ? 'info' : 'pink'}`}>\n                                                                        {student.gender === 'M' ? 'Masculin' : 'Féminin'}\n                                                                    </small>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </td>\n                                                    <td>\n                                                        {student.date_of_birth ? (\n                                                            <div>\n                                                                <Calendar size={14} className=\"me-1 text-muted\" />\n                                                                {new Date(student.date_of_birth).toLocaleDateString('fr-FR')}\n                                                                {student.place_of_birth && (\n                                                                    <div>\n                                                                        <small className=\"text-muted\">\n                                                                            <GeoAlt size={12} className=\"me-1\" />\n                                                                            {student.place_of_birth}\n                                                                        </small>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        ) : (\n                                                            <span className=\"text-muted\">Non renseigné</span>\n                                                        )}\n                                                    </td>\n                                                    <td>\n                                                        {student.parent_name || student.father_name ? (\n                                                            <div>\n                                                                <div className=\"fw-medium\">\n                                                                    <Person size={14} className=\"me-1 text-primary\" />\n                                                                    {student.parent_name || student.father_name}\n                                                                </div>\n                                                                {student.parent_phone && (\n                                                                    <div>\n                                                                        <small className=\"text-success\">\n                                                                            <Telephone size={12} className=\"me-1\" />\n                                                                            {student.parent_phone}\n                                                                        </small>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        ) : (\n                                                            <span className=\"text-muted\">Non renseigné</span>\n                                                        )}\n                                                    </td>\n                                                    <td>\n                                                        {student.mother_name ? (\n                                                            <div>\n                                                                <div className=\"fw-medium\">\n                                                                    <Person size={14} className=\"me-1 text-danger\" />\n                                                                    {student.mother_name}\n                                                                </div>\n                                                                {student.mother_phone && (\n                                                                    <div>\n                                                                        <small className=\"text-success\">\n                                                                            <Telephone size={12} className=\"me-1\" />\n                                                                            {student.mother_phone}\n                                                                        </small>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        ) : (\n                                                            <span className=\"text-muted\">Non renseigné</span>\n                                                        )}\n                                                    </td>\n                                                </tr>\n                                            ))}\n                                        </tbody>\n                                    </table>\n                                </div>\n                                {students.length === 0 && (\n                                    <div className=\"text-center py-4\">\n                                        <Person size={48} className=\"text-muted mb-3\" />\n                                        <p className=\"text-muted\">Aucun élève trouvé dans cette série.</p>\n                                    </div>\n                                )}\n                            </div>\n                            <div className=\"modal-footer\">\n                                <div className=\"me-auto\">\n                                    <small className=\"text-muted\">\n                                        Total: {students.length} élève{students.length > 1 ? 's' : ''}\n                                    </small>\n                                </div>\n                                <button\n                                    type=\"button\"\n                                    className=\"btn btn-danger me-2\"\n                                    onClick={downloadStudentsListPdf}\n                                    disabled={loading || students.length === 0}\n                                >\n                                    <Download size={16} className=\"me-2\" />\n                                    Télécharger PDF\n                                </button>\n                                <button\n                                    type=\"button\"\n                                    className=\"btn btn-secondary\"\n                                    onClick={() => setShowStudentsListModal(false)}\n                                >\n                                    Fermer\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default SeriesStudents;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}