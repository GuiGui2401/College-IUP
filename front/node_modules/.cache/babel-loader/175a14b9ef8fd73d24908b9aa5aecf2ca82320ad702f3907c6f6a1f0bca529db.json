{"ast":null,"code":"import React,{useState}from'react';import{Modal,Button,Spinner}from'react-bootstrap';import{Printer}from'react-bootstrap-icons';import StudentCard from'./StudentCard';import{useSchool}from'../contexts/SchoolContext';import Swal from'sweetalert2';import{host}from'../utils/fetch';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const StudentCardPrint=_ref=>{let{student,schoolYear,show,onHide,onPrintSuccess}=_ref;const[printing,setPrinting]=useState(false);const{schoolSettings}=useSchool();const convertImageToBase64=async imageSrc=>{return new Promise((resolve,reject)=>{if(!imageSrc){resolve('');return;}const img=new Image();img.crossOrigin='anonymous';img.onload=function(){const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');canvas.width=img.width;canvas.height=img.height;ctx.drawImage(img,0,0);try{const dataURL=canvas.toDataURL('image/png');resolve(dataURL);}catch(error){console.error('Error converting image to base64:',error);resolve('');}};img.onerror=function(){console.error('Error loading image:',imageSrc);resolve('');};img.src=imageSrc;});};const getStudentPhotoUrl=student=>{if(student.photo_url)return student.photo_url;if(student.photo){if(student.photo.startsWith('http'))return student.photo;return`${host}/storage/${student.photo}`;}// Retourner l'image par défaut en utilisant un chemin absolu\nreturn`${window.location.origin}/static/media/1.png`;};const handlePrint=async()=>{if(!student)return;try{var _schoolSettings$schoo,_student$last_name,_student$class_series;setPrinting(true);// Convertir les images en base64 pour l'impression\nconst studentPhotoUrl=getStudentPhotoUrl(student);const logoUrl=schoolSettings===null||schoolSettings===void 0?void 0:schoolSettings.logo_url;console.log('Preparing images for print:',{studentPhotoUrl,logoUrl,studentId:student.id});const[studentPhotoBase64,logoBase64]=await Promise.all([convertImageToBase64(studentPhotoUrl),convertImageToBase64(logoUrl)]);console.log('Images converted to base64:',{hasStudentPhoto:!!studentPhotoBase64,hasLogo:!!logoBase64,studentPhotoLength:(studentPhotoBase64===null||studentPhotoBase64===void 0?void 0:studentPhotoBase64.length)||0,logoLength:(logoBase64===null||logoBase64===void 0?void 0:logoBase64.length)||0});// Créer une nouvelle fenêtre pour l'impression\nconst printWindow=window.open('','_blank','width=800,height=600');if(!printWindow){throw new Error('Popup bloqué. Veuillez autoriser les popups pour imprimer.');}// Générer le HTML de la carte avec les styles d'impression\nconst cardHtml=`\n                <!DOCTYPE html>\n                <html>\n                <head>\n                    <meta charset=\"UTF-8\">\n                    <title>Carte Scolaire - ${student.first_name} ${student.last_name}</title>\n                    <style>\n                        * {\n                            margin: 0;\n                            padding: 0;\n                            box-sizing: border-box;\n                        }\n                        \n                        body {\n                            font-family: Arial, sans-serif;\n                            background: white;\n                            padding: 20px;\n                            display: flex;\n                            justify-content: center;\n                            align-items: center;\n                            min-height: 100vh;\n                        }\n                        \n                        .card-container {\n                            width: 85.6mm;\n                            height: 54mm;\n                            background: white;\n                            border: 2px solid #e67e22;\n                            border-radius: 8px;\n                            overflow: hidden;\n                            position: relative;\n                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n                        }\n                        \n                        .card-header {\n                            background: #f8f9fa;\n                            padding: 4px 8px;\n                            border-bottom: 1px solid #e67e22;\n                            text-align: center;\n                            font-size: 8px;\n                            font-weight: bold;\n                        }\n                        \n                        .header-content {\n                            display: flex;\n                            align-items: center;\n                            justify-content: space-between;\n                        }\n                        \n                        .flag-section {\n                            font-size: 6px;\n                        }\n                        \n                        .school-section {\n                            text-align: center;\n                            flex: 1;\n                        }\n                        \n                        .school-name {\n                            font-size: 10px;\n                            font-weight: bold;\n                            color: #2c3e50;\n                        }\n                        \n                        .card-title {\n                            font-size: 8px;\n                            color: #7f8c8d;\n                        }\n                        \n                        .logo-section {\n                            width: 20px;\n                        }\n                        \n                        .logo {\n                            width: 18px;\n                            height: 18px;\n                            object-fit: contain;\n                        }\n                        \n                        .card-body {\n                            padding: 6px;\n                            display: flex;\n                            height: calc(100% - 30px);\n                            position: relative;\n                        }\n                        \n                        .photo {\n                            width: 40px;\n                            height: 45px;\n                            object-fit: cover;\n                            border: 1px solid #ddd;\n                            border-radius: 2px;\n                            margin-right: 6px;\n                        }\n                        \n                        .info-section {\n                            flex: 1;\n                            font-size: 8px;\n                            line-height: 1.2;\n                        }\n                        \n                        .year-info {\n                            font-size: 7px;\n                            margin-bottom: 2px;\n                            font-weight: bold;\n                        }\n                        \n                        .info-line {\n                            margin-bottom: 1px;\n                        }\n                        \n                        .qr-code {\n                            position: absolute;\n                            bottom: 20px;\n                            right: 4px;\n                            width: 40px;\n                            height: 40px;\n                        }\n                        \n                        .qr-image {\n                            width: 100%;\n                            height: 100%;\n                            object-fit: contain;\n                        }\n                        \n                        .matricule {\n                            position: absolute;\n                            bottom: 2px;\n                            left: 4px;\n                            font-size: 6px;\n                            color: #666;\n                            font-weight: bold;\n                        }\n                        \n                        .copyright {\n                            position: absolute;\n                            bottom: 1px;\n                            right: 60px;\n                            font-size: 5px;\n                            color: #aaa;\n                        }\n                        \n                        @media print {\n                            body {\n                                margin: 0;\n                                padding: 10mm;\n                            }\n                            \n                            .no-print {\n                                display: none !important;\n                            }\n                        }\n                        \n                        .print-controls {\n                            text-align: center;\n                            margin-top: 20px;\n                        }\n                        \n                        .print-btn {\n                            background: #007bff;\n                            color: white;\n                            border: none;\n                            padding: 10px 20px;\n                            border-radius: 5px;\n                            cursor: pointer;\n                            margin: 0 5px;\n                            font-size: 14px;\n                        }\n                        \n                        .close-btn {\n                            background: #6c757d;\n                            color: white;\n                            border: none;\n                            padding: 10px 20px;\n                            border-radius: 5px;\n                            cursor: pointer;\n                            margin: 0 5px;\n                            font-size: 14px;\n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class=\"card-container\">\n                        <div class=\"card-header\">\n                            <div class=\"header-content\">\n                                <div class=\"flag-section\">\n                                    🇨🇲 RÉPUBLIQUE DU CAMEROUN<br />\n                                    Paix - Travail - Patrie\n                                </div>\n                                <div class=\"school-section\">\n                                    <div class=\"school-name\">${(schoolSettings===null||schoolSettings===void 0?void 0:(_schoolSettings$schoo=schoolSettings.school_name)===null||_schoolSettings$schoo===void 0?void 0:_schoolSettings$schoo.toUpperCase())||'LYCÉE GANALIS'}</div>\n                                    <div class=\"card-title\">CARTE D'IDENTITÉ SCOLAIRE</div>\n                                </div>\n                                <div class=\"logo-section\">\n                                    ${logoBase64?`<img src=\"${logoBase64}\" alt=\"Logo\" class=\"logo\" />`:'<div style=\"width: 18px; height: 18px; background: #ddd; border-radius: 2px;\"></div>'}\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"card-body\">\n                            <img \n                                src=\"${studentPhotoBase64||'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDUiIHZpZXdCb3g9IjAgMCA0MCA0NSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQ1IiBmaWxsPSIjZjBmMGYwIiBzdHJva2U9IiNkZGQiLz4KPHN2ZyB4PSI1IiB5PSI1IiB3aWR0aD0iMzAiIGhlaWdodD0iMzUiIHZpZXdCb3g9IjAgMCAzMCAzNSIgZmlsbD0ibm9uZSI+CjxjaXJjbGUgY3g9IjE1IiBjeT0iMTAiIHI9IjUiIGZpbGw9IiM5OTkiLz4KPHBhdGggZD0iTTUgMzBDNSAyNSAxMCAyMCAxNSAyMEMyMCAyMCAyNSAyNSAyNSAzMFYzNUg1VjMwWiIgZmlsbD0iIzk5OSIvPgo8L3N2Zz4KPC9zdmc+'}\"\n                                alt=\"Photo étudiant\"\n                                class=\"photo\"\n                            />\n                            \n                            <div class=\"info-section\">\n                                <div class=\"year-info\">\n                                    ANNÉE SCOLAIRE : ${(schoolYear===null||schoolYear===void 0?void 0:schoolYear.year)||`${new Date().getFullYear()} - ${new Date().getFullYear()+1}`}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Nom :</strong> ${((_student$last_name=student.last_name)===null||_student$last_name===void 0?void 0:_student$last_name.toUpperCase())||''}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Prénom :</strong> ${student.first_name||''}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Née le :</strong> ${student.date_of_birth?new Date(student.date_of_birth).toLocaleDateString('fr-FR'):''} \n                                    <strong style=\"margin-left: 8px;\">À</strong> ${student.place_of_birth||'DOUALA'}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Matricule :</strong> ${student.matricule||`${new Date().getFullYear().toString().slice(-2)}${student.id.toString().padStart(4,'0')}AB`}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Sexe :</strong> ${student.gender==='male'?'M':student.gender==='female'?'F':'M'}\n                                    <strong style=\"margin-left: 15px;\">Classe :</strong> ${((_student$class_series=student.class_series)===null||_student$class_series===void 0?void 0:_student$class_series.name)||student.current_class||''}\n                                </div>\n                                \n                                \n                                <div class=\"info-line\">\n                                    <strong>Parent/Tuteur :</strong> ${student.parent_name||''}\n                                </div>\n                                <div class=\"info-line\">\n                                    <strong>Contact:</strong> ${student.parent_phone||'***********'}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Prénom :</strong> ${student.first_name||''}\n                                </div>\n                            </div>\n                            \n                            <div class=\"qr-code\">\n                                <img \n                                    src=\"https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(`STUDENT_ID_${student.id}`)}&margin=1\"\n                                    alt=\"QR Code\"\n                                    class=\"qr-image\"\n                                />\n                            </div>\n                        </div>\n                        <div class=\"copyright\">\n                            Generated by Djephix (www.djephix.com) © / ${new Date().getFullYear()} ALL RIGHTS RESERVED\n                        </div>\n                    </div>\n                    \n                    <div class=\"print-controls no-print\">\n                        <button class=\"print-btn\" onclick=\"window.print()\">\n                            🖨️ Imprimer la carte\n                        </button>\n                        <button class=\"close-btn\" onclick=\"window.close()\">\n                            ✖️ Fermer\n                        </button>\n                    </div>\n                    \n                    <script>\n                        // Auto-focus pour permettre Ctrl+P\n                        window.focus();\n                        \n                        // Optionnel: impression automatique après chargement\n                        // window.onload = function() { window.print(); }\n                    </script>\n                </body>\n                </html>\n            `;printWindow.document.write(cardHtml);printWindow.document.close();// Attendre que la fenêtre se charge avant de permettre l'impression\nprintWindow.onload=()=>{setPrinting(false);if(onPrintSuccess){onPrintSuccess();}};}catch(error){console.error('Erreur lors de l\\'impression:',error);setPrinting(false);Swal.fire({title:'Erreur d\\'impression',text:error.message||'Impossible d\\'ouvrir la fenêtre d\\'impression',icon:'error',confirmButtonText:'OK'});}};if(!student)return null;return/*#__PURE__*/_jsxs(Modal,{show:show,onHide:onHide,size:\"lg\",centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsxs(Modal.Title,{children:[/*#__PURE__*/_jsx(Printer,{className:\"me-2\"}),\"Carte Scolaire - \",student.first_name,\" \",student.last_name]})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-center mb-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"d-inline-block\",style:{transform:'scale(1.5)',transformOrigin:'center'},children:/*#__PURE__*/_jsx(StudentCard,{student:student,schoolYear:schoolYear})})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-muted\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"\\uD83D\\uDCCC Aper\\xE7u de la carte scolaire\",/*#__PURE__*/_jsx(\"br\",{}),\"Cliquez sur \\\"Imprimer\\\" pour ouvrir la fen\\xEAtre d'impression\"]})})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:onHide,children:\"Annuler\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handlePrint,disabled:printing,children:printing?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Spinner,{as:\"span\",animation:\"border\",size:\"sm\",role:\"status\",className:\"me-2\"}),\"Pr\\xE9paration...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Printer,{className:\"me-2\"}),\"Imprimer la carte\"]})})]})]});};export default StudentCardPrint;","map":{"version":3,"names":["React","useState","Modal","Button","Spinner","Printer","StudentCard","useSchool","Swal","host","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","StudentCardPrint","_ref","student","schoolYear","show","onHide","onPrintSuccess","printing","setPrinting","schoolSettings","convertImageToBase64","imageSrc","Promise","resolve","reject","img","Image","crossOrigin","onload","canvas","document","createElement","ctx","getContext","width","height","drawImage","dataURL","toDataURL","error","console","onerror","src","getStudentPhotoUrl","photo_url","photo","startsWith","window","location","origin","handlePrint","_schoolSettings$schoo","_student$last_name","_student$class_series","studentPhotoUrl","logoUrl","logo_url","log","studentId","id","studentPhotoBase64","logoBase64","all","hasStudentPhoto","hasLogo","studentPhotoLength","length","logoLength","printWindow","open","Error","cardHtml","first_name","last_name","school_name","toUpperCase","year","Date","getFullYear","date_of_birth","toLocaleDateString","place_of_birth","matricule","toString","slice","padStart","gender","class_series","name","current_class","parent_name","parent_phone","encodeURIComponent","write","close","fire","title","text","message","icon","confirmButtonText","size","centered","children","Header","closeButton","Title","className","Body","style","transform","transformOrigin","Footer","variant","onClick","disabled","as","animation","role"],"sources":["/var/www/College-IUP/front/src/components/StudentCardPrint.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Modal, Button, Spinner } from 'react-bootstrap';\nimport { Printer } from 'react-bootstrap-icons';\nimport StudentCard from './StudentCard';\nimport { useSchool } from '../contexts/SchoolContext';\nimport Swal from 'sweetalert2';\nimport { host } from '../utils/fetch';\n\nconst StudentCardPrint = ({ student, schoolYear, show, onHide, onPrintSuccess }) => {\n    const [printing, setPrinting] = useState(false);\n    const { schoolSettings } = useSchool();\n\n    const convertImageToBase64 = async (imageSrc) => {\n        return new Promise((resolve, reject) => {\n            if (!imageSrc) {\n                resolve('');\n                return;\n            }\n\n            const img = new Image();\n            img.crossOrigin = 'anonymous';\n            \n            img.onload = function() {\n                const canvas = document.createElement('canvas');\n                const ctx = canvas.getContext('2d');\n                canvas.width = img.width;\n                canvas.height = img.height;\n                ctx.drawImage(img, 0, 0);\n                \n                try {\n                    const dataURL = canvas.toDataURL('image/png');\n                    resolve(dataURL);\n                } catch (error) {\n                    console.error('Error converting image to base64:', error);\n                    resolve('');\n                }\n            };\n            \n            img.onerror = function() {\n                console.error('Error loading image:', imageSrc);\n                resolve('');\n            };\n            \n            img.src = imageSrc;\n        });\n    };\n\n    const getStudentPhotoUrl = (student) => {\n        if (student.photo_url) return student.photo_url;\n        if (student.photo) {\n            if (student.photo.startsWith('http')) return student.photo;\n            return `${host}/storage/${student.photo}`;\n        }\n        // Retourner l'image par défaut en utilisant un chemin absolu\n        return `${window.location.origin}/static/media/1.png`;\n    };\n\n    const handlePrint = async () => {\n        if (!student) return;\n\n        try {\n            setPrinting(true);\n\n            // Convertir les images en base64 pour l'impression\n            const studentPhotoUrl = getStudentPhotoUrl(student);\n            const logoUrl = schoolSettings?.logo_url;\n            \n            console.log('Preparing images for print:', {\n                studentPhotoUrl,\n                logoUrl,\n                studentId: student.id\n            });\n            \n            const [studentPhotoBase64, logoBase64] = await Promise.all([\n                convertImageToBase64(studentPhotoUrl),\n                convertImageToBase64(logoUrl)\n            ]);\n            \n            console.log('Images converted to base64:', {\n                hasStudentPhoto: !!studentPhotoBase64,\n                hasLogo: !!logoBase64,\n                studentPhotoLength: studentPhotoBase64?.length || 0,\n                logoLength: logoBase64?.length || 0\n            });\n\n            // Créer une nouvelle fenêtre pour l'impression\n            const printWindow = window.open('', '_blank', 'width=800,height=600');\n            \n            if (!printWindow) {\n                throw new Error('Popup bloqué. Veuillez autoriser les popups pour imprimer.');\n            }\n\n            // Générer le HTML de la carte avec les styles d'impression\n            const cardHtml = `\n                <!DOCTYPE html>\n                <html>\n                <head>\n                    <meta charset=\"UTF-8\">\n                    <title>Carte Scolaire - ${student.first_name} ${student.last_name}</title>\n                    <style>\n                        * {\n                            margin: 0;\n                            padding: 0;\n                            box-sizing: border-box;\n                        }\n                        \n                        body {\n                            font-family: Arial, sans-serif;\n                            background: white;\n                            padding: 20px;\n                            display: flex;\n                            justify-content: center;\n                            align-items: center;\n                            min-height: 100vh;\n                        }\n                        \n                        .card-container {\n                            width: 85.6mm;\n                            height: 54mm;\n                            background: white;\n                            border: 2px solid #e67e22;\n                            border-radius: 8px;\n                            overflow: hidden;\n                            position: relative;\n                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n                        }\n                        \n                        .card-header {\n                            background: #f8f9fa;\n                            padding: 4px 8px;\n                            border-bottom: 1px solid #e67e22;\n                            text-align: center;\n                            font-size: 8px;\n                            font-weight: bold;\n                        }\n                        \n                        .header-content {\n                            display: flex;\n                            align-items: center;\n                            justify-content: space-between;\n                        }\n                        \n                        .flag-section {\n                            font-size: 6px;\n                        }\n                        \n                        .school-section {\n                            text-align: center;\n                            flex: 1;\n                        }\n                        \n                        .school-name {\n                            font-size: 10px;\n                            font-weight: bold;\n                            color: #2c3e50;\n                        }\n                        \n                        .card-title {\n                            font-size: 8px;\n                            color: #7f8c8d;\n                        }\n                        \n                        .logo-section {\n                            width: 20px;\n                        }\n                        \n                        .logo {\n                            width: 18px;\n                            height: 18px;\n                            object-fit: contain;\n                        }\n                        \n                        .card-body {\n                            padding: 6px;\n                            display: flex;\n                            height: calc(100% - 30px);\n                            position: relative;\n                        }\n                        \n                        .photo {\n                            width: 40px;\n                            height: 45px;\n                            object-fit: cover;\n                            border: 1px solid #ddd;\n                            border-radius: 2px;\n                            margin-right: 6px;\n                        }\n                        \n                        .info-section {\n                            flex: 1;\n                            font-size: 8px;\n                            line-height: 1.2;\n                        }\n                        \n                        .year-info {\n                            font-size: 7px;\n                            margin-bottom: 2px;\n                            font-weight: bold;\n                        }\n                        \n                        .info-line {\n                            margin-bottom: 1px;\n                        }\n                        \n                        .qr-code {\n                            position: absolute;\n                            bottom: 20px;\n                            right: 4px;\n                            width: 40px;\n                            height: 40px;\n                        }\n                        \n                        .qr-image {\n                            width: 100%;\n                            height: 100%;\n                            object-fit: contain;\n                        }\n                        \n                        .matricule {\n                            position: absolute;\n                            bottom: 2px;\n                            left: 4px;\n                            font-size: 6px;\n                            color: #666;\n                            font-weight: bold;\n                        }\n                        \n                        .copyright {\n                            position: absolute;\n                            bottom: 1px;\n                            right: 60px;\n                            font-size: 5px;\n                            color: #aaa;\n                        }\n                        \n                        @media print {\n                            body {\n                                margin: 0;\n                                padding: 10mm;\n                            }\n                            \n                            .no-print {\n                                display: none !important;\n                            }\n                        }\n                        \n                        .print-controls {\n                            text-align: center;\n                            margin-top: 20px;\n                        }\n                        \n                        .print-btn {\n                            background: #007bff;\n                            color: white;\n                            border: none;\n                            padding: 10px 20px;\n                            border-radius: 5px;\n                            cursor: pointer;\n                            margin: 0 5px;\n                            font-size: 14px;\n                        }\n                        \n                        .close-btn {\n                            background: #6c757d;\n                            color: white;\n                            border: none;\n                            padding: 10px 20px;\n                            border-radius: 5px;\n                            cursor: pointer;\n                            margin: 0 5px;\n                            font-size: 14px;\n                        }\n                    </style>\n                </head>\n                <body>\n                    <div class=\"card-container\">\n                        <div class=\"card-header\">\n                            <div class=\"header-content\">\n                                <div class=\"flag-section\">\n                                    🇨🇲 RÉPUBLIQUE DU CAMEROUN<br />\n                                    Paix - Travail - Patrie\n                                </div>\n                                <div class=\"school-section\">\n                                    <div class=\"school-name\">${schoolSettings?.school_name?.toUpperCase() || 'LYCÉE GANALIS'}</div>\n                                    <div class=\"card-title\">CARTE D'IDENTITÉ SCOLAIRE</div>\n                                </div>\n                                <div class=\"logo-section\">\n                                    ${logoBase64 ? `<img src=\"${logoBase64}\" alt=\"Logo\" class=\"logo\" />` : '<div style=\"width: 18px; height: 18px; background: #ddd; border-radius: 2px;\"></div>'}\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"card-body\">\n                            <img \n                                src=\"${studentPhotoBase64 || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDUiIHZpZXdCb3g9IjAgMCA0MCA0NSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQ1IiBmaWxsPSIjZjBmMGYwIiBzdHJva2U9IiNkZGQiLz4KPHN2ZyB4PSI1IiB5PSI1IiB3aWR0aD0iMzAiIGhlaWdodD0iMzUiIHZpZXdCb3g9IjAgMCAzMCAzNSIgZmlsbD0ibm9uZSI+CjxjaXJjbGUgY3g9IjE1IiBjeT0iMTAiIHI9IjUiIGZpbGw9IiM5OTkiLz4KPHBhdGggZD0iTTUgMzBDNSAyNSAxMCAyMCAxNSAyMEMyMCAyMCAyNSAyNSAyNSAzMFYzNUg1VjMwWiIgZmlsbD0iIzk5OSIvPgo8L3N2Zz4KPC9zdmc+'}\"\n                                alt=\"Photo étudiant\"\n                                class=\"photo\"\n                            />\n                            \n                            <div class=\"info-section\">\n                                <div class=\"year-info\">\n                                    ANNÉE SCOLAIRE : ${schoolYear?.year || `${new Date().getFullYear()} - ${new Date().getFullYear() + 1}`}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Nom :</strong> ${student.last_name?.toUpperCase() || ''}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Prénom :</strong> ${student.first_name || ''}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Née le :</strong> ${student.date_of_birth ? new Date(student.date_of_birth).toLocaleDateString('fr-FR') : ''} \n                                    <strong style=\"margin-left: 8px;\">À</strong> ${student.place_of_birth || 'DOUALA'}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Matricule :</strong> ${student.matricule || `${new Date().getFullYear().toString().slice(-2)}${student.id.toString().padStart(4, '0')}AB`}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Sexe :</strong> ${student.gender === 'male' ? 'M' : student.gender === 'female' ? 'F' : 'M'}\n                                    <strong style=\"margin-left: 15px;\">Classe :</strong> ${student.class_series?.name || student.current_class || ''}\n                                </div>\n                                \n                                \n                                <div class=\"info-line\">\n                                    <strong>Parent/Tuteur :</strong> ${student.parent_name || ''}\n                                </div>\n                                <div class=\"info-line\">\n                                    <strong>Contact:</strong> ${student.parent_phone || '***********'}\n                                </div>\n                                \n                                <div class=\"info-line\">\n                                    <strong>Prénom :</strong> ${student.first_name || ''}\n                                </div>\n                            </div>\n                            \n                            <div class=\"qr-code\">\n                                <img \n                                    src=\"https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(`STUDENT_ID_${student.id}`)}&margin=1\"\n                                    alt=\"QR Code\"\n                                    class=\"qr-image\"\n                                />\n                            </div>\n                        </div>\n                        <div class=\"copyright\">\n                            Generated by Djephix (www.djephix.com) © / ${new Date().getFullYear()} ALL RIGHTS RESERVED\n                        </div>\n                    </div>\n                    \n                    <div class=\"print-controls no-print\">\n                        <button class=\"print-btn\" onclick=\"window.print()\">\n                            🖨️ Imprimer la carte\n                        </button>\n                        <button class=\"close-btn\" onclick=\"window.close()\">\n                            ✖️ Fermer\n                        </button>\n                    </div>\n                    \n                    <script>\n                        // Auto-focus pour permettre Ctrl+P\n                        window.focus();\n                        \n                        // Optionnel: impression automatique après chargement\n                        // window.onload = function() { window.print(); }\n                    </script>\n                </body>\n                </html>\n            `;\n\n            printWindow.document.write(cardHtml);\n            printWindow.document.close();\n            \n            // Attendre que la fenêtre se charge avant de permettre l'impression\n            printWindow.onload = () => {\n                setPrinting(false);\n                if (onPrintSuccess) {\n                    onPrintSuccess();\n                }\n            };\n\n        } catch (error) {\n            console.error('Erreur lors de l\\'impression:', error);\n            setPrinting(false);\n            \n            Swal.fire({\n                title: 'Erreur d\\'impression',\n                text: error.message || 'Impossible d\\'ouvrir la fenêtre d\\'impression',\n                icon: 'error',\n                confirmButtonText: 'OK'\n            });\n        }\n    };\n\n    if (!student) return null;\n\n    return (\n        <Modal show={show} onHide={onHide} size=\"lg\" centered>\n            <Modal.Header closeButton>\n                <Modal.Title>\n                    <Printer className=\"me-2\" />\n                    Carte Scolaire - {student.first_name} {student.last_name}\n                </Modal.Title>\n            </Modal.Header>\n            \n            <Modal.Body>\n                <div className=\"text-center mb-3\">\n                    <div className=\"d-inline-block\" style={{ transform: 'scale(1.5)', transformOrigin: 'center' }}>\n                        <StudentCard \n                            student={student} \n                            schoolYear={schoolYear} \n                        />\n                    </div>\n                </div>\n                \n                <div className=\"text-center text-muted\">\n                    <small>\n                        📌 Aperçu de la carte scolaire<br />\n                        Cliquez sur \"Imprimer\" pour ouvrir la fenêtre d'impression\n                    </small>\n                </div>\n            </Modal.Body>\n            \n            <Modal.Footer>\n                <Button variant=\"secondary\" onClick={onHide}>\n                    Annuler\n                </Button>\n                <Button \n                    variant=\"primary\" \n                    onClick={handlePrint}\n                    disabled={printing}\n                >\n                    {printing ? (\n                        <>\n                            <Spinner\n                                as=\"span\"\n                                animation=\"border\"\n                                size=\"sm\"\n                                role=\"status\"\n                                className=\"me-2\"\n                            />\n                            Préparation...\n                        </>\n                    ) : (\n                        <>\n                            <Printer className=\"me-2\" />\n                            Imprimer la carte\n                        </>\n                    )}\n                </Button>\n            </Modal.Footer>\n        </Modal>\n    );\n};\n\nexport default StudentCardPrint;"],"mappings":"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OAAO,CAACiB,GAAG,CAAC,6BAA6B,CAAE,CACvCM,eAAe,CAAE,CAAC,CAACH,kBAAkB,CACrCI,OAAO,CAAE,CAAC,CAACH,UAAU,CACrBI,kBAAkB,CAAE,CAAAL,kBAAkB,SAAlBA,kBAAkB,iBAAlBA,kBAAkB,CAAEM,MAAM,GAAI,CAAC,CACnDC,UAAU,CAAE,CAAAN,UAAU,SAAVA,UAAU,iBAAVA,UAAU,CAAEK,MAAM,GAAI,CACtC,CAAC,CAAC,CAEF;AACA,KAAM,CAAAE,WAAW,CAAGrB,MAAM,CAACsB,IAAI,CAAC,EAAE,CAAE,QAAQ,CAAE,sBAAsB,CAAC,CAErE,GAAI,CAACD,WAAW,CAAE,CACd,KAAM,IAAI,CAAAE,KAAK,CAAC,4DAA4D,CAAC,CACjF,CAEA;AACA,KAAM,CAAAC,QAAQ,CAAG;AAC7B;AACA;AACA;AACA;AACA,8CAA8C3D,OAAO,CAAC4D,UAAU,IAAI5D,OAAO,CAAC6D,SAAS;AACrF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}