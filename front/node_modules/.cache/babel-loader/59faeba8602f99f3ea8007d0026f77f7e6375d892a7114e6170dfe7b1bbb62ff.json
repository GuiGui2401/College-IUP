{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{secureApiEndpoints}from'../utils/apiMigration';import{host}from'../utils/fetch';import{jsx as _jsx}from\"react/jsx-runtime\";const SchoolContext=/*#__PURE__*/createContext();export const useSchool=()=>{const context=useContext(SchoolContext);if(!context){throw new Error('useSchool must be used within a SchoolProvider');}return context;};export const SchoolProvider=_ref=>{let{children}=_ref;const[schoolSettings,setSchoolSettings]=useState({school_name:'COLLÈGE POLYVALENT BILINGUE DE DOUALA',school_motto:'',school_address:'',school_phone:'',school_email:'',school_website:'',school_logo:'',currency:'FCFA',bank_name:'',country:'',city:'',footer_text:'',scholarship_deadline:'',reduction_percentage:10,primary_color:'#007bff'});const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const loadSchoolSettings=async()=>{try{setLoading(true);setError(null);const response=await secureApiEndpoints.schoolSettings.get();if(response.success&&response.data){setSchoolSettings(response.data);}}catch(err){console.error('Erreur lors du chargement des paramètres école:',err);setError('Erreur lors du chargement des paramètres de l\\'école');}finally{setLoading(false);}};const updateSchoolSettings=async newSettings=>{try{const response=await secureApiEndpoints.schoolSettings.update(newSettings);if(response.success&&response.data){setSchoolSettings(response.data);return{success:true,data:response.data};}else{return{success:false,message:response.message||'Erreur lors de la mise à jour'};}}catch(err){console.error('Erreur lors de la mise à jour des paramètres école:',err);return{success:false,message:'Erreur lors de la mise à jour des paramètres'};}};const getLogoUrl=()=>{if(!schoolSettings.school_logo)return null;// Si c'est déjà une URL complète\nif(schoolSettings.school_logo.startsWith('http')){return schoolSettings.school_logo;}// Si c'est un chemin relatif, construire l'URL complète en utilisant l'host configuré\nreturn`${host}/storage/${schoolSettings.school_logo}`;};const formatCurrency=amount=>{if(!amount&&amount!==0)return'';return`${amount.toLocaleString()} ${schoolSettings.currency||'FCFA'}`;};useEffect(()=>{loadSchoolSettings();},[]);const value={schoolSettings,loading,error,loadSchoolSettings,updateSchoolSettings,getLogoUrl,formatCurrency};return/*#__PURE__*/_jsx(SchoolContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","secureApiEndpoints","host","jsx","_jsx","SchoolContext","useSchool","context","Error","SchoolProvider","_ref","children","schoolSettings","setSchoolSettings","school_name","school_motto","school_address","school_phone","school_email","school_website","school_logo","currency","bank_name","country","city","footer_text","scholarship_deadline","reduction_percentage","primary_color","loading","setLoading","error","setError","loadSchoolSettings","response","get","success","data","err","console","updateSchoolSettings","newSettings","update","message","getLogoUrl","startsWith","formatCurrency","amount","toLocaleString","value","Provider"],"sources":["/var/www/College-IUP/front/src/contexts/SchoolContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport { secureApiEndpoints } from '../utils/apiMigration';\nimport { host } from '../utils/fetch';\n\nconst SchoolContext = createContext();\n\nexport const useSchool = () => {\n    const context = useContext(SchoolContext);\n    if (!context) {\n        throw new Error('useSchool must be used within a SchoolProvider');\n    }\n    return context;\n};\n\nexport const SchoolProvider = ({ children }) => {\n    const [schoolSettings, setSchoolSettings] = useState({\n        school_name: 'COLLÈGE POLYVALENT BILINGUE DE DOUALA',\n        school_motto: '',\n        school_address: '',\n        school_phone: '',\n        school_email: '',\n        school_website: '',\n        school_logo: '',\n        currency: 'FCFA',\n        bank_name: '',\n        country: '',\n        city: '',\n        footer_text: '',\n        scholarship_deadline: '',\n        reduction_percentage: 10,\n        primary_color: '#007bff'\n    });\n    \n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    const loadSchoolSettings = async () => {\n        try {\n            setLoading(true);\n            setError(null);\n            \n            const response = await secureApiEndpoints.schoolSettings.get();\n            \n            if (response.success && response.data) {\n                setSchoolSettings(response.data);\n            }\n        } catch (err) {\n            console.error('Erreur lors du chargement des paramètres école:', err);\n            setError('Erreur lors du chargement des paramètres de l\\'école');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const updateSchoolSettings = async (newSettings) => {\n        try {\n            const response = await secureApiEndpoints.schoolSettings.update(newSettings);\n            \n            if (response.success && response.data) {\n                setSchoolSettings(response.data);\n                return { success: true, data: response.data };\n            } else {\n                return { success: false, message: response.message || 'Erreur lors de la mise à jour' };\n            }\n        } catch (err) {\n            console.error('Erreur lors de la mise à jour des paramètres école:', err);\n            return { success: false, message: 'Erreur lors de la mise à jour des paramètres' };\n        }\n    };\n\n    const getLogoUrl = () => {\n        if (!schoolSettings.school_logo) return null;\n        \n        // Si c'est déjà une URL complète\n        if (schoolSettings.school_logo.startsWith('http')) {\n            return schoolSettings.school_logo;\n        }\n        \n        // Si c'est un chemin relatif, construire l'URL complète en utilisant l'host configuré\n        return `${host}/storage/${schoolSettings.school_logo}`;\n    };\n\n    const formatCurrency = (amount) => {\n        if (!amount && amount !== 0) return '';\n        return `${amount.toLocaleString()} ${schoolSettings.currency || 'FCFA'}`;\n    };\n\n    useEffect(() => {\n        loadSchoolSettings();\n    }, []);\n\n    const value = {\n        schoolSettings,\n        loading,\n        error,\n        loadSchoolSettings,\n        updateSchoolSettings,\n        getLogoUrl,\n        formatCurrency\n    };\n\n    return (\n        <SchoolContext.Provider value={value}>\n            {children}\n        </SchoolContext.Provider>\n    );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}